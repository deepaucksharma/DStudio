
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to efficiently distribute and coordinate work across multiple nodes in distributed systems">
      
      
      
        <link rel="canonical" href="https://deepaucksharma.github.io/DStudio/part2-pillars/work/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="examples/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Pillar 1: Distribution of Work - The Compendium of Distributed Systems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/modular.css">
    
      <link rel="stylesheet" href="../../stylesheets/axioms.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intuition-the-restaurant-kitchen-problem-5-min-read" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="The Compendium of Distributed Systems" class="md-header__button md-logo" aria-label="The Compendium of Distributed Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Compendium of Distributed Systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pillar 1: Distribution of Work
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to auto"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to auto" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/deepaucksharma/DStudio" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    deepaucksharma/DStudio
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../introduction/" class="md-tabs__link">
          
  
  
    
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part1-axioms/" class="md-tabs__link">
          
  
  
    
  
  Part I: Axioms

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Part II: Pillars

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../patterns/" class="md-tabs__link">
          
  
  
    
  
  Part III: Patterns

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../quantitative/" class="md-tabs__link">
          
  
  
    
  
  Part IV: Quantitative Toolkit

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../human-factors/" class="md-tabs__link">
          
  
  
    
  
  Part V: Human Factors

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tools/" class="md-tabs__link">
          
  
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../case-studies/" class="md-tabs__link">
          
  
  
    
  
  Case Studies

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Compendium of Distributed Systems" class="md-nav__button md-logo" aria-label="The Compendium of Distributed Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Compendium of Distributed Systems
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/deepaucksharma/DStudio" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    deepaucksharma/DStudio
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../introduction/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/philosophy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Philosophy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part I: Axioms
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Part I: Axioms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom1-latency/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 1: Latency
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Axiom 1: Latency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom1-latency/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom1-latency/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom2-capacity/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 2: Capacity
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Axiom 2: Capacity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom2-capacity/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom2-capacity/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom3-failure/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 3: Failure
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Axiom 3: Failure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom3-failure/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom3-failure/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom4-concurrency/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 4: Concurrency
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Axiom 4: Concurrency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom4-concurrency/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom4-concurrency/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom5-coordination/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 5: Coordination
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Axiom 5: Coordination
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom5-coordination/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom5-coordination/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom6-observability/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 6: Observability
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Axiom 6: Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom6-observability/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom6-observability/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom7-human/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 7: Human Interface
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Axiom 7: Human Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom7-human/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom7-human/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom8-economics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 8: Economics
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Axiom 8: Economics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom8-economics/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom8-economics/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Synthesis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Synthesis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/synthesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Summary
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part II: Pillars
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Part II: Pillars
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="./" class="md-nav__link md-nav__link--active">
              
  
  
  <span class="md-ellipsis">
    Pillar 1: Work
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link md-nav__link--active" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Pillar 1: Work
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../state/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 2: State
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Pillar 2: State
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../truth/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 3: Truth
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Pillar 3: Truth
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../truth/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../truth/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../control/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 4: Control
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Pillar 4: Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../control/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../control/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../intelligence/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 5: Intelligence
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Pillar 5: Intelligence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intelligence/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intelligence/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Analysis Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Analysis Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CAST vs SPACE Models
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-collide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    When Models Collide
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Matrix
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tradeoff-calculus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trade-off Calculus
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decision-tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Decision Tree
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Exercises & Reflection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Exercises & Reflection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pillar-checkpoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pillar Checkpoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../failure-recap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Failure Recap
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reflection-journal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reflection Journal
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Pattern Preview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Pattern Preview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-catalog-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Catalog Intro
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-legend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Legend
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pillars-patterns-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pillars  Patterns Map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transition-part3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transition to Part III
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../patterns/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part III: Patterns
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Part III: Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Core Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/queues-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queues & Streaming
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/cqrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CQRS
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/event-driven/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event-Driven Architecture
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Sourcing
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/saga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Saga Pattern
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/service-mesh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Mesh
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/graphql-federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GraphQL Federation
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/serverless-faas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serverless/FaaS
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Resilience Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Resilience Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/circuit-breaker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circuit Breaker
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/retry-backoff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retry & Backoff
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/bulkhead/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bulkhead
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/edge-computing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Edge Computing
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/graceful-degradation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graceful Degradation
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/health-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Health Check
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/timeout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timeout
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Data Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/cdc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CDC (Change Data Capture)
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/tunable-consistency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tunable Consistency
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/sharding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharding
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/caching-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching Strategies
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/geo-replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geo-Replication
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Coordination Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Coordination Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/leader-election/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Leader Election
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/consensus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consensus
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/distributed-lock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Lock
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/idempotent-receiver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Idempotent Receiver
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/outbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outbox
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operational Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Operational Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/auto-scaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Auto Scaling
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/load-balancing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Balancing
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/load-shedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Shedding
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/rate-limiting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rate Limiting
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/service-discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Discovery
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/finops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FinOps
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/pattern-quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Quiz
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../quantitative/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part IV: Quantitative Toolkit
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Part IV: Quantitative Toolkit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Latency & Performance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Latency & Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/latency-ladder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Latency Ladder
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/littles-law/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Little's Law
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/queueing-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queueing Theory
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Scaling Laws
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Scaling Laws
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/amdahl-gustafson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amdahl & Gustafson Laws
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/universal-scalability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Universal Scalability Law
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Economics & Planning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Economics & Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/coordination-costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coordination Costs
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/cache-economics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cache Economics
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/availability-math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Availability Math
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/capacity-planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capacity Planning
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/problem-set/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Problem Set
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../human-factors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part V: Human Factors
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Part V: Human Factors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Production Excellence
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Production Excellence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/consistency-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consistency Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/chaos-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chaos Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/observability-stacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability Stacks
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operational Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Operational Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/sre-practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SRE Practices
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/org-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Org-Structure Physics
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/runbooks-playbooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runbooks & Playbooks
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Team Organization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Team Organization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/team-topologies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Team Topologies
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/knowledge-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knowledge Management
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/oncall-culture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Call Culture
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Incident Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Incident Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/incident-response/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incident Response
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/blameless-postmortems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blameless Postmortems
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../case-studies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Case Studies
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Case Studies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/amazon-dynamo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon DynamoDB
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/paypal-payments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PayPal Payments
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/spotify-recommendations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spotify Recommendations
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/uber-location/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Uber Location Services
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cheat-sheets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheat Sheets
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/recipe-cards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recipe Cards
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Overview</h1>

<h2 id="intuition-the-restaurant-kitchen-problem-5-min-read"> Intuition: The Restaurant Kitchen Problem (5 min read)<a class="headerlink" href="#intuition-the-restaurant-kitchen-problem-5-min-read" title="Permanent link">&para;</a></h2>
<p>Imagine a busy restaurant kitchen during dinner rush. Orders flood in: steaks, salads, desserts. One chef trying to cook everything would create a massive bottleneck. Instead, they organize:</p>
<ul>
<li><strong>Grill station</strong>: Handles all meat</li>
<li><strong>Salad station</strong>: Prepares cold dishes</li>
<li><strong>Pastry station</strong>: Makes desserts</li>
<li><strong>Expeditor</strong>: Coordinates and quality checks</li>
</ul>
<p>This is distributed work: <strong>breaking down complex tasks into parallel, specialized units that can execute independently while maintaining overall coordination</strong>.</p>
<p> <strong>Key Insight</strong>: The best kitchens aren't the ones with the most chefs, but the ones with the smartest work distribution.</p>
<h3 id="why-this-matters">Why This Matters<a class="headerlink" href="#why-this-matters" title="Permanent link">&para;</a></h3>
<p>Every time you:
- Process millions of database records
- Encode video for streaming
- Handle thousands of API requests
- Train a machine learning model</p>
<p>You're solving the same fundamental problem: how to split work efficiently across available resources.</p>
<hr />
<h2 id="questions-this-pillar-answers"> Questions This Pillar Answers<a class="headerlink" href="#questions-this-pillar-answers" title="Permanent link">&para;</a></h2>
<hr />
<h2 id="foundation-understanding-work-distribution-15-min-read"> Foundation: Understanding Work Distribution (15 min read)<a class="headerlink" href="#foundation-understanding-work-distribution-15-min-read" title="Permanent link">&para;</a></h2>
<h3 id="the-central-question">The Central Question<a class="headerlink" href="#the-central-question" title="Permanent link">&para;</a></h3>
<p>How do you break computation into pieces that can run on different machines while minimizing coordination overhead and maximizing throughput?</p>
<h3 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h3>
<h3 id="the-fundamental-trade-offs">The Fundamental Trade-offs<a class="headerlink" href="#the-fundamental-trade-offs" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">No Free Lunch in Work Distribution</p>
<p>Every choice in work distribution involves trade-offs:</p>
<p><strong>Parallelism vs Coordination Overhead</strong>
- More workers = More communication needed
- Amdahl's Law: Serial portions limit speedup
- Eventually coordination costs exceed computation savings</p>
<p><strong>Latency vs Throughput</strong>
- Batching improves throughput but increases latency
- Small batches = Low latency but more overhead
- Must choose based on use case requirements</p>
<p><strong>Simplicity vs Performance</strong>
- Simple round-robin vs complex work stealing
- Static partitioning vs dynamic rebalancing
- Easier to debug vs harder to optimize</p>
</div>
<h3 id="the-work-decomposition-matrix">The Work Decomposition Matrix<a class="headerlink" href="#the-work-decomposition-matrix" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Dimension        Options              Trade-offs                Real Example
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>---------        -------              ----------                ------------
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Space           Single/Multi-node     Latency vs Isolation      Redis vs Cassandra
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>Time            Sync/Async           Consistency vs Throughput  REST vs Kafka
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Data            Shared/Partitioned   Simplicity vs Scale        PostgreSQL vs MongoDB sharding
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>Control         Centralized/P2P      Coordination vs Resilience Kubernetes vs BitTorrent
</span></code></pre></div>
<h3 id="when-work-distribution-goes-wrong">When Work Distribution Goes Wrong<a class="headerlink" href="#when-work-distribution-goes-wrong" title="Permanent link">&para;</a></h3>
<div class="admonition danger">
<p class="admonition-title">Common Anti-Patterns</p>
<p><strong>The Overeager Parallelizer</strong>: Breaking work into pieces smaller than coordination overhead
- Example: 1000 workers processing 1000 items = mostly waiting
- Solution: Batch work to amortize coordination costs</p>
<p><strong>The Hotspot Creator</strong>: Uneven work distribution causing bottlenecks
- Example: All video encoding jobs hitting the same worker
- Solution: Content-aware load balancing or work stealing</p>
<p><strong>The Thundering Herd</strong>: All workers starting simultaneously
- Example: Cron job at midnight across all servers
- Solution: Jittered starts and gradual ramp-up</p>
</div>
<h3 id="concept-map-work-distribution">Concept Map: Work Distribution<a class="headerlink" href="#concept-map-work-distribution" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "Work Distribution Pillar"
        Core[Work Distribution&lt;br/&gt;Core Concept]

        Core --&gt; Decomp[Work Decomposition]
        Core --&gt; Coord[Coordination Models]
        Core --&gt; Sched[Scheduling Strategies]
        Core --&gt; Scale[Scaling Patterns]

        %% Decomposition branch
        Decomp --&gt; DataPar[Data Parallelism&lt;br/&gt;Same operation, different data]
        Decomp --&gt; TaskPar[Task Parallelism&lt;br/&gt;Different operations]
        Decomp --&gt; Pipeline[Pipeline Parallelism&lt;br/&gt;Sequential stages]

        %% Coordination branch
        Coord --&gt; MasterWorker[Master-Worker&lt;br/&gt;Centralized control]
        Coord --&gt; P2P[Peer-to-Peer&lt;br/&gt;Decentralized]
        Coord --&gt; WorkSteal[Work Stealing&lt;br/&gt;Dynamic balancing]

        %% Scheduling branch
        Sched --&gt; Static[Static Assignment&lt;br/&gt;Pre-determined]
        Sched --&gt; Dynamic[Dynamic Assignment&lt;br/&gt;Runtime decisions]
        Sched --&gt; Adaptive[Adaptive Scheduling&lt;br/&gt;Learning-based]

        %% Scaling branch
        Scale --&gt; Horizontal[Horizontal Scaling&lt;br/&gt;Add more workers]
        Scale --&gt; Vertical[Vertical Scaling&lt;br/&gt;Bigger workers]
        Scale --&gt; Elastic[Elastic Scaling&lt;br/&gt;Auto-adjust]

        %% Key relationships
        DataPar -.-&gt; Static
        TaskPar -.-&gt; Dynamic
        Pipeline -.-&gt; MasterWorker
        WorkSteal -.-&gt; Adaptive

        %% Axiom connections
        Axiom1[Axiom 1: Latency] --&gt; Coord
        Axiom2[Axiom 2: Capacity] --&gt; Scale
        Axiom3[Axiom 3: Failure] --&gt; WorkSteal
        Axiom4[Axiom 4: Concurrency] --&gt; Decomp
        Axiom5[Axiom 5: Coordination] --&gt; Sched
    end

    style Core fill:#f9f,stroke:#333,stroke-width:4px
    style Axiom1 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom2 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom3 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom4 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom5 fill:#e1e1ff,stroke:#333,stroke-width:2px</code></pre>
<p>This concept map shows how work distribution connects fundamental axioms to practical implementation patterns. Each branch represents a key decision area, with dotted lines showing common associations between concepts.</p>
<h3 id="work-distribution-decision-framework">Work Distribution Decision Framework<a class="headerlink" href="#work-distribution-decision-framework" title="Permanent link">&para;</a></h3>
<h3 id="simple-example-processing-user-uploads">Simple Example: Processing User Uploads<a class="headerlink" href="#simple-example-processing-user-uploads" title="Permanent link">&para;</a></h3>
<p>When a user uploads a photo to Instagram:</p>
<pre class="mermaid"><code>gantt
    title Sequential vs Parallel Photo Processing
    dateFormat X
    axisFormat %L

    section Sequential (1500ms)
    Resize Image          :done, seq1, 0, 500
    Generate Thumbnails   :done, seq2, after seq1, 300
    Apply Filters         :done, seq3, after seq2, 400
    Extract Metadata      :done, seq4, after seq3, 100
    Store All            :done, seq5, after seq4, 200

    section Parallel (700ms)
    Resize Image         :active, par1, 0, 500
    Extract Metadata     :active, par2, 0, 100
    Generate Thumbnails  :active, par3, after par1, 300
    Apply Filters        :active, par4, 500, 400
    Store All           :active, par5, after par3 par4, 200</code></pre>
<p><strong>Performance Comparison:</strong></p>
<table>
<thead>
<tr>
<th>Approach</th>
<th>Total Time</th>
<th>Speedup</th>
<th>Resource Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequential</td>
<td>1500ms</td>
<td>1x</td>
<td>1 worker</td>
</tr>
<tr>
<td>Parallel</td>
<td>700ms</td>
<td>2.14x</td>
<td>2-4 workers</td>
</tr>
</tbody>
</table>
<p><strong>Dependency Graph:</strong></p>
<pre class="mermaid"><code>graph LR
    Photo[Original Photo]

    Photo --&gt; Resize[Resize Image&lt;br/&gt;500ms]
    Photo --&gt; Meta[Extract Metadata&lt;br/&gt;100ms]

    Resize --&gt; Thumb[Generate Thumbnails&lt;br/&gt;300ms]
    Resize --&gt; Filter[Apply Filters&lt;br/&gt;400ms]

    Thumb --&gt; Store[Store All&lt;br/&gt;200ms]
    Filter --&gt; Store
    Meta --&gt; Store

    style Photo fill:#f9f
    style Store fill:#9f9</code></pre>
<h3 id="amdahls-law-the-fundamental-limit">Amdahl's Law: The Fundamental Limit<a class="headerlink" href="#amdahls-law-the-fundamental-limit" title="Permanent link">&para;</a></h3>
<p>No matter how many workers you add, speedup is limited by sequential parts:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Speedup = 1 / (S + P/N)
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>Where:
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>S = Sequential fraction (can&#39;t be parallelized)
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>P = Parallel fraction (can be parallelized)
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>N = Number of processors
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>Example:
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>If 10% must be sequential (S=0.1):
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>- With 10 processors: Speedup = 5.3x (not 10x!)
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>- With 100 processors: Speedup = 9.2x (not 100x!)
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>- With  processors: Speedup = 10x (hard limit)
</span></code></pre></div>
<hr />
<h2 id="deep-dive-engineering-work-distribution-30-min-read"> Deep Dive: Engineering Work Distribution (30 min read)<a class="headerlink" href="#deep-dive-engineering-work-distribution-30-min-read" title="Permanent link">&para;</a></h2>
<h3 id="real-failure-the-netflix-encoding-disaster">Real Failure: The Netflix Encoding Disaster<a class="headerlink" href="#real-failure-the-netflix-encoding-disaster" title="Permanent link">&para;</a></h3>
<p><strong>Company</strong>: Netflix
<strong>Date</strong>: 2008
<strong>Impact</strong>: 3-day outage for new content</p>
<p><strong>The Problem</strong>:
- Monolithic encoding server
- Single queue for all videos
- One crash = entire pipeline stops
- 12-hour encode time for 2-hour movie</p>
<p><strong>The Root Cause</strong>:</p>
<pre class="mermaid"><code>graph TD
    subgraph "Monolithic Encoding Problems"
        Movie[2-Hour Movie] --&gt; Single[Single Process]
        Single --&gt; P1[" Problem 1:&lt;br/&gt;Sequential Processing&lt;br/&gt;120 min  6 min/min = 12 hours"]
        Single --&gt; P2[" Problem 2:&lt;br/&gt;No Fault Tolerance&lt;br/&gt;1% failure = restart all"]
        Single --&gt; P3[" Problem 3:&lt;br/&gt;Can't Scale Horizontally&lt;br/&gt;More servers don't help"]
    end

    style P1 fill:#fee,stroke:#c00
    style P2 fill:#fee,stroke:#c00
    style P3 fill:#fee,stroke:#c00</code></pre>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Impact</th>
<th>Root Cause</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sequential Processing</strong></td>
<td>12-hour encode time</td>
<td>Must process each minute in order</td>
</tr>
<tr>
<td><strong>No Fault Tolerance</strong></td>
<td>Complete restart on failure</td>
<td>No checkpointing or partial progress</td>
</tr>
<tr>
<td><strong>Scaling Bottleneck</strong></td>
<td>Can't use multiple servers</td>
<td>Monolithic design prevents distribution</td>
</tr>
</tbody>
</table>
<p><strong>The Fix: Distributed Encoding Pipeline</strong>:</p>
<pre class="mermaid"><code>graph LR
    subgraph "Map Phase"
        Movie[2-Hour Movie] --&gt; Split[Split into&lt;br/&gt;720 chunks&lt;br/&gt;10 sec each]
        Split --&gt; C1[Chunk 1]
        Split --&gt; C2[Chunk 2]
        Split --&gt; Dots1[...]
        Split --&gt; C720[Chunk 720]

        C1 --&gt; W1[Worker 1]
        C2 --&gt; W2[Worker 2]
        Dots1 --&gt; W3[Workers 3-N]
        C720 --&gt; WN[Worker N]
    end

    subgraph "Reduce Phase"
        W1 --&gt; E1[Encoded 1]
        W2 --&gt; E2[Encoded 2]
        W3 --&gt; E3[Encoded ...]
        WN --&gt; EN[Encoded 720]

        E1 --&gt; Stitch[Stitch Together]
        E2 --&gt; Stitch
        E3 --&gt; Stitch
        EN --&gt; Stitch

        Stitch --&gt; Final[Final Video&lt;br/&gt;All Formats]
    end

    style Movie fill:#e1f5fe
    style Final fill:#c8e6c9</code></pre>
<table>
<thead>
<tr>
<th>Improvement</th>
<th>Before</th>
<th>After</th>
<th>Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Parallelization</strong></td>
<td>1 sequential process</td>
<td>720 parallel chunks</td>
<td>36x potential speedup</td>
</tr>
<tr>
<td><strong>Fault Tolerance</strong></td>
<td>Full restart</td>
<td>Retry single chunk</td>
<td>99.86% progress saved</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>1 server max</td>
<td>N servers</td>
<td>Linear scaling</td>
</tr>
<tr>
<td><strong>Total Time</strong></td>
<td>12 hours</td>
<td>20 minutes</td>
<td>36x faster</td>
</tr>
</tbody>
</table>
<h3 id="work-distribution-patterns">Work Distribution Patterns<a class="headerlink" href="#work-distribution-patterns" title="Permanent link">&para;</a></h3>
<h4 id="1-master-worker-pattern">1. Master-Worker Pattern<a class="headerlink" href="#1-master-worker-pattern" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>sequenceDiagram
    participant M as Master
    participant Q as Task Queue
    participant W1 as Worker 1
    participant W2 as Worker 2
    participant WN as Worker N
    participant R as Result Queue

    Note over M: Receives work batch

    M-&gt;&gt;Q: Put Task 1
    M-&gt;&gt;Q: Put Task 2
    M-&gt;&gt;Q: Put Task N

    par Worker Processing
        W1-&gt;&gt;Q: Get Task
        Q--&gt;&gt;W1: Task 1
        W1-&gt;&gt;W1: Process
        W1-&gt;&gt;R: Put Result 1
    and
        W2-&gt;&gt;Q: Get Task
        Q--&gt;&gt;W2: Task 2
        W2-&gt;&gt;W2: Process
        W2-&gt;&gt;R: Put Result 2
    and
        WN-&gt;&gt;Q: Get Task
        Q--&gt;&gt;WN: Task N
        WN-&gt;&gt;WN: Process
        WN-&gt;&gt;R: Put Result N
    end

    M-&gt;&gt;R: Collect all results
    R--&gt;&gt;M: Results[]</code></pre>
<p><strong>Master-Worker Characteristics:</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Description</th>
<th>Use When</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Communication</strong></td>
<td>Through queues</td>
<td>Tasks are independent</td>
</tr>
<tr>
<td><strong>Scaling</strong></td>
<td>Add more workers</td>
<td>CPU-bound workloads</td>
</tr>
<tr>
<td><strong>Fault Tolerance</strong></td>
<td>Worker failure = retry task</td>
<td>Tasks can be retried</td>
</tr>
<tr>
<td><strong>Load Balancing</strong></td>
<td>Automatic via queue</td>
<td>Varying task sizes</td>
</tr>
</tbody>
</table>
<p><strong>Pros</strong>: Simple, centralized control<br />
<strong>Cons</strong>: Master is bottleneck and SPOF</p>
<h4 id="2-work-stealing-pattern">2. Work-Stealing Pattern<a class="headerlink" href="#2-work-stealing-pattern" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>graph TB
    subgraph "Worker 1"
        LQ1[Local Queue&lt;br/&gt;LIFO]
        LQ1 --&gt; T1[Task A&lt;br/&gt;bottom]
        LQ1 --&gt; T2[Task B]
        LQ1 --&gt; T3[Task C&lt;br/&gt;top]
    end

    subgraph "Worker 2"
        LQ2[Local Queue&lt;br/&gt;Empty]
        LQ2 --&gt; Steal[" Steal Mode"]
    end

    subgraph "Worker 3"
        LQ3[Local Queue&lt;br/&gt;LIFO]
        LQ3 --&gt; T4[Task D]
        LQ3 --&gt; T5[Task E]
    end

    Steal -.-&gt;|"Steal from top&lt;br/&gt;(FIFO)"| T3
    Steal -.-&gt;|"Try next victim"| T5

    T1 --&gt;|"Worker 1&lt;br/&gt;pops from bottom"| Process1[Process locally]
    T3 --&gt;|"Stolen by&lt;br/&gt;Worker 2"| Process2[Process stolen]

    style Steal fill:#ffeb3b
    style T3 fill:#ff9800
    style Process2 fill:#4caf50</code></pre>
<p><strong>Work-Stealing Workflow:</strong></p>
<pre class="mermaid"><code>flowchart LR
    Start[Worker needs task] --&gt; Check{Local queue&lt;br/&gt;empty?}
    Check --&gt;|No| Pop[Pop from bottom&lt;br/&gt;LIFO for cache locality]
    Check --&gt;|Yes| Victims[Select random victims]

    Victims --&gt; Try{Try steal from&lt;br/&gt;victim's top}
    Try --&gt;|Success| Got[Got task!]
    Try --&gt;|Failed| Next{More victims?}
    Next --&gt;|Yes| Try
    Next --&gt;|No| Wait[Wait/Idle]

    Pop --&gt; Process[Process task]
    Got --&gt; Process
    Process --&gt; Start</code></pre>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Benefit</th>
<th>Implementation Detail</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>No Central Coordinator</strong></td>
<td>Resilient, no SPOF</td>
<td>Workers manage themselves</td>
</tr>
<tr>
<td><strong>Automatic Load Balancing</strong></td>
<td>Efficient work distribution</td>
<td>Idle workers steal from busy ones</td>
</tr>
<tr>
<td><strong>Cache Locality</strong></td>
<td>Better performance</td>
<td>Process own tasks first (LIFO)</td>
</tr>
<tr>
<td><strong>Minimal Contention</strong></td>
<td>Reduced conflicts</td>
<td>Steal from opposite end (FIFO)</td>
</tr>
</tbody>
</table>
<h4 id="3-mapreduce-pattern">3. MapReduce Pattern<a class="headerlink" href="#3-mapreduce-pattern" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>graph TB
    subgraph "Input Phase"
        Input[Large Dataset] --&gt; Split[Split into Chunks]
        Split --&gt; C1[Chunk 1]
        Split --&gt; C2[Chunk 2]
        Split --&gt; C3[Chunk 3]
        Split --&gt; CN[Chunk N]
    end

    subgraph "Map Phase"
        C1 --&gt; M1[Mapper 1]
        C2 --&gt; M2[Mapper 2]
        C3 --&gt; M3[Mapper 3]
        CN --&gt; MN[Mapper N]

        M1 --&gt; KV1["(key1, val1)&lt;br/&gt;(key2, val2)"]
        M2 --&gt; KV2["(key1, val3)&lt;br/&gt;(key3, val4)"]
        M3 --&gt; KV3["(key2, val5)&lt;br/&gt;(key3, val6)"]
        MN --&gt; KVN["(key1, valN)&lt;br/&gt;(key2, valM)"]
    end

    subgraph "Shuffle &amp; Sort"
        KV1 --&gt; Shuffle[Group by Key]
        KV2 --&gt; Shuffle
        KV3 --&gt; Shuffle
        KVN --&gt; Shuffle

        Shuffle --&gt; G1["key1: [val1, val3, valN]"]
        Shuffle --&gt; G2["key2: [val2, val5, valM]"]
        Shuffle --&gt; G3["key3: [val4, val6]"]
    end

    subgraph "Reduce Phase"
        G1 --&gt; R1[Reducer 1]
        G2 --&gt; R2[Reducer 2]
        G3 --&gt; R3[Reducer 3]

        R1 --&gt; O1[Output 1]
        R2 --&gt; O2[Output 2]
        R3 --&gt; O3[Output 3]
    end

    style Input fill:#e3f2fd
    style Shuffle fill:#fff3e0
    style O1 fill:#c8e6c9
    style O2 fill:#c8e6c9
    style O3 fill:#c8e6c9
**MapReduce Implementation Flow:**

```mermaid
flowchart TB
    subgraph "Phase 1: Parallel Map Execution"
        Start[Input Data] --&gt; Split[Split into Chunks]
        Split --&gt; TP1[ThreadPool Executor&lt;br/&gt;max_workers=N]

        TP1 --&gt; W1[Worker 1&lt;br/&gt;map_phase]
        TP1 --&gt; W2[Worker 2&lt;br/&gt;map_phase]
        TP1 --&gt; W3[Worker 3&lt;br/&gt;map_phase]
        TP1 --&gt; WN[Worker N&lt;br/&gt;map_phase]

        W1 --&gt; F1[Future 1]
        W2 --&gt; F2[Future 2]
        W3 --&gt; F3[Future 3]
        WN --&gt; FN[Future N]

        F1 --&gt; Collect[as_completed()&lt;br/&gt;Collect Results]
        F2 --&gt; Collect
        F3 --&gt; Collect
        FN --&gt; Collect
    end

    subgraph "Phase 2: Shuffle &amp; Group"
        Collect --&gt; MR[Map Results&lt;br/&gt;[(k1,v1), (k2,v2), ...]]
        MR --&gt; Group[Group by Key&lt;br/&gt;defaultdict(list)]
        Group --&gt; K1[key1: [v1, v3, v5]]
        Group --&gt; K2[key2: [v2, v4]]
        Group --&gt; K3[key3: [v6, v7, v8]]
    end

    subgraph "Phase 3: Parallel Reduce"
        K1 --&gt; TP2[ThreadPool Executor&lt;br/&gt;max_workers=N]
        K2 --&gt; TP2
        K3 --&gt; TP2

        TP2 --&gt; R1[Reducer 1&lt;br/&gt;reduce_func]
        TP2 --&gt; R2[Reducer 2&lt;br/&gt;reduce_func]
        TP2 --&gt; R3[Reducer 3&lt;br/&gt;reduce_func]

        R1 --&gt; RF1[Future&lt;-&gt;Key Map]
        R2 --&gt; RF2[Future&lt;-&gt;Key Map]
        R3 --&gt; RF3[Future&lt;-&gt;Key Map]

        RF1 --&gt; Final[Final Results&lt;br/&gt;{k1: result1, k2: result2, ...}]
        RF2 --&gt; Final
        RF3 --&gt; Final
    end

    style Start fill:#e3f2fd
    style Group fill:#fff3e0
    style Final fill:#c8e6c9</code></pre>
<p><strong>MapReduce Phases Overview:</strong></p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Operation</th>
<th>Parallelism</th>
<th>Data Structure</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Map</strong></td>
<td><code>map_func(chunk)</code></td>
<td>ThreadPoolExecutor</td>
<td>List of chunks  List of (K,V) pairs</td>
<td>Transform data into key-value pairs</td>
</tr>
<tr>
<td><strong>Shuffle</strong></td>
<td>Group by key</td>
<td>Sequential</td>
<td>defaultdict(list)</td>
<td>Organize data by key for reduction</td>
</tr>
<tr>
<td><strong>Reduce</strong></td>
<td><code>reduce_func(key, values)</code></td>
<td>ThreadPoolExecutor</td>
<td>Dict of lists  Final results</td>
<td>Aggregate values for each key</td>
</tr>
</tbody>
</table>
<p><strong>Word Count Example Visualization:</strong></p>
<pre class="mermaid"><code>graph LR
    subgraph "Input Documents"
        D1["Hello world&lt;br/&gt;Hello Python"]
        D2["World of&lt;br/&gt;Python code"]
        D3["Hello code&lt;br/&gt;world"]
    end

    subgraph "Map Phase Output"
        D1 --&gt; M1["(hello, 1)&lt;br/&gt;(world, 1)&lt;br/&gt;(hello, 1)&lt;br/&gt;(python, 1)"]
        D2 --&gt; M2["(world, 1)&lt;br/&gt;(of, 1)&lt;br/&gt;(python, 1)&lt;br/&gt;(code, 1)"]
        D3 --&gt; M3["(hello, 1)&lt;br/&gt;(code, 1)&lt;br/&gt;(world, 1)"]
    end

    subgraph "Shuffle Phase Output"
        M1 --&gt; S1["hello: [1, 1, 1]"]
        M1 --&gt; S2["world: [1, 1, 1]"]
        M1 --&gt; S3["python: [1, 1]"]
        M2 --&gt; S2
        M2 --&gt; S3
        M2 --&gt; S4["of: [1]"]
        M2 --&gt; S5["code: [1, 1]"]
        M3 --&gt; S1
        M3 --&gt; S2
        M3 --&gt; S5
    end

    subgraph "Reduce Phase Output"
        S1 --&gt; R1["hello: 3"]
        S2 --&gt; R2["world: 3"]
        S3 --&gt; R3["python: 2"]
        S4 --&gt; R4["of: 1"]
        S5 --&gt; R5["code: 2"]
    end

    style D1 fill:#e3f2fd
    style D2 fill:#e3f2fd
    style D3 fill:#e3f2fd
    style R1 fill:#c8e6c9
    style R2 fill:#c8e6c9
    style R3 fill:#c8e6c9
    style R4 fill:#c8e6c9
    style R5 fill:#c8e6c9</code></pre>
<p><strong>MapReduce Usage Pattern:</strong></p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Function</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. <strong>Define Map</strong></td>
<td><code>word_count_map(doc)</code></td>
<td>Emit (key, value) pairs</td>
<td><code>yield (word.lower(), 1)</code></td>
</tr>
<tr>
<td>2. <strong>Define Reduce</strong></td>
<td><code>word_count_reduce(word, counts)</code></td>
<td>Aggregate values per key</td>
<td><code>return sum(counts)</code></td>
</tr>
<tr>
<td>3. <strong>Create Job</strong></td>
<td><code>MapReduceJob(map_func, reduce_func)</code></td>
<td>Initialize with functions</td>
<td>Configures the pipeline</td>
</tr>
<tr>
<td>4. <strong>Execute</strong></td>
<td><code>job.run(documents, num_workers=10)</code></td>
<td>Process data in parallel</td>
<td>Returns final results dict</td>
</tr>
</tbody>
</table>
<h3 id="the-coordination-tax">The Coordination Tax<a class="headerlink" href="#the-coordination-tax" title="Permanent link">&para;</a></h3>
<p>Every distributed system pays a coordination tax:</p>
<h3 id="load-balancing-strategies">Load Balancing Strategies<a class="headerlink" href="#load-balancing-strategies" title="Permanent link">&para;</a></h3>
<hr />
<h2 id="expert-theory-and-advanced-techniques-45-min-read"> Expert: Theory and Advanced Techniques (45 min read)<a class="headerlink" href="#expert-theory-and-advanced-techniques-45-min-read" title="Permanent link">&para;</a></h2>
<h3 id="theoretical-foundations">Theoretical Foundations<a class="headerlink" href="#theoretical-foundations" title="Permanent link">&para;</a></h3>
<h4 id="universal-scalability-law">Universal Scalability Law<a class="headerlink" href="#universal-scalability-law" title="Permanent link">&para;</a></h4>
<p>Neil Gunther's USL extends Amdahl's Law to include coherency costs:</p>
<div class="formula-box">
<h4>Universal Scalability Law (USL)</h4>
<div style="text-align: center; font-size: 1.2em; margin: 20px 0;">
<strong>C(N) = N / (1 + (N-1) + N(N-1))</strong>
</div>
<table style="margin: 20px auto;">
<tr>
<td><strong>C(N)</strong></td>
<td>=</td>
<td>Capacity/throughput with N processors</td>
</tr>
<tr>
<td><strong></strong></td>
<td>=</td>
<td>Contention coefficient (serialization)</td>
</tr>
<tr>
<td><strong></strong></td>
<td>=</td>
<td>Coherency coefficient (coordination)</td>
</tr>
</table>
</div>

<p><strong>Visual Scalability Analysis</strong>:</p>
<div class="scalability-chart">
<table class="workload-comparison">
<thead>
<tr>
<th>Workload Type</th>
<th> (Contention)</th>
<th> (Coherency)</th>
<th>Optimal Workers</th>
<th>Max Speedup</th>
<th>Scalability Curve</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Embarrassingly Parallel</strong></td>
<td>0.01</td>
<td>0.0001</td>
<td>~100</td>
<td>~50x</td>
<td>
<div class="mini-chart">
<span style="color: #4CAF50;"></span> Near-linear scaling
</div>
</td>
</tr>
<tr>
<td><strong>Moderate Coordination</strong></td>
<td>0.05</td>
<td>0.001</td>
<td>~32</td>
<td>~16x</td>
<td>
<div class="mini-chart">
<span style="color: #FFC107;"></span> Good scaling, then plateau
</div>
</td>
</tr>
<tr>
<td><strong>High Contention</strong></td>
<td>0.1</td>
<td>0.01</td>
<td>~10</td>
<td>~5x</td>
<td>
<div class="mini-chart">
<span style="color: #FF5722;"></span> Limited scaling
</div>
</td>
</tr>
<tr>
<td><strong>Extreme Coordination</strong></td>
<td>0.2</td>
<td>0.02</td>
<td>~5</td>
<td>~2.5x</td>
<td>
<div class="mini-chart">
<span style="color: #F44336;"></span> Poor scaling
</div>
</td>
</tr>
</tbody>
</table>
</div>

<div class="insight-box">
<strong>Key Insights:</strong>
<ul>
<li>Adding workers beyond the optimal point <em>decreases</em> total throughput</li>
<li>Contention () limits maximum useful parallelism</li>
<li>Coherency () causes retrograde scaling at high worker counts</li>
<li>Most real systems exhibit both effects to varying degrees</li>
</ul>
</div>
<h4 id="queue-theory-for-work-distribution">Queue Theory for Work Distribution<a class="headerlink" href="#queue-theory-for-work-distribution" title="Permanent link">&para;</a></h4>
<p>Little's Law provides fundamental insights:</p>
<div class="formula-box">
<h4>Little's Law</h4>
<div style="text-align: center; font-size: 1.2em; margin: 20px 0;">
<strong>L = W</strong>
</div>
<table style="margin: 20px auto;">
<tr>
<td><strong>L</strong></td>
<td>=</td>
<td>Average number of items in system</td>
</tr>
<tr>
<td><strong></strong></td>
<td>=</td>
<td>Average arrival rate</td>
</tr>
<tr>
<td><strong>W</strong></td>
<td>=</td>
<td>Average time in system</td>
</tr>
</table>
</div>

<p><strong>Applied to Work Queues:</strong></p>
<div class="queue-metrics">
<table class="metrics-table">
<thead>
<tr>
<th>Metric</th>
<th>Formula</th>
<th>Meaning</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Arrival Rate ()</strong></td>
<td>requests / time</td>
<td>How fast work arrives</td>
<td>Capacity planning</td>
</tr>
<tr>
<td><strong>Service Rate ()</strong></td>
<td>completions / time</td>
<td>How fast work completes</td>
<td>Performance tuning</td>
</tr>
<tr>
<td><strong>Utilization ()</strong></td>
<td> / </td>
<td>Fraction of time busy</td>
<td>Efficiency monitoring</td>
</tr>
<tr>
<td><strong>Queue Length (L)</strong></td>
<td>  W</td>
<td>Average items waiting</td>
<td>Buffer sizing</td>
</tr>
<tr>
<td><strong>Wait Time</strong></td>
<td> / (  (1 - ))</td>
<td>Time in queue (M/M/1)</td>
<td>SLA compliance</td>
</tr>
</tbody>
</table>
</div>

<div class="warning-box">
<strong>Queue Saturation Effects:</strong>
<div style="margin: 10px 0;">
<table class="saturation-effects">
<tr>
<td><strong>Utilization</strong></td>
<td><strong>Wait Time</strong></td>
<td><strong>Behavior</strong></td>
</tr>
<tr>
<td>50%</td>
<td>1x service time</td>
<td>Responsive system</td>
</tr>
<tr>
<td>75%</td>
<td>3x service time</td>
<td>Noticeable delays</td>
</tr>
<tr>
<td>90%</td>
<td>9x service time</td>
<td>Severe queueing</td>
</tr>
<tr>
<td>95%</td>
<td>19x service time</td>
<td>Near collapse</td>
</tr>
<tr>
<td>99%</td>
<td>99x service time</td>
<td>System breakdown</td>
</tr>
</table>
</div>
</div>
<h3 id="advanced-work-distribution-algorithms">Advanced Work Distribution Algorithms<a class="headerlink" href="#advanced-work-distribution-algorithms" title="Permanent link">&para;</a></h3>
<h4 id="consistent-hashing-with-virtual-nodes">Consistent Hashing with Virtual Nodes<a class="headerlink" href="#consistent-hashing-with-virtual-nodes" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>graph TB
    subgraph "Consistent Hash Ring"
        A[Hash Ring 0-2^32] 

        N1[Node 1] --&gt; V1[Virtual 1:0]
        N1 --&gt; V2[Virtual 1:1]
        N1 --&gt; V3[Virtual 1:149]

        N2[Node 2] --&gt; V4[Virtual 2:0]
        N2 --&gt; V5[Virtual 2:1]
        N2 --&gt; V6[Virtual 2:149]

        N3[Node 3] --&gt; V7[Virtual 3:0]
        N3 --&gt; V8[Virtual 3:1]
        N3 --&gt; V9[Virtual 3:149]

        V1 -.-&gt;|Hash: 0x1234| A
        V2 -.-&gt;|Hash: 0x5678| A
        V4 -.-&gt;|Hash: 0x9ABC| A
        V7 -.-&gt;|Hash: 0xDEF0| A

        K[Key "user123"] --&gt;|Hash: 0x7890| A
        A --&gt;|Binary Search| V4
        V4 --&gt;|Maps to| N2
    end

    style N1 fill:#e3f2fd
    style N2 fill:#e8f5e9
    style N3 fill:#fff3e0
    style K fill:#ffebee</code></pre>
<div class="truth-box">
<h4>Consistent Hashing Algorithm Flow</h4>

<b>Ring Construction:</b>
<ol>
<li>For each physical node, create 150 virtual nodes</li>
<li>Hash each virtual node: hash("node:index")</li>
<li>Place virtual nodes on ring at hash positions</li>
<li>Sort all hash values for binary search</li>
</ol>

<b>Key Lookup Process:</b>
<ol>
<li>Hash the key to get position on ring</li>
<li>Binary search for first node  hash</li>
<li>If past end, wrap to beginning</li>
<li>Return physical node mapped to virtual node</li>
</ol>

<b>Node Operations:</b>
<table>
<tr><th>Operation</th><th>Impact</th><th>Keys Moved</th></tr>
<tr><td>Add Node</td><td>Only keys between new node and next node</td><td>~1/N of total</td></tr>
<tr><td>Remove Node</td><td>Only keys on removed node move to next</td><td>~1/N of total</td></tr>
<tr><td>Replication</td><td>Walk ring clockwise for N unique nodes</td><td>No movement</td></tr>
</table>
</div>
<h4 id="two-phase-commit-for-distributed-work">Two-Phase Commit for Distributed Work<a class="headerlink" href="#two-phase-commit-for-distributed-work" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>sequenceDiagram
    participant C as Coordinator
    participant L as TX Log
    participant P1 as Participant 1
    participant P2 as Participant 2
    participant P3 as Participant 3

    Note over C,P3: Phase 1: Voting Phase

    C-&gt;&gt;L: Log: TX_START
    C-&gt;&gt;P1: PREPARE(tx_id, work_1)
    C-&gt;&gt;P2: PREPARE(tx_id, work_2)
    C-&gt;&gt;P3: PREPARE(tx_id, work_3)

    P1--&gt;&gt;C: VOTE_COMMIT
    C-&gt;&gt;L: Log: P1 VOTED_YES
    P2--&gt;&gt;C: VOTE_COMMIT
    C-&gt;&gt;L: Log: P2 VOTED_YES
    P3--&gt;&gt;C: VOTE_ABORT
    C-&gt;&gt;L: Log: P3 VOTED_NO

    Note over C: Decision Point
    C-&gt;&gt;L: Log: GLOBAL_ABORT

    Note over C,P3: Phase 2: Completion Phase

    C-&gt;&gt;P1: ABORT
    P1--&gt;&gt;C: ACK_ABORT
    C-&gt;&gt;L: Log: P1 ABORTED

    C-&gt;&gt;P2: ABORT
    P2--&gt;&gt;C: ACK_ABORT
    C-&gt;&gt;L: Log: P2 ABORTED

    C-&gt;&gt;P3: ABORT
    P3--&gt;&gt;C: ACK_ABORT
    C-&gt;&gt;L: Log: P3 ABORTED

    C-&gt;&gt;L: Log: TX_COMPLETE</code></pre>
<div class="axiom-box">
<h4>Two-Phase Commit Protocol</h4>

<b>Protocol Guarantees:</b>
<ul>
<li><b>Atomicity:</b> All participants commit or all abort</li>
<li><b>Consistency:</b> No partial state changes</li>
<li><b>Durability:</b> Decisions survive crashes via TX log</li>
</ul>

<b>Failure Scenarios:</b>
<table>
<tr><th>When</th><th>Who Fails</th><th>Recovery Action</th></tr>
<tr><td>Before Vote</td><td>Participant</td><td>Coordinator timeouts, aborts transaction</td></tr>
<tr><td>After Vote</td><td>Participant</td><td>Participant must honor vote when recovers</td></tr>
<tr><td>Before Decision</td><td>Coordinator</td><td>Participants timeout, run termination protocol</td></tr>
<tr><td>After Decision</td><td>Coordinator</td><td>Participants read decision from TX log</td></tr>
</table>

<b>Blocking Problem:</b> If coordinator fails after prepare but before decision, participants must wait (blocked) until coordinator recovers.
</div>
<h3 id="research-frontiers">Research Frontiers<a class="headerlink" href="#research-frontiers" title="Permanent link">&para;</a></h3>
<h4 id="speculative-execution">Speculative Execution<a class="headerlink" href="#speculative-execution" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>flowchart LR
    subgraph "Speculative Execution Flow"
        A[Primary Work] --&gt; B{Predict Branches}
        B --&gt;|P=0.7| C[Branch A]
        B --&gt;|P=0.2| D[Branch B]
        B --&gt;|P=0.1| E[Branch C]

        C --&gt;|Execute| F[Future A]
        D --&gt;|Skip P&lt;0.3| G[Not Executed]
        E --&gt;|Skip P&lt;0.3| H[Not Executed]

        A --&gt; I[Primary Result]
        I --&gt; J{Determine Actual Branch}

        J --&gt;|Branch A| K[Hit! Use Future A]
        J --&gt;|Branch B| L[Miss! Execute Now]

        F -.-&gt;|Cancel| M[Canceled Work]
    end

    style C fill:#c8e6c9
    style K fill:#81c784
    style L fill:#ffcdd2
    style M fill:#ffab91</code></pre>
<div class="decision-box">
<h4>Speculative Execution Strategy</h4>

<b>When to Use Speculation:</b>
<ul>
<li>Branch prediction accuracy > 60%</li>
<li>Speculative work cost < 30% of sequential execution</li>
<li>Idle resources available</li>
<li>Work is safely cancellable</li>
</ul>

<b>Cost-Benefit Analysis:</b>
<table>
<tr><th>Metric</th><th>Formula</th><th>Good Threshold</th></tr>
<tr><td>Hit Rate</td><td>correct_predictions / total</td><td>> 0.6</td></tr>
<tr><td>Speedup</td><td>sequential_time / speculative_time</td><td>> 1.5x</td></tr>
<tr><td>Waste Ratio</td><td>canceled_work / total_work</td><td>< 0.3</td></tr>
<tr><td>ROI</td><td>(time_saved - time_wasted) / time_wasted</td><td>> 1.0</td></tr>
</table>
</div>
<hr />
<h2 id="mastery-building-production-work-systems-60-min-read"> Mastery: Building Production Work Systems (60+ min read)<a class="headerlink" href="#mastery-building-production-work-systems-60-min-read" title="Permanent link">&para;</a></h2>
<h3 id="complete-implementation-distributed-task-scheduler">Complete Implementation: Distributed Task Scheduler<a class="headerlink" href="#complete-implementation-distributed-task-scheduler" title="Permanent link">&para;</a></h3>
<p>Let's build a production-grade distributed task scheduler:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Task Scheduler Architecture"
        subgraph "Core Components"
            TS[Task Scheduler]
            R[Redis]
            M[Monitoring System]
            DD[Deadlock Detector]
        end

        subgraph "Worker Pool"
            W1[Worker 1&lt;br/&gt;Local Queue]
            W2[Worker 2&lt;br/&gt;Local Queue]
            W3[Worker N&lt;br/&gt;Local Queue]
        end

        subgraph "Priority Queues"
            HQ[High Priority Queue]
            NQ[Normal Priority Queue]
            LQ[Low Priority Queue]
        end

        subgraph "Task Lifecycle"
            PEND[PENDING]
            RUN[RUNNING]
            COMP[COMPLETED]
            FAIL[FAILED]
            RETRY[RETRYING]
        end
    end

    Client --&gt;|Submit Task| TS
    TS --&gt;|Store| R
    TS --&gt;|Queue by Priority| HQ &amp; NQ &amp; LQ

    W1 &amp; W2 &amp; W3 --&gt;|Pull Tasks| HQ &amp; NQ &amp; LQ
    W1 -.-&gt;|Work Stealing| W2
    W2 -.-&gt;|Work Stealing| W3

    W1 &amp; W2 &amp; W3 --&gt;|Update Status| R
    DD --&gt;|Check Timeouts| R
    DD --&gt;|Requeue Failed| HQ &amp; NQ &amp; LQ

    M --&gt;|Collect Metrics| W1 &amp; W2 &amp; W3
    M --&gt;|Report| TS

    PEND --&gt;|Worker Claims| RUN
    RUN --&gt;|Success| COMP
    RUN --&gt;|Failure| FAIL
    FAIL --&gt;|Retry Available| RETRY
    RETRY --&gt;|Requeue| PEND

    style TS fill:#e3f2fd
    style R fill:#ffebee
    style M fill:#f3e5f5
    style COMP fill:#c8e6c9
    style FAIL fill:#ffcdd2</code></pre>
<div class="truth-box">
<h4>Distributed Task Scheduler Implementation</h4>

<b>Task State Machine:</b>
<pre>
PENDING  RUNNING  COMPLETED
            
     FAILED  RETRYING
                     
      (exhausted)  PENDING
</pre>

<b>Key Features:</b>
<table>
<tr><th>Feature</th><th>Implementation</th><th>Benefit</th></tr>
<tr><td><b>Priority Scheduling</b></td><td>3 queues (high/normal/low)</td><td>Important work processed first</td></tr>
<tr><td><b>Work Stealing</b></td><td>Steal when queue > threshold</td><td>Better load distribution</td></tr>
<tr><td><b>Automatic Retries</b></td><td>Configurable max retries</td><td>Resilience to transient failures</td></tr>
<tr><td><b>Deadlock Detection</b></td><td>30s periodic timeout check</td><td>Prevents stuck tasks</td></tr>
<tr><td><b>Local Queues</b></td><td>Per-worker task buffer</td><td>Reduces Redis contention</td></tr>
</table>

<b>Performance Optimizations:</b>
<ul>
<li><b>Batch Fetching:</b> Workers grab multiple tasks at once</li>
<li><b>Local Caching:</b> Reduce Redis roundtrips</li>
<li><b>Binary Search:</b> Efficient task insertion in sorted queues</li>
<li><b>Async I/O:</b> Non-blocking Redis operations</li>
</ul>
</div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Task States and Core Data Structures</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">TaskState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">PENDING</span> <span class="o">=</span> <span class="s2">&quot;pending&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">RUNNING</span> <span class="o">=</span> <span class="s2">&quot;running&quot;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">&quot;failed&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">RETRYING</span> <span class="o">=</span> <span class="s2">&quot;retrying&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="nd">@dataclass</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Task</span><span class="p">:</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="n">created_at</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">started_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">completed_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="n">retry_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="n">state</span><span class="p">:</span> <span class="n">TaskState</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">PENDING</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="n">worker_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    <span class="n">result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="c1"># For priority queue (higher priority = lower number)</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">priority</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="k">class</span><span class="w"> </span><span class="nc">DistributedTaskScheduler</span><span class="p">:</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="sd">    Production-grade distributed task scheduler with:</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="sd">    - Priority scheduling</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="sd">    - Work stealing</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="sd">    - Automatic retries</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="sd">    - Deadlock detection</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="sd">    - Performance monitoring</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">worker_pool_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis_url</span> <span class="o">=</span> <span class="n">redis_url</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">worker_pool_size</span> <span class="o">=</span> <span class="n">worker_pool_size</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;Worker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_handlers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span> <span class="o">=</span> <span class="n">MonitoringSystem</span><span class="p">()</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the scheduler and workers&quot;&quot;&quot;</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aioredis</span><span class="o">.</span><span class="n">create_redis_pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redis_url</span><span class="p">)</span>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>        <span class="c1"># Start workers</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker_pool_size</span><span class="p">):</span>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a>            <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a>                <span class="n">worker_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;worker-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a>                <span class="n">scheduler</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a>                <span class="n">steal_threshold</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a>            <span class="p">)</span>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">[</span><span class="n">worker</span><span class="o">.</span><span class="n">worker_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">worker</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">())</span>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>        <span class="c1"># Start monitoring</span>
</span><span id="__span-2-68"><a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a>        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span><span class="o">.</span><span class="n">run</span><span class="p">())</span>
</span><span id="__span-2-69"><a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a>
</span><span id="__span-2-70"><a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a>        <span class="c1"># Start deadlock detector</span>
</span><span id="__span-2-71"><a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a>        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deadlock_detector</span><span class="p">())</span>
</span><span id="__span-2-72"><a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a>
</span><span id="__span-2-73"><a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scheduler started with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">worker_pool_size</span><span class="si">}</span><span class="s2"> workers&quot;</span><span class="p">)</span>
</span><span id="__span-2-74"><a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a>
</span><span id="__span-2-75"><a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
</span><span id="__span-2-76"><a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a task handler function&quot;&quot;&quot;</span>
</span><span id="__span-2-77"><a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_handlers</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
</span><span id="__span-2-78"><a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a>
</span><span id="__span-2-79"><a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">submit_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-2-80"><a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit a task for execution&quot;&quot;&quot;</span>
</span><span id="__span-2-81"><a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a>        <span class="c1"># Store task in Redis</span>
</span><span id="__span-2-82"><a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a>        <span class="n">task_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-83"><a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;task:</span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="n">task_data</span><span class="p">)</span>
</span><span id="__span-2-84"><a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a>
</span><span id="__span-2-85"><a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a>        <span class="c1"># Add to appropriate queue based on priority</span>
</span><span id="__span-2-86"><a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a>        <span class="n">queue_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_queue_name</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
</span><span id="__span-2-87"><a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">zadd</span><span class="p">(</span><span class="n">queue_name</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-2-88"><a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a>
</span><span id="__span-2-89"><a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a>        <span class="c1"># Notify monitoring</span>
</span><span id="__span-2-90"><a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span><span class="o">.</span><span class="n">record_task_submitted</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-91"><a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a>
</span><span id="__span-2-92"><a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> submitted with priority </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-93"><a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a>        <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">id</span>
</span><span id="__span-2-94"><a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a>
</span><span id="__span-2-95"><a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_task_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
</span><span id="__span-2-96"><a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current status of a task&quot;&quot;&quot;</span>
</span><span id="__span-2-97"><a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a>        <span class="n">task_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;task:</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-98"><a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_data</span><span class="p">:</span>
</span><span id="__span-2-99"><a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-2-100"><a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_task</span><span class="p">(</span><span class="n">task_data</span><span class="p">)</span>
</span><span id="__span-2-101"><a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a>
</span><span id="__span-2-102"><a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_queue_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-2-103"><a id="__codelineno-2-103" name="__codelineno-2-103" href="#__codelineno-2-103"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get queue name based on priority&quot;&quot;&quot;</span>
</span><span id="__span-2-104"><a id="__codelineno-2-104" name="__codelineno-2-104" href="#__codelineno-2-104"></a>        <span class="k">if</span> <span class="n">priority</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-2-105"><a id="__codelineno-2-105" name="__codelineno-2-105" href="#__codelineno-2-105"></a>            <span class="k">return</span> <span class="s2">&quot;queue:high&quot;</span>
</span><span id="__span-2-106"><a id="__codelineno-2-106" name="__codelineno-2-106" href="#__codelineno-2-106"></a>        <span class="k">elif</span> <span class="n">priority</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-2-107"><a id="__codelineno-2-107" name="__codelineno-2-107" href="#__codelineno-2-107"></a>            <span class="k">return</span> <span class="s2">&quot;queue:normal&quot;</span>
</span><span id="__span-2-108"><a id="__codelineno-2-108" name="__codelineno-2-108" href="#__codelineno-2-108"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-109"><a id="__codelineno-2-109" name="__codelineno-2-109" href="#__codelineno-2-109"></a>            <span class="k">return</span> <span class="s2">&quot;queue:low&quot;</span>
</span><span id="__span-2-110"><a id="__codelineno-2-110" name="__codelineno-2-110" href="#__codelineno-2-110"></a>
</span><span id="__span-2-111"><a id="__codelineno-2-111" name="__codelineno-2-111" href="#__codelineno-2-111"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-2-112"><a id="__codelineno-2-112" name="__codelineno-2-112" href="#__codelineno-2-112"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize task for Redis storage&quot;&quot;&quot;</span>
</span><span id="__span-2-113"><a id="__codelineno-2-113" name="__codelineno-2-113" href="#__codelineno-2-113"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-2-114"><a id="__codelineno-2-114" name="__codelineno-2-114" href="#__codelineno-2-114"></a>            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-2-115"><a id="__codelineno-2-115" name="__codelineno-2-115" href="#__codelineno-2-115"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-2-116"><a id="__codelineno-2-116" name="__codelineno-2-116" href="#__codelineno-2-116"></a>            <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">payload</span><span class="p">),</span>
</span><span id="__span-2-117"><a id="__codelineno-2-117" name="__codelineno-2-117" href="#__codelineno-2-117"></a>            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">priority</span><span class="p">),</span>
</span><span id="__span-2-118"><a id="__codelineno-2-118" name="__codelineno-2-118" href="#__codelineno-2-118"></a>            <span class="s1">&#39;max_retries&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">max_retries</span><span class="p">),</span>
</span><span id="__span-2-119"><a id="__codelineno-2-119" name="__codelineno-2-119" href="#__codelineno-2-119"></a>            <span class="s1">&#39;timeout_seconds&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="p">),</span>
</span><span id="__span-2-120"><a id="__codelineno-2-120" name="__codelineno-2-120" href="#__codelineno-2-120"></a>            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">created_at</span><span class="p">),</span>
</span><span id="__span-2-121"><a id="__codelineno-2-121" name="__codelineno-2-121" href="#__codelineno-2-121"></a>            <span class="s1">&#39;started_at&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">started_at</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="__span-2-122"><a id="__codelineno-2-122" name="__codelineno-2-122" href="#__codelineno-2-122"></a>            <span class="s1">&#39;completed_at&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">completed_at</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="__span-2-123"><a id="__codelineno-2-123" name="__codelineno-2-123" href="#__codelineno-2-123"></a>            <span class="s1">&#39;retry_count&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">retry_count</span><span class="p">),</span>
</span><span id="__span-2-124"><a id="__codelineno-2-124" name="__codelineno-2-124" href="#__codelineno-2-124"></a>            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="__span-2-125"><a id="__codelineno-2-125" name="__codelineno-2-125" href="#__codelineno-2-125"></a>            <span class="s1">&#39;worker_id&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">worker_id</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="__span-2-126"><a id="__codelineno-2-126" name="__codelineno-2-126" href="#__codelineno-2-126"></a>            <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="__span-2-127"><a id="__codelineno-2-127" name="__codelineno-2-127" href="#__codelineno-2-127"></a>            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">error</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
</span><span id="__span-2-128"><a id="__codelineno-2-128" name="__codelineno-2-128" href="#__codelineno-2-128"></a>        <span class="p">}</span>
</span><span id="__span-2-129"><a id="__codelineno-2-129" name="__codelineno-2-129" href="#__codelineno-2-129"></a>
</span><span id="__span-2-130"><a id="__codelineno-2-130" name="__codelineno-2-130" href="#__codelineno-2-130"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_deserialize_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
</span><span id="__span-2-131"><a id="__codelineno-2-131" name="__codelineno-2-131" href="#__codelineno-2-131"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deserialize task from Redis&quot;&quot;&quot;</span>
</span><span id="__span-2-132"><a id="__codelineno-2-132" name="__codelineno-2-132" href="#__codelineno-2-132"></a>        <span class="k">return</span> <span class="n">Task</span><span class="p">(</span>
</span><span id="__span-2-133"><a id="__codelineno-2-133" name="__codelineno-2-133" href="#__codelineno-2-133"></a>            <span class="nb">id</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
</span><span id="__span-2-134"><a id="__codelineno-2-134" name="__codelineno-2-134" href="#__codelineno-2-134"></a>            <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
</span><span id="__span-2-135"><a id="__codelineno-2-135" name="__codelineno-2-135" href="#__codelineno-2-135"></a>            <span class="n">payload</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;payload&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-136"><a id="__codelineno-2-136" name="__codelineno-2-136" href="#__codelineno-2-136"></a>            <span class="n">priority</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-137"><a id="__codelineno-2-137" name="__codelineno-2-137" href="#__codelineno-2-137"></a>            <span class="n">max_retries</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;max_retries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-138"><a id="__codelineno-2-138" name="__codelineno-2-138" href="#__codelineno-2-138"></a>            <span class="n">timeout_seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;timeout_seconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-139"><a id="__codelineno-2-139" name="__codelineno-2-139" href="#__codelineno-2-139"></a>            <span class="n">created_at</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-140"><a id="__codelineno-2-140" name="__codelineno-2-140" href="#__codelineno-2-140"></a>            <span class="n">started_at</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;started_at&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;started_at&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-2-141"><a id="__codelineno-2-141" name="__codelineno-2-141" href="#__codelineno-2-141"></a>            <span class="n">completed_at</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;completed_at&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;completed_at&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-2-142"><a id="__codelineno-2-142" name="__codelineno-2-142" href="#__codelineno-2-142"></a>            <span class="n">retry_count</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;retry_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-143"><a id="__codelineno-2-143" name="__codelineno-2-143" href="#__codelineno-2-143"></a>            <span class="n">state</span><span class="o">=</span><span class="n">TaskState</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
</span><span id="__span-2-144"><a id="__codelineno-2-144" name="__codelineno-2-144" href="#__codelineno-2-144"></a>            <span class="n">worker_id</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;worker_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-2-145"><a id="__codelineno-2-145" name="__codelineno-2-145" href="#__codelineno-2-145"></a>            <span class="n">result</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-2-146"><a id="__codelineno-2-146" name="__codelineno-2-146" href="#__codelineno-2-146"></a>            <span class="n">error</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="__span-2-147"><a id="__codelineno-2-147" name="__codelineno-2-147" href="#__codelineno-2-147"></a>        <span class="p">)</span>
</span><span id="__span-2-148"><a id="__codelineno-2-148" name="__codelineno-2-148" href="#__codelineno-2-148"></a>
</span><span id="__span-2-149"><a id="__codelineno-2-149" name="__codelineno-2-149" href="#__codelineno-2-149"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_deadlock_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-150"><a id="__codelineno-2-150" name="__codelineno-2-150" href="#__codelineno-2-150"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect and recover from deadlocks&quot;&quot;&quot;</span>
</span><span id="__span-2-151"><a id="__codelineno-2-151" name="__codelineno-2-151" href="#__codelineno-2-151"></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
</span><span id="__span-2-152"><a id="__codelineno-2-152" name="__codelineno-2-152" href="#__codelineno-2-152"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Check every 30 seconds</span>
</span><span id="__span-2-153"><a id="__codelineno-2-153" name="__codelineno-2-153" href="#__codelineno-2-153"></a>
</span><span id="__span-2-154"><a id="__codelineno-2-154" name="__codelineno-2-154" href="#__codelineno-2-154"></a>            <span class="c1"># Find tasks that have been running too long</span>
</span><span id="__span-2-155"><a id="__codelineno-2-155" name="__codelineno-2-155" href="#__codelineno-2-155"></a>            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-2-156"><a id="__codelineno-2-156" name="__codelineno-2-156" href="#__codelineno-2-156"></a>
</span><span id="__span-2-157"><a id="__codelineno-2-157" name="__codelineno-2-157" href="#__codelineno-2-157"></a>            <span class="c1"># Get all running tasks</span>
</span><span id="__span-2-158"><a id="__codelineno-2-158" name="__codelineno-2-158" href="#__codelineno-2-158"></a>            <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;task:*&quot;</span>
</span><span id="__span-2-159"><a id="__codelineno-2-159" name="__codelineno-2-159" href="#__codelineno-2-159"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;0&#39;</span>
</span><span id="__span-2-160"><a id="__codelineno-2-160" name="__codelineno-2-160" href="#__codelineno-2-160"></a>
</span><span id="__span-2-161"><a id="__codelineno-2-161" name="__codelineno-2-161" href="#__codelineno-2-161"></a>            <span class="k">while</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="__span-2-162"><a id="__codelineno-2-162" name="__codelineno-2-162" href="#__codelineno-2-162"></a>                <span class="n">cursor</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
</span><span id="__span-2-163"><a id="__codelineno-2-163" name="__codelineno-2-163" href="#__codelineno-2-163"></a>
</span><span id="__span-2-164"><a id="__codelineno-2-164" name="__codelineno-2-164" href="#__codelineno-2-164"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="__span-2-165"><a id="__codelineno-2-165" name="__codelineno-2-165" href="#__codelineno-2-165"></a>                    <span class="n">task_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-2-166"><a id="__codelineno-2-166" name="__codelineno-2-166" href="#__codelineno-2-166"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">task_data</span><span class="p">:</span>
</span><span id="__span-2-167"><a id="__codelineno-2-167" name="__codelineno-2-167" href="#__codelineno-2-167"></a>                        <span class="k">continue</span>
</span><span id="__span-2-168"><a id="__codelineno-2-168" name="__codelineno-2-168" href="#__codelineno-2-168"></a>
</span><span id="__span-2-169"><a id="__codelineno-2-169" name="__codelineno-2-169" href="#__codelineno-2-169"></a>                    <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_task</span><span class="p">(</span><span class="n">task_data</span><span class="p">)</span>
</span><span id="__span-2-170"><a id="__codelineno-2-170" name="__codelineno-2-170" href="#__codelineno-2-170"></a>
</span><span id="__span-2-171"><a id="__codelineno-2-171" name="__codelineno-2-171" href="#__codelineno-2-171"></a>                    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">RUNNING</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">started_at</span><span class="p">:</span>
</span><span id="__span-2-172"><a id="__codelineno-2-172" name="__codelineno-2-172" href="#__codelineno-2-172"></a>                        <span class="n">runtime</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">task</span><span class="o">.</span><span class="n">started_at</span>
</span><span id="__span-2-173"><a id="__codelineno-2-173" name="__codelineno-2-173" href="#__codelineno-2-173"></a>
</span><span id="__span-2-174"><a id="__codelineno-2-174" name="__codelineno-2-174" href="#__codelineno-2-174"></a>                        <span class="k">if</span> <span class="n">runtime</span> <span class="o">&gt;</span> <span class="n">task</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="p">:</span>
</span><span id="__span-2-175"><a id="__codelineno-2-175" name="__codelineno-2-175" href="#__codelineno-2-175"></a>                            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> timeout after </span><span class="si">{</span><span class="n">runtime</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="__span-2-176"><a id="__codelineno-2-176" name="__codelineno-2-176" href="#__codelineno-2-176"></a>
</span><span id="__span-2-177"><a id="__codelineno-2-177" name="__codelineno-2-177" href="#__codelineno-2-177"></a>                            <span class="c1"># Mark as failed and requeue if retries remain</span>
</span><span id="__span-2-178"><a id="__codelineno-2-178" name="__codelineno-2-178" href="#__codelineno-2-178"></a>                            <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">FAILED</span>
</span><span id="__span-2-179"><a id="__codelineno-2-179" name="__codelineno-2-179" href="#__codelineno-2-179"></a>                            <span class="n">task</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Timeout after </span><span class="si">{</span><span class="n">runtime</span><span class="si">}</span><span class="s2">s&quot;</span>
</span><span id="__span-2-180"><a id="__codelineno-2-180" name="__codelineno-2-180" href="#__codelineno-2-180"></a>
</span><span id="__span-2-181"><a id="__codelineno-2-181" name="__codelineno-2-181" href="#__codelineno-2-181"></a>                            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">task</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
</span><span id="__span-2-182"><a id="__codelineno-2-182" name="__codelineno-2-182" href="#__codelineno-2-182"></a>                                <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">RETRYING</span>
</span><span id="__span-2-183"><a id="__codelineno-2-183" name="__codelineno-2-183" href="#__codelineno-2-183"></a>                                <span class="n">task</span><span class="o">.</span><span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-184"><a id="__codelineno-2-184" name="__codelineno-2-184" href="#__codelineno-2-184"></a>                                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-185"><a id="__codelineno-2-185" name="__codelineno-2-185" href="#__codelineno-2-185"></a>
</span><span id="__span-2-186"><a id="__codelineno-2-186" name="__codelineno-2-186" href="#__codelineno-2-186"></a>                            <span class="c1"># Update task state</span>
</span><span id="__span-2-187"><a id="__codelineno-2-187" name="__codelineno-2-187" href="#__codelineno-2-187"></a>                            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span>
</span><span id="__span-2-188"><a id="__codelineno-2-188" name="__codelineno-2-188" href="#__codelineno-2-188"></a>                                <span class="sa">f</span><span class="s2">&quot;task:</span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-2-189"><a id="__codelineno-2-189" name="__codelineno-2-189" href="#__codelineno-2-189"></a>                                <span class="n">mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_serialize_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-190"><a id="__codelineno-2-190" name="__codelineno-2-190" href="#__codelineno-2-190"></a>                            <span class="p">)</span>
</span><span id="__span-2-191"><a id="__codelineno-2-191" name="__codelineno-2-191" href="#__codelineno-2-191"></a>
</span><span id="__span-2-192"><a id="__codelineno-2-192" name="__codelineno-2-192" href="#__codelineno-2-192"></a><span class="k">class</span><span class="w"> </span><span class="nc">Worker</span><span class="p">:</span>
</span><span id="__span-2-193"><a id="__codelineno-2-193" name="__codelineno-2-193" href="#__codelineno-2-193"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Individual worker that processes tasks&quot;&quot;&quot;</span>
</span><span id="__span-2-194"><a id="__codelineno-2-194" name="__codelineno-2-194" href="#__codelineno-2-194"></a>
</span><span id="__span-2-195"><a id="__codelineno-2-195" name="__codelineno-2-195" href="#__codelineno-2-195"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">:</span> <span class="n">DistributedTaskScheduler</span><span class="p">,</span>
</span><span id="__span-2-196"><a id="__codelineno-2-196" name="__codelineno-2-196" href="#__codelineno-2-196"></a>                 <span class="n">steal_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="__span-2-197"><a id="__codelineno-2-197" name="__codelineno-2-197" href="#__codelineno-2-197"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">worker_id</span> <span class="o">=</span> <span class="n">worker_id</span>
</span><span id="__span-2-198"><a id="__codelineno-2-198" name="__codelineno-2-198" href="#__codelineno-2-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">scheduler</span>
</span><span id="__span-2-199"><a id="__codelineno-2-199" name="__codelineno-2-199" href="#__codelineno-2-199"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steal_threshold</span> <span class="o">=</span> <span class="n">steal_threshold</span>
</span><span id="__span-2-200"><a id="__codelineno-2-200" name="__codelineno-2-200" href="#__codelineno-2-200"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Task</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-201"><a id="__codelineno-2-201" name="__codelineno-2-201" href="#__codelineno-2-201"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-2-202"><a id="__codelineno-2-202" name="__codelineno-2-202" href="#__codelineno-2-202"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_task</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Task</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-203"><a id="__codelineno-2-203" name="__codelineno-2-203" href="#__codelineno-2-203"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-2-204"><a id="__codelineno-2-204" name="__codelineno-2-204" href="#__codelineno-2-204"></a>
</span><span id="__span-2-205"><a id="__codelineno-2-205" name="__codelineno-2-205" href="#__codelineno-2-205"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-206"><a id="__codelineno-2-206" name="__codelineno-2-206" href="#__codelineno-2-206"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Main worker loop&quot;&quot;&quot;</span>
</span><span id="__span-2-207"><a id="__codelineno-2-207" name="__codelineno-2-207" href="#__codelineno-2-207"></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
</span><span id="__span-2-208"><a id="__codelineno-2-208" name="__codelineno-2-208" href="#__codelineno-2-208"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-2-209"><a id="__codelineno-2-209" name="__codelineno-2-209" href="#__codelineno-2-209"></a>                <span class="c1"># Get next task</span>
</span><span id="__span-2-210"><a id="__codelineno-2-210" name="__codelineno-2-210" href="#__codelineno-2-210"></a>                <span class="n">task</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_next_task</span><span class="p">()</span>
</span><span id="__span-2-211"><a id="__codelineno-2-211" name="__codelineno-2-211" href="#__codelineno-2-211"></a>
</span><span id="__span-2-212"><a id="__codelineno-2-212" name="__codelineno-2-212" href="#__codelineno-2-212"></a>                <span class="k">if</span> <span class="n">task</span><span class="p">:</span>
</span><span id="__span-2-213"><a id="__codelineno-2-213" name="__codelineno-2-213" href="#__codelineno-2-213"></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-214"><a id="__codelineno-2-214" name="__codelineno-2-214" href="#__codelineno-2-214"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-215"><a id="__codelineno-2-215" name="__codelineno-2-215" href="#__codelineno-2-215"></a>                    <span class="c1"># No task available, sleep briefly</span>
</span><span id="__span-2-216"><a id="__codelineno-2-216" name="__codelineno-2-216" href="#__codelineno-2-216"></a>                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-2-217"><a id="__codelineno-2-217" name="__codelineno-2-217" href="#__codelineno-2-217"></a>
</span><span id="__span-2-218"><a id="__codelineno-2-218" name="__codelineno-2-218" href="#__codelineno-2-218"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-2-219"><a id="__codelineno-2-219" name="__codelineno-2-219" href="#__codelineno-2-219"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-220"><a id="__codelineno-2-220" name="__codelineno-2-220" href="#__codelineno-2-220"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-2-221"><a id="__codelineno-2-221" name="__codelineno-2-221" href="#__codelineno-2-221"></a>
</span><span id="__span-2-222"><a id="__codelineno-2-222" name="__codelineno-2-222" href="#__codelineno-2-222"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_next_task</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
</span><span id="__span-2-223"><a id="__codelineno-2-223" name="__codelineno-2-223" href="#__codelineno-2-223"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get next task to process&quot;&quot;&quot;</span>
</span><span id="__span-2-224"><a id="__codelineno-2-224" name="__codelineno-2-224" href="#__codelineno-2-224"></a>        <span class="c1"># Try local queue first</span>
</span><span id="__span-2-225"><a id="__codelineno-2-225" name="__codelineno-2-225" href="#__codelineno-2-225"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="p">:</span>
</span><span id="__span-2-226"><a id="__codelineno-2-226" name="__codelineno-2-226" href="#__codelineno-2-226"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-2-227"><a id="__codelineno-2-227" name="__codelineno-2-227" href="#__codelineno-2-227"></a>
</span><span id="__span-2-228"><a id="__codelineno-2-228" name="__codelineno-2-228" href="#__codelineno-2-228"></a>        <span class="c1"># Try to get from Redis queues</span>
</span><span id="__span-2-229"><a id="__codelineno-2-229" name="__codelineno-2-229" href="#__codelineno-2-229"></a>        <span class="k">for</span> <span class="n">queue_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;queue:high&quot;</span><span class="p">,</span> <span class="s2">&quot;queue:normal&quot;</span><span class="p">,</span> <span class="s2">&quot;queue:low&quot;</span><span class="p">]:</span>
</span><span id="__span-2-230"><a id="__codelineno-2-230" name="__codelineno-2-230" href="#__codelineno-2-230"></a>            <span class="c1"># Get multiple tasks at once for efficiency</span>
</span><span id="__span-2-231"><a id="__codelineno-2-231" name="__codelineno-2-231" href="#__codelineno-2-231"></a>            <span class="n">task_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">zrange</span><span class="p">(</span>
</span><span id="__span-2-232"><a id="__codelineno-2-232" name="__codelineno-2-232" href="#__codelineno-2-232"></a>                <span class="n">queue_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">steal_threshold</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="__span-2-233"><a id="__codelineno-2-233" name="__codelineno-2-233" href="#__codelineno-2-233"></a>            <span class="p">)</span>
</span><span id="__span-2-234"><a id="__codelineno-2-234" name="__codelineno-2-234" href="#__codelineno-2-234"></a>
</span><span id="__span-2-235"><a id="__codelineno-2-235" name="__codelineno-2-235" href="#__codelineno-2-235"></a>            <span class="k">if</span> <span class="n">task_ids</span><span class="p">:</span>
</span><span id="__span-2-236"><a id="__codelineno-2-236" name="__codelineno-2-236" href="#__codelineno-2-236"></a>                <span class="c1"># Remove from queue</span>
</span><span id="__span-2-237"><a id="__codelineno-2-237" name="__codelineno-2-237" href="#__codelineno-2-237"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">zrem</span><span class="p">(</span><span class="n">queue_name</span><span class="p">,</span> <span class="o">*</span><span class="n">task_ids</span><span class="p">)</span>
</span><span id="__span-2-238"><a id="__codelineno-2-238" name="__codelineno-2-238" href="#__codelineno-2-238"></a>
</span><span id="__span-2-239"><a id="__codelineno-2-239" name="__codelineno-2-239" href="#__codelineno-2-239"></a>                <span class="c1"># Load tasks</span>
</span><span id="__span-2-240"><a id="__codelineno-2-240" name="__codelineno-2-240" href="#__codelineno-2-240"></a>                <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-241"><a id="__codelineno-2-241" name="__codelineno-2-241" href="#__codelineno-2-241"></a>                <span class="k">for</span> <span class="n">task_id</span> <span class="ow">in</span> <span class="n">task_ids</span><span class="p">:</span>
</span><span id="__span-2-242"><a id="__codelineno-2-242" name="__codelineno-2-242" href="#__codelineno-2-242"></a>                    <span class="n">task_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span>
</span><span id="__span-2-243"><a id="__codelineno-2-243" name="__codelineno-2-243" href="#__codelineno-2-243"></a>                        <span class="sa">f</span><span class="s2">&quot;task:</span><span class="si">{</span><span class="n">task_id</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-244"><a id="__codelineno-2-244" name="__codelineno-2-244" href="#__codelineno-2-244"></a>                    <span class="p">)</span>
</span><span id="__span-2-245"><a id="__codelineno-2-245" name="__codelineno-2-245" href="#__codelineno-2-245"></a>                    <span class="k">if</span> <span class="n">task_data</span><span class="p">:</span>
</span><span id="__span-2-246"><a id="__codelineno-2-246" name="__codelineno-2-246" href="#__codelineno-2-246"></a>                        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">_deserialize_task</span><span class="p">(</span><span class="n">task_data</span><span class="p">)</span>
</span><span id="__span-2-247"><a id="__codelineno-2-247" name="__codelineno-2-247" href="#__codelineno-2-247"></a>                        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-248"><a id="__codelineno-2-248" name="__codelineno-2-248" href="#__codelineno-2-248"></a>
</span><span id="__span-2-249"><a id="__codelineno-2-249" name="__codelineno-2-249" href="#__codelineno-2-249"></a>                <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
</span><span id="__span-2-250"><a id="__codelineno-2-250" name="__codelineno-2-250" href="#__codelineno-2-250"></a>                    <span class="c1"># Keep first task, add rest to local queue</span>
</span><span id="__span-2-251"><a id="__codelineno-2-251" name="__codelineno-2-251" href="#__codelineno-2-251"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tasks</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="__span-2-252"><a id="__codelineno-2-252" name="__codelineno-2-252" href="#__codelineno-2-252"></a>                    <span class="k">return</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-2-253"><a id="__codelineno-2-253" name="__codelineno-2-253" href="#__codelineno-2-253"></a>
</span><span id="__span-2-254"><a id="__codelineno-2-254" name="__codelineno-2-254" href="#__codelineno-2-254"></a>        <span class="c1"># No tasks in queues, try work stealing</span>
</span><span id="__span-2-255"><a id="__codelineno-2-255" name="__codelineno-2-255" href="#__codelineno-2-255"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_steal_work</span><span class="p">()</span>
</span><span id="__span-2-256"><a id="__codelineno-2-256" name="__codelineno-2-256" href="#__codelineno-2-256"></a>
</span><span id="__span-2-257"><a id="__codelineno-2-257" name="__codelineno-2-257" href="#__codelineno-2-257"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_steal_work</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
</span><span id="__span-2-258"><a id="__codelineno-2-258" name="__codelineno-2-258" href="#__codelineno-2-258"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to steal work from other workers&quot;&quot;&quot;</span>
</span><span id="__span-2-259"><a id="__codelineno-2-259" name="__codelineno-2-259" href="#__codelineno-2-259"></a>        <span class="k">for</span> <span class="n">worker_id</span><span class="p">,</span> <span class="n">worker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-2-260"><a id="__codelineno-2-260" name="__codelineno-2-260" href="#__codelineno-2-260"></a>            <span class="k">if</span> <span class="n">worker_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker_id</span><span class="p">:</span>
</span><span id="__span-2-261"><a id="__codelineno-2-261" name="__codelineno-2-261" href="#__codelineno-2-261"></a>                <span class="k">continue</span>
</span><span id="__span-2-262"><a id="__codelineno-2-262" name="__codelineno-2-262" href="#__codelineno-2-262"></a>
</span><span id="__span-2-263"><a id="__codelineno-2-263" name="__codelineno-2-263" href="#__codelineno-2-263"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">local_queue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steal_threshold</span><span class="p">:</span>
</span><span id="__span-2-264"><a id="__codelineno-2-264" name="__codelineno-2-264" href="#__codelineno-2-264"></a>                <span class="c1"># Steal half of their excess tasks</span>
</span><span id="__span-2-265"><a id="__codelineno-2-265" name="__codelineno-2-265" href="#__codelineno-2-265"></a>                <span class="n">steal_count</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">local_queue</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">steal_threshold</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-2-266"><a id="__codelineno-2-266" name="__codelineno-2-266" href="#__codelineno-2-266"></a>                <span class="k">if</span> <span class="n">steal_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-2-267"><a id="__codelineno-2-267" name="__codelineno-2-267" href="#__codelineno-2-267"></a>                    <span class="n">stolen</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">local_queue</span><span class="p">[:</span><span class="n">steal_count</span><span class="p">]</span>
</span><span id="__span-2-268"><a id="__codelineno-2-268" name="__codelineno-2-268" href="#__codelineno-2-268"></a>                    <span class="n">worker</span><span class="o">.</span><span class="n">local_queue</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">local_queue</span><span class="p">[</span><span class="n">steal_count</span><span class="p">:]</span>
</span><span id="__span-2-269"><a id="__codelineno-2-269" name="__codelineno-2-269" href="#__codelineno-2-269"></a>
</span><span id="__span-2-270"><a id="__codelineno-2-270" name="__codelineno-2-270" href="#__codelineno-2-270"></a>                    <span class="c1"># Add to our queue and return first</span>
</span><span id="__span-2-271"><a id="__codelineno-2-271" name="__codelineno-2-271" href="#__codelineno-2-271"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">stolen</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="__span-2-272"><a id="__codelineno-2-272" name="__codelineno-2-272" href="#__codelineno-2-272"></a>
</span><span id="__span-2-273"><a id="__codelineno-2-273" name="__codelineno-2-273" href="#__codelineno-2-273"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-2-274"><a id="__codelineno-2-274" name="__codelineno-2-274" href="#__codelineno-2-274"></a>                        <span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> stole </span><span class="si">{</span><span class="n">steal_count</span><span class="si">}</span><span class="s2"> tasks &quot;</span>
</span><span id="__span-2-275"><a id="__codelineno-2-275" name="__codelineno-2-275" href="#__codelineno-2-275"></a>                        <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-276"><a id="__codelineno-2-276" name="__codelineno-2-276" href="#__codelineno-2-276"></a>                    <span class="p">)</span>
</span><span id="__span-2-277"><a id="__codelineno-2-277" name="__codelineno-2-277" href="#__codelineno-2-277"></a>
</span><span id="__span-2-278"><a id="__codelineno-2-278" name="__codelineno-2-278" href="#__codelineno-2-278"></a>                    <span class="k">return</span> <span class="n">stolen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-2-279"><a id="__codelineno-2-279" name="__codelineno-2-279" href="#__codelineno-2-279"></a>
</span><span id="__span-2-280"><a id="__codelineno-2-280" name="__codelineno-2-280" href="#__codelineno-2-280"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-2-281"><a id="__codelineno-2-281" name="__codelineno-2-281" href="#__codelineno-2-281"></a>
</span><span id="__span-2-282"><a id="__codelineno-2-282" name="__codelineno-2-282" href="#__codelineno-2-282"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_execute_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
</span><span id="__span-2-283"><a id="__codelineno-2-283" name="__codelineno-2-283" href="#__codelineno-2-283"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a single task&quot;&quot;&quot;</span>
</span><span id="__span-2-284"><a id="__codelineno-2-284" name="__codelineno-2-284" href="#__codelineno-2-284"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_task</span> <span class="o">=</span> <span class="n">task</span>
</span><span id="__span-2-285"><a id="__codelineno-2-285" name="__codelineno-2-285" href="#__codelineno-2-285"></a>        <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">RUNNING</span>
</span><span id="__span-2-286"><a id="__codelineno-2-286" name="__codelineno-2-286" href="#__codelineno-2-286"></a>        <span class="n">task</span><span class="o">.</span><span class="n">started_at</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-2-287"><a id="__codelineno-2-287" name="__codelineno-2-287" href="#__codelineno-2-287"></a>        <span class="n">task</span><span class="o">.</span><span class="n">worker_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker_id</span>
</span><span id="__span-2-288"><a id="__codelineno-2-288" name="__codelineno-2-288" href="#__codelineno-2-288"></a>
</span><span id="__span-2-289"><a id="__codelineno-2-289" name="__codelineno-2-289" href="#__codelineno-2-289"></a>        <span class="c1"># Update task state in Redis</span>
</span><span id="__span-2-290"><a id="__codelineno-2-290" name="__codelineno-2-290" href="#__codelineno-2-290"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span>
</span><span id="__span-2-291"><a id="__codelineno-2-291" name="__codelineno-2-291" href="#__codelineno-2-291"></a>            <span class="sa">f</span><span class="s2">&quot;task:</span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-2-292"><a id="__codelineno-2-292" name="__codelineno-2-292" href="#__codelineno-2-292"></a>            <span class="n">mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">_serialize_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-293"><a id="__codelineno-2-293" name="__codelineno-2-293" href="#__codelineno-2-293"></a>        <span class="p">)</span>
</span><span id="__span-2-294"><a id="__codelineno-2-294" name="__codelineno-2-294" href="#__codelineno-2-294"></a>
</span><span id="__span-2-295"><a id="__codelineno-2-295" name="__codelineno-2-295" href="#__codelineno-2-295"></a>        <span class="c1"># Record start</span>
</span><span id="__span-2-296"><a id="__codelineno-2-296" name="__codelineno-2-296" href="#__codelineno-2-296"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">monitoring</span><span class="o">.</span><span class="n">record_task_started</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-297"><a id="__codelineno-2-297" name="__codelineno-2-297" href="#__codelineno-2-297"></a>
</span><span id="__span-2-298"><a id="__codelineno-2-298" name="__codelineno-2-298" href="#__codelineno-2-298"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-2-299"><a id="__codelineno-2-299" name="__codelineno-2-299" href="#__codelineno-2-299"></a>            <span class="c1"># Get handler</span>
</span><span id="__span-2-300"><a id="__codelineno-2-300" name="__codelineno-2-300" href="#__codelineno-2-300"></a>            <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">task_handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-2-301"><a id="__codelineno-2-301" name="__codelineno-2-301" href="#__codelineno-2-301"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">handler</span><span class="p">:</span>
</span><span id="__span-2-302"><a id="__codelineno-2-302" name="__codelineno-2-302" href="#__codelineno-2-302"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No handler registered for task </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-303"><a id="__codelineno-2-303" name="__codelineno-2-303" href="#__codelineno-2-303"></a>
</span><span id="__span-2-304"><a id="__codelineno-2-304" name="__codelineno-2-304" href="#__codelineno-2-304"></a>            <span class="c1"># Execute with timeout</span>
</span><span id="__span-2-305"><a id="__codelineno-2-305" name="__codelineno-2-305" href="#__codelineno-2-305"></a>            <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
</span><span id="__span-2-306"><a id="__codelineno-2-306" name="__codelineno-2-306" href="#__codelineno-2-306"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
</span><span id="__span-2-307"><a id="__codelineno-2-307" name="__codelineno-2-307" href="#__codelineno-2-307"></a>                <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">),</span>
</span><span id="__span-2-308"><a id="__codelineno-2-308" name="__codelineno-2-308" href="#__codelineno-2-308"></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">timeout_seconds</span>
</span><span id="__span-2-309"><a id="__codelineno-2-309" name="__codelineno-2-309" href="#__codelineno-2-309"></a>            <span class="p">)</span>
</span><span id="__span-2-310"><a id="__codelineno-2-310" name="__codelineno-2-310" href="#__codelineno-2-310"></a>
</span><span id="__span-2-311"><a id="__codelineno-2-311" name="__codelineno-2-311" href="#__codelineno-2-311"></a>            <span class="c1"># Success</span>
</span><span id="__span-2-312"><a id="__codelineno-2-312" name="__codelineno-2-312" href="#__codelineno-2-312"></a>            <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="__span-2-313"><a id="__codelineno-2-313" name="__codelineno-2-313" href="#__codelineno-2-313"></a>            <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">COMPLETED</span>
</span><span id="__span-2-314"><a id="__codelineno-2-314" name="__codelineno-2-314" href="#__codelineno-2-314"></a>            <span class="n">task</span><span class="o">.</span><span class="n">completed_at</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-2-315"><a id="__codelineno-2-315" name="__codelineno-2-315" href="#__codelineno-2-315"></a>
</span><span id="__span-2-316"><a id="__codelineno-2-316" name="__codelineno-2-316" href="#__codelineno-2-316"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
</span><span id="__span-2-317"><a id="__codelineno-2-317" name="__codelineno-2-317" href="#__codelineno-2-317"></a>
</span><span id="__span-2-318"><a id="__codelineno-2-318" name="__codelineno-2-318" href="#__codelineno-2-318"></a>        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
</span><span id="__span-2-319"><a id="__codelineno-2-319" name="__codelineno-2-319" href="#__codelineno-2-319"></a>            <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">FAILED</span>
</span><span id="__span-2-320"><a id="__codelineno-2-320" name="__codelineno-2-320" href="#__codelineno-2-320"></a>            <span class="n">task</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Timeout after </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
</span><span id="__span-2-321"><a id="__codelineno-2-321" name="__codelineno-2-321" href="#__codelineno-2-321"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> timed out&quot;</span><span class="p">)</span>
</span><span id="__span-2-322"><a id="__codelineno-2-322" name="__codelineno-2-322" href="#__codelineno-2-322"></a>
</span><span id="__span-2-323"><a id="__codelineno-2-323" name="__codelineno-2-323" href="#__codelineno-2-323"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-2-324"><a id="__codelineno-2-324" name="__codelineno-2-324" href="#__codelineno-2-324"></a>            <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">FAILED</span>
</span><span id="__span-2-325"><a id="__codelineno-2-325" name="__codelineno-2-325" href="#__codelineno-2-325"></a>            <span class="n">task</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-2-326"><a id="__codelineno-2-326" name="__codelineno-2-326" href="#__codelineno-2-326"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-327"><a id="__codelineno-2-327" name="__codelineno-2-327" href="#__codelineno-2-327"></a>
</span><span id="__span-2-328"><a id="__codelineno-2-328" name="__codelineno-2-328" href="#__codelineno-2-328"></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-2-329"><a id="__codelineno-2-329" name="__codelineno-2-329" href="#__codelineno-2-329"></a>            <span class="c1"># Update final state</span>
</span><span id="__span-2-330"><a id="__codelineno-2-330" name="__codelineno-2-330" href="#__codelineno-2-330"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span>
</span><span id="__span-2-331"><a id="__codelineno-2-331" name="__codelineno-2-331" href="#__codelineno-2-331"></a>                <span class="sa">f</span><span class="s2">&quot;task:</span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-2-332"><a id="__codelineno-2-332" name="__codelineno-2-332" href="#__codelineno-2-332"></a>                <span class="n">mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">_serialize_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-333"><a id="__codelineno-2-333" name="__codelineno-2-333" href="#__codelineno-2-333"></a>            <span class="p">)</span>
</span><span id="__span-2-334"><a id="__codelineno-2-334" name="__codelineno-2-334" href="#__codelineno-2-334"></a>
</span><span id="__span-2-335"><a id="__codelineno-2-335" name="__codelineno-2-335" href="#__codelineno-2-335"></a>            <span class="c1"># Record completion</span>
</span><span id="__span-2-336"><a id="__codelineno-2-336" name="__codelineno-2-336" href="#__codelineno-2-336"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">monitoring</span><span class="o">.</span><span class="n">record_task_completed</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-337"><a id="__codelineno-2-337" name="__codelineno-2-337" href="#__codelineno-2-337"></a>
</span><span id="__span-2-338"><a id="__codelineno-2-338" name="__codelineno-2-338" href="#__codelineno-2-338"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-339"><a id="__codelineno-2-339" name="__codelineno-2-339" href="#__codelineno-2-339"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-340"><a id="__codelineno-2-340" name="__codelineno-2-340" href="#__codelineno-2-340"></a>
</span><span id="__span-2-341"><a id="__codelineno-2-341" name="__codelineno-2-341" href="#__codelineno-2-341"></a><span class="k">class</span><span class="w"> </span><span class="nc">MonitoringSystem</span><span class="p">:</span>
</span><span id="__span-2-342"><a id="__codelineno-2-342" name="__codelineno-2-342" href="#__codelineno-2-342"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor scheduler performance&quot;&quot;&quot;</span>
</span><span id="__span-2-343"><a id="__codelineno-2-343" name="__codelineno-2-343" href="#__codelineno-2-343"></a>
</span><span id="__span-2-344"><a id="__codelineno-2-344" name="__codelineno-2-344" href="#__codelineno-2-344"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-345"><a id="__codelineno-2-345" name="__codelineno-2-345" href="#__codelineno-2-345"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-2-346"><a id="__codelineno-2-346" name="__codelineno-2-346" href="#__codelineno-2-346"></a>            <span class="s1">&#39;tasks_submitted&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-347"><a id="__codelineno-2-347" name="__codelineno-2-347" href="#__codelineno-2-347"></a>            <span class="s1">&#39;tasks_started&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-348"><a id="__codelineno-2-348" name="__codelineno-2-348" href="#__codelineno-2-348"></a>            <span class="s1">&#39;tasks_completed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-349"><a id="__codelineno-2-349" name="__codelineno-2-349" href="#__codelineno-2-349"></a>            <span class="s1">&#39;tasks_failed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-350"><a id="__codelineno-2-350" name="__codelineno-2-350" href="#__codelineno-2-350"></a>            <span class="s1">&#39;total_processing_time&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-2-351"><a id="__codelineno-2-351" name="__codelineno-2-351" href="#__codelineno-2-351"></a>            <span class="s1">&#39;queue_depths&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-2-352"><a id="__codelineno-2-352" name="__codelineno-2-352" href="#__codelineno-2-352"></a>        <span class="p">}</span>
</span><span id="__span-2-353"><a id="__codelineno-2-353" name="__codelineno-2-353" href="#__codelineno-2-353"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-354"><a id="__codelineno-2-354" name="__codelineno-2-354" href="#__codelineno-2-354"></a>
</span><span id="__span-2-355"><a id="__codelineno-2-355" name="__codelineno-2-355" href="#__codelineno-2-355"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_task_submitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
</span><span id="__span-2-356"><a id="__codelineno-2-356" name="__codelineno-2-356" href="#__codelineno-2-356"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_submitted&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-357"><a id="__codelineno-2-357" name="__codelineno-2-357" href="#__codelineno-2-357"></a>
</span><span id="__span-2-358"><a id="__codelineno-2-358" name="__codelineno-2-358" href="#__codelineno-2-358"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_task_started</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
</span><span id="__span-2-359"><a id="__codelineno-2-359" name="__codelineno-2-359" href="#__codelineno-2-359"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_started&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-360"><a id="__codelineno-2-360" name="__codelineno-2-360" href="#__codelineno-2-360"></a>
</span><span id="__span-2-361"><a id="__codelineno-2-361" name="__codelineno-2-361" href="#__codelineno-2-361"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_task_completed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
</span><span id="__span-2-362"><a id="__codelineno-2-362" name="__codelineno-2-362" href="#__codelineno-2-362"></a>        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
</span><span id="__span-2-363"><a id="__codelineno-2-363" name="__codelineno-2-363" href="#__codelineno-2-363"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_completed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-364"><a id="__codelineno-2-364" name="__codelineno-2-364" href="#__codelineno-2-364"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-365"><a id="__codelineno-2-365" name="__codelineno-2-365" href="#__codelineno-2-365"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_failed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-366"><a id="__codelineno-2-366" name="__codelineno-2-366" href="#__codelineno-2-366"></a>
</span><span id="__span-2-367"><a id="__codelineno-2-367" name="__codelineno-2-367" href="#__codelineno-2-367"></a>        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">started_at</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">completed_at</span><span class="p">:</span>
</span><span id="__span-2-368"><a id="__codelineno-2-368" name="__codelineno-2-368" href="#__codelineno-2-368"></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">completed_at</span> <span class="o">-</span> <span class="n">task</span><span class="o">.</span><span class="n">started_at</span>
</span><span id="__span-2-369"><a id="__codelineno-2-369" name="__codelineno-2-369" href="#__codelineno-2-369"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
</span><span id="__span-2-370"><a id="__codelineno-2-370" name="__codelineno-2-370" href="#__codelineno-2-370"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;total_processing_time&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration</span>
</span><span id="__span-2-371"><a id="__codelineno-2-371" name="__codelineno-2-371" href="#__codelineno-2-371"></a>
</span><span id="__span-2-372"><a id="__codelineno-2-372" name="__codelineno-2-372" href="#__codelineno-2-372"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-373"><a id="__codelineno-2-373" name="__codelineno-2-373" href="#__codelineno-2-373"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodically report metrics&quot;&quot;&quot;</span>
</span><span id="__span-2-374"><a id="__codelineno-2-374" name="__codelineno-2-374" href="#__codelineno-2-374"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-2-375"><a id="__codelineno-2-375" name="__codelineno-2-375" href="#__codelineno-2-375"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># Report every minute</span>
</span><span id="__span-2-376"><a id="__codelineno-2-376" name="__codelineno-2-376" href="#__codelineno-2-376"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_report_metrics</span><span class="p">()</span>
</span><span id="__span-2-377"><a id="__codelineno-2-377" name="__codelineno-2-377" href="#__codelineno-2-377"></a>
</span><span id="__span-2-378"><a id="__codelineno-2-378" name="__codelineno-2-378" href="#__codelineno-2-378"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_report_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-379"><a id="__codelineno-2-379" name="__codelineno-2-379" href="#__codelineno-2-379"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate performance report&quot;&quot;&quot;</span>
</span><span id="__span-2-380"><a id="__codelineno-2-380" name="__codelineno-2-380" href="#__codelineno-2-380"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">:</span>
</span><span id="__span-2-381"><a id="__codelineno-2-381" name="__codelineno-2-381" href="#__codelineno-2-381"></a>            <span class="k">return</span>
</span><span id="__span-2-382"><a id="__codelineno-2-382" name="__codelineno-2-382" href="#__codelineno-2-382"></a>
</span><span id="__span-2-383"><a id="__codelineno-2-383" name="__codelineno-2-383" href="#__codelineno-2-383"></a>        <span class="n">avg_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">)</span>
</span><span id="__span-2-384"><a id="__codelineno-2-384" name="__codelineno-2-384" href="#__codelineno-2-384"></a>        <span class="n">p50_duration</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-2-385"><a id="__codelineno-2-385" name="__codelineno-2-385" href="#__codelineno-2-385"></a>        <span class="n">p99_duration</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_durations</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.99</span><span class="p">)]</span>
</span><span id="__span-2-386"><a id="__codelineno-2-386" name="__codelineno-2-386" href="#__codelineno-2-386"></a>
</span><span id="__span-2-387"><a id="__codelineno-2-387" name="__codelineno-2-387" href="#__codelineno-2-387"></a>        <span class="n">throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_completed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">60</span>  <span class="c1"># per second</span>
</span><span id="__span-2-388"><a id="__codelineno-2-388" name="__codelineno-2-388" href="#__codelineno-2-388"></a>
</span><span id="__span-2-389"><a id="__codelineno-2-389" name="__codelineno-2-389" href="#__codelineno-2-389"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Scheduler Performance Report ===&quot;</span><span class="p">)</span>
</span><span id="__span-2-390"><a id="__codelineno-2-390" name="__codelineno-2-390" href="#__codelineno-2-390"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tasks submitted: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_submitted&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-391"><a id="__codelineno-2-391" name="__codelineno-2-391" href="#__codelineno-2-391"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tasks completed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_completed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-392"><a id="__codelineno-2-392" name="__codelineno-2-392" href="#__codelineno-2-392"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tasks failed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;tasks_failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-2-393"><a id="__codelineno-2-393" name="__codelineno-2-393" href="#__codelineno-2-393"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Throughput: </span><span class="si">{</span><span class="n">throughput</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> tasks/sec&quot;</span><span class="p">)</span>
</span><span id="__span-2-394"><a id="__codelineno-2-394" name="__codelineno-2-394" href="#__codelineno-2-394"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avg duration: </span><span class="si">{</span><span class="n">avg_duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="__span-2-395"><a id="__codelineno-2-395" name="__codelineno-2-395" href="#__codelineno-2-395"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P50 duration: </span><span class="si">{</span><span class="n">p50_duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="__span-2-396"><a id="__codelineno-2-396" name="__codelineno-2-396" href="#__codelineno-2-396"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P99 duration: </span><span class="si">{</span><span class="n">p99_duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="__span-2-397"><a id="__codelineno-2-397" name="__codelineno-2-397" href="#__codelineno-2-397"></a>
</span><span id="__span-2-398"><a id="__codelineno-2-398" name="__codelineno-2-398" href="#__codelineno-2-398"></a><span class="c1"># Example usage</span>
</span><span id="__span-2-399"><a id="__codelineno-2-399" name="__codelineno-2-399" href="#__codelineno-2-399"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">example_usage</span><span class="p">():</span>
</span><span id="__span-2-400"><a id="__codelineno-2-400" name="__codelineno-2-400" href="#__codelineno-2-400"></a>    <span class="c1"># Create scheduler</span>
</span><span id="__span-2-401"><a id="__codelineno-2-401" name="__codelineno-2-401" href="#__codelineno-2-401"></a>    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">DistributedTaskScheduler</span><span class="p">(</span>
</span><span id="__span-2-402"><a id="__codelineno-2-402" name="__codelineno-2-402" href="#__codelineno-2-402"></a>        <span class="n">redis_url</span><span class="o">=</span><span class="s2">&quot;redis://localhost&quot;</span><span class="p">,</span>
</span><span id="__span-2-403"><a id="__codelineno-2-403" name="__codelineno-2-403" href="#__codelineno-2-403"></a>        <span class="n">worker_pool_size</span><span class="o">=</span><span class="mi">10</span>
</span><span id="__span-2-404"><a id="__codelineno-2-404" name="__codelineno-2-404" href="#__codelineno-2-404"></a>    <span class="p">)</span>
</span><span id="__span-2-405"><a id="__codelineno-2-405" name="__codelineno-2-405" href="#__codelineno-2-405"></a>
</span><span id="__span-2-406"><a id="__codelineno-2-406" name="__codelineno-2-406" href="#__codelineno-2-406"></a>    <span class="c1"># Register task handlers</span>
</span><span id="__span-2-407"><a id="__codelineno-2-407" name="__codelineno-2-407" href="#__codelineno-2-407"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_image</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span><span id="__span-2-408"><a id="__codelineno-2-408" name="__codelineno-2-408" href="#__codelineno-2-408"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate image processing&quot;&quot;&quot;</span>
</span><span id="__span-2-409"><a id="__codelineno-2-409" name="__codelineno-2-409" href="#__codelineno-2-409"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-2-410"><a id="__codelineno-2-410" name="__codelineno-2-410" href="#__codelineno-2-410"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Processed image </span><span class="si">{</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;image_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-411"><a id="__codelineno-2-411" name="__codelineno-2-411" href="#__codelineno-2-411"></a>
</span><span id="__span-2-412"><a id="__codelineno-2-412" name="__codelineno-2-412" href="#__codelineno-2-412"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_data</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span><span id="__span-2-413"><a id="__codelineno-2-413" name="__codelineno-2-413" href="#__codelineno-2-413"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate data analysis&quot;&quot;&quot;</span>
</span><span id="__span-2-414"><a id="__codelineno-2-414" name="__codelineno-2-414" href="#__codelineno-2-414"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-2-415"><a id="__codelineno-2-415" name="__codelineno-2-415" href="#__codelineno-2-415"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Analyzed dataset </span><span class="si">{</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;dataset_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-2-416"><a id="__codelineno-2-416" name="__codelineno-2-416" href="#__codelineno-2-416"></a>
</span><span id="__span-2-417"><a id="__codelineno-2-417" name="__codelineno-2-417" href="#__codelineno-2-417"></a>    <span class="n">scheduler</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="s1">&#39;process_image&#39;</span><span class="p">,</span> <span class="n">process_image</span><span class="p">)</span>
</span><span id="__span-2-418"><a id="__codelineno-2-418" name="__codelineno-2-418" href="#__codelineno-2-418"></a>    <span class="n">scheduler</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="s1">&#39;analyze_data&#39;</span><span class="p">,</span> <span class="n">analyze_data</span><span class="p">)</span>
</span><span id="__span-2-419"><a id="__codelineno-2-419" name="__codelineno-2-419" href="#__codelineno-2-419"></a>
</span><span id="__span-2-420"><a id="__codelineno-2-420" name="__codelineno-2-420" href="#__codelineno-2-420"></a>    <span class="c1"># Start scheduler</span>
</span><span id="__span-2-421"><a id="__codelineno-2-421" name="__codelineno-2-421" href="#__codelineno-2-421"></a>    <span class="k">await</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-2-422"><a id="__codelineno-2-422" name="__codelineno-2-422" href="#__codelineno-2-422"></a>
</span><span id="__span-2-423"><a id="__codelineno-2-423" name="__codelineno-2-423" href="#__codelineno-2-423"></a>    <span class="c1"># Submit tasks</span>
</span><span id="__span-2-424"><a id="__codelineno-2-424" name="__codelineno-2-424" href="#__codelineno-2-424"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-425"><a id="__codelineno-2-425" name="__codelineno-2-425" href="#__codelineno-2-425"></a>
</span><span id="__span-2-426"><a id="__codelineno-2-426" name="__codelineno-2-426" href="#__codelineno-2-426"></a>    <span class="c1"># High priority image processing</span>
</span><span id="__span-2-427"><a id="__codelineno-2-427" name="__codelineno-2-427" href="#__codelineno-2-427"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="__span-2-428"><a id="__codelineno-2-428" name="__codelineno-2-428" href="#__codelineno-2-428"></a>        <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span>
</span><span id="__span-2-429"><a id="__codelineno-2-429" name="__codelineno-2-429" href="#__codelineno-2-429"></a>            <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
</span><span id="__span-2-430"><a id="__codelineno-2-430" name="__codelineno-2-430" href="#__codelineno-2-430"></a>            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;process_image&#39;</span><span class="p">,</span>
</span><span id="__span-2-431"><a id="__codelineno-2-431" name="__codelineno-2-431" href="#__codelineno-2-431"></a>            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;image_id&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
</span><span id="__span-2-432"><a id="__codelineno-2-432" name="__codelineno-2-432" href="#__codelineno-2-432"></a>            <span class="n">priority</span><span class="o">=-</span><span class="mi">1</span>  <span class="c1"># High priority</span>
</span><span id="__span-2-433"><a id="__codelineno-2-433" name="__codelineno-2-433" href="#__codelineno-2-433"></a>        <span class="p">)</span>
</span><span id="__span-2-434"><a id="__codelineno-2-434" name="__codelineno-2-434" href="#__codelineno-2-434"></a>        <span class="n">task_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">submit_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-435"><a id="__codelineno-2-435" name="__codelineno-2-435" href="#__codelineno-2-435"></a>        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="__span-2-436"><a id="__codelineno-2-436" name="__codelineno-2-436" href="#__codelineno-2-436"></a>
</span><span id="__span-2-437"><a id="__codelineno-2-437" name="__codelineno-2-437" href="#__codelineno-2-437"></a>    <span class="c1"># Normal priority data analysis</span>
</span><span id="__span-2-438"><a id="__codelineno-2-438" name="__codelineno-2-438" href="#__codelineno-2-438"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span><span id="__span-2-439"><a id="__codelineno-2-439" name="__codelineno-2-439" href="#__codelineno-2-439"></a>        <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span>
</span><span id="__span-2-440"><a id="__codelineno-2-440" name="__codelineno-2-440" href="#__codelineno-2-440"></a>            <span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
</span><span id="__span-2-441"><a id="__codelineno-2-441" name="__codelineno-2-441" href="#__codelineno-2-441"></a>            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;analyze_data&#39;</span><span class="p">,</span>
</span><span id="__span-2-442"><a id="__codelineno-2-442" name="__codelineno-2-442" href="#__codelineno-2-442"></a>            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dataset_id&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
</span><span id="__span-2-443"><a id="__codelineno-2-443" name="__codelineno-2-443" href="#__codelineno-2-443"></a>            <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># Normal priority</span>
</span><span id="__span-2-444"><a id="__codelineno-2-444" name="__codelineno-2-444" href="#__codelineno-2-444"></a>        <span class="p">)</span>
</span><span id="__span-2-445"><a id="__codelineno-2-445" name="__codelineno-2-445" href="#__codelineno-2-445"></a>        <span class="n">task_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">submit_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-2-446"><a id="__codelineno-2-446" name="__codelineno-2-446" href="#__codelineno-2-446"></a>        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="__span-2-447"><a id="__codelineno-2-447" name="__codelineno-2-447" href="#__codelineno-2-447"></a>
</span><span id="__span-2-448"><a id="__codelineno-2-448" name="__codelineno-2-448" href="#__codelineno-2-448"></a>    <span class="c1"># Wait for completion</span>
</span><span id="__span-2-449"><a id="__codelineno-2-449" name="__codelineno-2-449" href="#__codelineno-2-449"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="__span-2-450"><a id="__codelineno-2-450" name="__codelineno-2-450" href="#__codelineno-2-450"></a>
</span><span id="__span-2-451"><a id="__codelineno-2-451" name="__codelineno-2-451" href="#__codelineno-2-451"></a>    <span class="c1"># Check results</span>
</span><span id="__span-2-452"><a id="__codelineno-2-452" name="__codelineno-2-452" href="#__codelineno-2-452"></a>    <span class="n">completed</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-2-453"><a id="__codelineno-2-453" name="__codelineno-2-453" href="#__codelineno-2-453"></a>    <span class="n">failed</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-2-454"><a id="__codelineno-2-454" name="__codelineno-2-454" href="#__codelineno-2-454"></a>
</span><span id="__span-2-455"><a id="__codelineno-2-455" name="__codelineno-2-455" href="#__codelineno-2-455"></a>    <span class="k">for</span> <span class="n">task_id</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
</span><span id="__span-2-456"><a id="__codelineno-2-456" name="__codelineno-2-456" href="#__codelineno-2-456"></a>        <span class="n">task</span> <span class="o">=</span> <span class="k">await</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">get_task_status</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="__span-2-457"><a id="__codelineno-2-457" name="__codelineno-2-457" href="#__codelineno-2-457"></a>        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
</span><span id="__span-2-458"><a id="__codelineno-2-458" name="__codelineno-2-458" href="#__codelineno-2-458"></a>            <span class="n">completed</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-459"><a id="__codelineno-2-459" name="__codelineno-2-459" href="#__codelineno-2-459"></a>        <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TaskState</span><span class="o">.</span><span class="n">FAILED</span><span class="p">:</span>
</span><span id="__span-2-460"><a id="__codelineno-2-460" name="__codelineno-2-460" href="#__codelineno-2-460"></a>            <span class="n">failed</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-2-461"><a id="__codelineno-2-461" name="__codelineno-2-461" href="#__codelineno-2-461"></a>
</span><span id="__span-2-462"><a id="__codelineno-2-462" name="__codelineno-2-462" href="#__codelineno-2-462"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final results: </span><span class="si">{</span><span class="n">completed</span><span class="si">}</span><span class="s2"> completed, </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2"> failed&quot;</span><span class="p">)</span>
</span><span id="__span-2-463"><a id="__codelineno-2-463" name="__codelineno-2-463" href="#__codelineno-2-463"></a>
</span><span id="__span-2-464"><a id="__codelineno-2-464" name="__codelineno-2-464" href="#__codelineno-2-464"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-2-465"><a id="__codelineno-2-465" name="__codelineno-2-465" href="#__codelineno-2-465"></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">example_usage</span><span class="p">())</span>
</span></code></pre></div>
<h3 id="production-war-stories">Production War Stories<a class="headerlink" href="#production-war-stories" title="Permanent link">&para;</a></h3>
<h4 id="story-1-the-100x-speed-up-that-almost-broke-everything">Story 1: The 100x Speed-Up That Almost Broke Everything<a class="headerlink" href="#story-1-the-100x-speed-up-that-almost-broke-everything" title="Permanent link">&para;</a></h4>
<p><strong>Company</strong>: Social Media Analytics Platform
<strong>Challenge</strong>: Process 1B social posts daily for sentiment analysis</p>
<p><strong>Original System</strong>:</p>
<div class="failure-vignette">
<b>Single-Threaded Processing:</b>
<table>
<tr><th>Step</th><th>Time</th><th>Total for 1B posts</th></tr>
<tr><td>Analyze sentiment</td><td>100ms</td><td rowspan="2">150ms  1B = 1,736 days!</td></tr>
<tr><td>Save to database</td><td>50ms</td></tr>
</table>
</div>

<p><strong>First Attempt</strong>: Naive parallelization</p>
<p><pre class="mermaid"><code>flowchart LR
    subgraph "Naive Approach"
        P[1B Posts] --&gt; TPE[ThreadPoolExecutor&lt;br/&gt;1000 workers]
        TPE --&gt; T1[Thread 1]
        TPE --&gt; T2[Thread 2]
        TPE --&gt; T3[...]
        TPE --&gt; T1000[Thread 1000]

        T1 &amp; T2 &amp; T3 &amp; T1000 --&gt; DB[(Database&lt;br/&gt;Max 100 connections)]

        DB --&gt; X[ MELTDOWN]
    end

    subgraph "What Happened"
        X --&gt; OOM[Out of Memory&lt;br/&gt;10GB thread overhead]
        X --&gt; CPU[CPU Thrashing&lt;br/&gt;Context switching]
        X --&gt; BILL[AWS Bill: $10K]
    end

    style X fill:#ff5252
    style OOM fill:#ffcdd2
    style CPU fill:#ffcdd2
    style BILL fill:#ff1744</code></pre>
<strong>What Went Wrong</strong>:
1. Database connection pool exhausted (max 100 connections)
2. Memory usage: 1000 threads  10MB stack = 10GB overhead
3. Context switching overhead dominated processing
4. No backpressure - queue grew unbounded</p>
<p><strong>The Fix</strong>:</p>
<pre class="mermaid"><code>flowchart TB
    subgraph "Smart Processing Architecture"
        P[1B Posts] --&gt; B[Batch Creator&lt;br/&gt;Size: 1000]
        B --&gt; Q[Bounded Queue&lt;br/&gt;Max: 10K items]

        Q --&gt; C1[Consumer 1]
        Q --&gt; C2[Consumer 2]
        Q --&gt; C3[...]
        Q --&gt; C100[Consumer 100]

        C1 &amp; C2 &amp; C3 &amp; C100 --&gt; BP[Batch Processor]
        BP --&gt; DBP[DB Pool&lt;br/&gt;50 connections]

        Q -.-&gt;|Backpressure| B
    end

    subgraph "Results"
        R1[100x Speedup&lt;br/&gt;17 days  4 hours]
        R2[Memory: 2GB stable]
        R3[DB: Happy]
        R4[AWS: Reasonable]
    end

    style R1 fill:#c8e6c9
    style R2 fill:#c8e6c9
    style R3 fill:#c8e6c9
    style R4 fill:#c8e6c9</code></pre>
<div class="decision-box">
<h4>Smart Processing Strategy</h4>
<table>
<tr><th>Component</th><th>Setting</th><th>Why It Works</th></tr>
<tr><td>Workers</td><td>100 (not 1000)</td><td>Matches DB connection pool</td></tr>
<tr><td>Batch Size</td><td>1000 posts</td><td>Amortizes DB overhead</td></tr>
<tr><td>Queue Limit</td><td>10,000 items</td><td>Prevents memory explosion</td></tr>
<tr><td>DB Pool</td><td>50 connections</td><td>Below DB max, allows headroom</td></tr>
<tr><td>Backpressure</td><td>Queue blocks when full</td><td>Self-regulating system</td></tr>
</table>
</div>
<p><strong>Lessons Learned</strong>:
1. More workers  more speed
2. Batch operations are crucial
3. Backpressure prevents cascading failures
4. Monitor everything before scaling</p>
<h4 id="story-2-when-work-stealing-saved-black-friday">Story 2: When Work Stealing Saved Black Friday<a class="headerlink" href="#story-2-when-work-stealing-saved-black-friday" title="Permanent link">&para;</a></h4>
<p><strong>Company</strong>: E-commerce Platform
<strong>Situation</strong>: Black Friday traffic 50x normal</p>
<p><strong>The Problem</strong>: Uneven load distribution
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Worker 1: Processing celebrity endorsement orders (10K items)
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Worker 2: Processing regular orders (10 items)
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Worker 3-10: Idle
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Result: Celebrity orders timeout, customer rage
</span></code></pre></div>
<strong>The Solution</strong>: Implemented work stealing</p>
<pre class="mermaid"><code>flowchart TB
    subgraph "Before Work Stealing"
        W1B[Worker 1&lt;br/&gt;10K celebrity orders] --&gt;|Overloaded| T1[Timeouts]
        W2B[Worker 2&lt;br/&gt;10 orders] --&gt;|Light load| C1[Completed]
        W3B[Workers 3-10&lt;br/&gt;0 orders] --&gt;|Idle| I1[Wasted]
    end

    subgraph "After Work Stealing"
        M[Monitor] --&gt;|Check loads| D{Load Distribution}
        D --&gt;|Worker 1: 10K| O[Overloaded List]
        D --&gt;|Worker 2: 10| U[Underloaded List]
        D --&gt;|Workers 3-10: 0| U

        O --&gt;|Steal 30%| S[Steal 3K orders]
        S --&gt;|Transfer| W2A[Worker 2&lt;br/&gt;3010 orders]
        S --&gt;|Transfer| W3A[Worker 3&lt;br/&gt;3000 orders]
        S --&gt;|Transfer| W4A[Worker 4&lt;br/&gt;3000 orders]

        W1A[Worker 1&lt;br/&gt;1000 orders] --&gt;|Balanced| OK1[All Complete]
        W2A &amp; W3A &amp; W4A --&gt;|Balanced| OK2[All Complete]
    end

    style T1 fill:#ff5252
    style OK1 fill:#4caf50
    style OK2 fill:#4caf50</code></pre>
<div class="truth-box">
<h4>Work Stealing Algorithm</h4>

<b>Rebalancing Logic:</b>
<ol>
<li>Calculate average load across all workers</li>
<li>Identify overloaded workers (load > 1.5x average)</li>
<li>Identify underloaded workers (load < 0.5x average)</li>
<li>Steal 30% from most loaded to least loaded</li>
<li>Repeat every second</li>
</ol>

<b>Results:</b>
<table>
<tr><th>Metric</th><th>Before</th><th>After</th><th>Impact</th></tr>
<tr><td>P99 Latency</td><td>30s</td><td>2s</td><td>15x improvement</td></tr>
<tr><td>Success Rate</td><td>72%</td><td>99.5%</td><td>$2.3M revenue saved</td></tr>
<tr><td>Worker Utilization</td><td>10%</td><td>85%</td><td>8.5x efficiency</td></tr>
</table>
</div>
<h3 id="performance-optimization-cookbook">Performance Optimization Cookbook<a class="headerlink" href="#performance-optimization-cookbook" title="Permanent link">&para;</a></h3>
<h4 id="recipe-1-the-batch-accumulator-pattern">Recipe 1: The Batch Accumulator Pattern<a class="headerlink" href="#recipe-1-the-batch-accumulator-pattern" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>flowchart LR
    subgraph "Batch Accumulator Logic"
        I[Item Arrives] --&gt; A{Check Pending}
        A --&gt;|Size &lt; Batch Size| B[Add to Pending]
        B --&gt; C{Timer Active?}
        C --&gt;|No| D[Start Timer&lt;br/&gt;50ms]
        C --&gt;|Yes| E[Wait]

        A --&gt;|Size = Batch Size| F[Process Batch&lt;br/&gt;Immediately]

        D --&gt; T[Timer Expires]
        T --&gt; G{Pending Items?}
        G --&gt;|Yes| F
        G --&gt;|No| H[Reset]

        F --&gt; P[Bulk Process&lt;br/&gt;1000 items]
        P --&gt; DB[(Database)]
    end

    style F fill:#4caf50
    style P fill:#81c784</code></pre>
<div class="decision-box">
<h4>Batch Accumulator Pattern</h4>

<b>Configuration:</b>
<table>
<tr><th>Parameter</th><th>Value</th><th>Purpose</th></tr>
<tr><td>Batch Size</td><td>1000</td><td>Optimal for DB bulk inserts</td></tr>
<tr><td>Max Wait</td><td>50ms</td><td>Balance latency vs efficiency</td></tr>
<tr><td>Lock</td><td>AsyncIO Lock</td><td>Thread-safe operations</td></tr>
</table>

<b>Benefits:</b>
<ul>
<li>Reduces network calls by 100x</li>
<li>Amortizes connection overhead</li>
<li>Improves database throughput</li>
<li>Automatic partial batch processing</li>
</ul>
</div>
<h4 id="recipe-2-the-priority-work-queue">Recipe 2: The Priority Work Queue<a class="headerlink" href="#recipe-2-the-priority-work-queue" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; CheckStarvation

    CheckStarvation --&gt; CalculateRatios
    CalculateRatios --&gt; CheckLowPriority: For each low priority queue

    CheckLowPriority --&gt; IsStarving: Queue has items?
    IsStarving --&gt; ServiceStarved: Ratio &lt; threshold
    IsStarving --&gt; CheckNext: Ratio OK

    ServiceStarved --&gt; UpdateStats
    CheckNext --&gt; CheckLowPriority: More queues
    CheckNext --&gt; NormalOrder: No more queues

    NormalOrder --&gt; CheckHigh: Check priority 0
    CheckHigh --&gt; ServiceHigh: Has items
    CheckHigh --&gt; CheckMedium: Empty

    CheckMedium --&gt; ServiceMedium: Has items
    CheckMedium --&gt; CheckLow: Empty

    CheckLow --&gt; ServiceLow: Has items
    CheckLow --&gt; WaitHigh: All empty

    ServiceHigh --&gt; UpdateStats
    ServiceMedium --&gt; UpdateStats
    ServiceLow --&gt; UpdateStats
    WaitHigh --&gt; UpdateStats

    UpdateStats --&gt; [*]</code></pre>
<div class="axiom-box">
<h4>Priority Queue with Anti-Starvation</h4>

<b>Priority Levels:</b>
<table>
<tr><th>Priority</th><th>Expected Ratio</th><th>Use Case</th></tr>
<tr><td>0 (High)</td><td>50%</td><td>Critical tasks</td></tr>
<tr><td>1 (Medium)</td><td>25%</td><td>Normal tasks</td></tr>
<tr><td>2 (Low)</td><td>12.5%</td><td>Background tasks</td></tr>
</table>

<b>Anti-Starvation Logic:</b>
<ul>
<li>Track processing count per priority</li>
<li>Calculate actual vs expected ratios</li>
<li>If ratio < expected/10, force service</li>
<li>Prevents indefinite waiting for low priority</li>
</ul>
</div>
<h4 id="recipe-3-the-adaptive-batch-sizing">Recipe 3: The Adaptive Batch Sizing<a class="headerlink" href="#recipe-3-the-adaptive-batch-sizing" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>flowchart TB
    subgraph "Adaptive Batch Algorithm"
        P[Process Batch] --&gt; M[Measure Performance]
        M --&gt; L[Latency/Item]
        M --&gt; T[Throughput]

        L &amp; T --&gt; H[Add to History]
        H --&gt; C{Enough Data?}
        C --&gt;|&lt; 10 samples| W[Wait]
        C --&gt;|&gt;= 10 samples| A[Analyze Trends]

        A --&gt; RT[Recent vs Older]
        RT --&gt; D{Decision}

        D --&gt;|Latency +20%| R[Reduce Batch -20%]
        D --&gt;|Throughput +10%| I[Increase Batch +20%]
        D --&gt;|Stable| K[Keep Current]

        R --&gt; B[New Batch Size]
        I --&gt; B
        K --&gt; B

        B --&gt; V[Validate Min/Max]
        V --&gt; U[Update Size]
    end

    style R fill:#ffcdd2
    style I fill:#c8e6c9
    style K fill:#e1f5fe</code></pre>
<div class="decision-box">
<h4>Adaptive Batch Sizing Strategy</h4>

<b>Configuration:</b>
<table>
<tr><th>Parameter</th><th>Default</th><th>Purpose</th></tr>
<tr><td>Min Batch</td><td>10</td><td>Prevent overhead dominating</td></tr>
<tr><td>Max Batch</td><td>1000</td><td>Prevent memory issues</td></tr>
<tr><td>History Size</td><td>100</td><td>Trend detection window</td></tr>
<tr><td>Sample Size</td><td>10</td><td>Smoothing for decisions</td></tr>
</table>

<b>Adjustment Rules:</b>
<ul>
<li><b>Latency increases 20%:</b> Reduce batch by 20%</li>
<li><b>Throughput increases 10%:</b> Increase batch by 20%</li>
<li><b>Otherwise:</b> Keep current size</li>
<li>Always respect min/max boundaries</li>
</ul>

<b>Effect:</b> Self-tuning system that finds optimal batch size for current load
</div>
<h3 id="the-future-of-work-distribution">The Future of Work Distribution<a class="headerlink" href="#the-future-of-work-distribution" title="Permanent link">&para;</a></h3>
<h4 id="emerging-patterns">Emerging Patterns<a class="headerlink" href="#emerging-patterns" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Serverless Work Distribution</strong></li>
</ol>
<pre class="mermaid"><code>graph LR
    E[Event] --&gt; F[Function]
    F --&gt; P[Platform]
    P --&gt; S1[Scale to 0]
    P --&gt; S2[Auto-scale to N]
    P --&gt; D[Distribute]
    P --&gt; R[Retry Failed]
    P --&gt; M[Monitor]

    style P fill:#e3f2fd</code></pre>
<ol>
<li><strong>Edge-Native Work</strong></li>
</ol>
<pre class="mermaid"><code>flowchart TB
    W[Work Item] --&gt; L{Location-Aware}
    L --&gt; E[Find Nearest Edge]
    E --&gt; C{Can Process&lt;br/&gt;at Edge?}
    C --&gt;|Yes| EP[Edge Processing&lt;br/&gt;5ms latency]
    C --&gt;|No| RC{Complex Work?}
    RC --&gt;|Medium| RP[Regional DC&lt;br/&gt;20ms latency]
    RC --&gt;|Heavy| CP[Central DC&lt;br/&gt;100ms latency]

    style EP fill:#c8e6c9
    style RP fill:#fff9c4
    style CP fill:#ffccbc</code></pre>
<ol>
<li><strong>ML-Driven Scheduling</strong></li>
</ol>
<pre class="mermaid"><code>graph TB
    W[Work Item] --&gt; FE[Feature Extraction]
    FE --&gt; F1[Size]
    FE --&gt; F2[Type]
    FE --&gt; F3[History]
    FE --&gt; F4[Dependencies]

    F1 &amp; F2 &amp; F3 &amp; F4 --&gt; ML[ML Model]

    ML --&gt; P1[Execution Time]
    ML --&gt; P2[Resource Needs]
    ML --&gt; P3[Failure Risk]
    ML --&gt; P4[Optimal Worker]

    P1 &amp; P2 &amp; P3 &amp; P4 --&gt; D[Placement Decision]

    style ML fill:#e1bee7
    style D fill:#c5e1a5</code></pre>
<hr />
<h2 id="common-anti-patterns-to-avoid">Common Anti-Patterns to Avoid<a class="headerlink" href="#common-anti-patterns-to-avoid" title="Permanent link">&para;</a></h2>
<hr />
<h2 id="summary-key-takeaways">Summary: Key Takeaways<a class="headerlink" href="#summary-key-takeaways" title="Permanent link">&para;</a></h2>
<ol>
<li><strong> Intuition</strong>: Work distribution is like organizing a kitchen - specialization and coordination</li>
<li><strong> Foundation</strong>: Amdahl's Law sets hard limits on parallelization benefits</li>
<li><strong> Deep Dive</strong>: Real systems need work stealing, batching, and careful queue management</li>
<li><strong> Expert</strong>: Theory guides optimal worker counts and queue depths</li>
<li><strong> Mastery</strong>: Production systems require holistic thinking about failure, monitoring, and cost</li>
</ol>
<h3 id="the-work-distribution-commandments">The Work Distribution Commandments<a class="headerlink" href="#the-work-distribution-commandments" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Thou shalt respect Amdahl's Law</strong> - Sequential parts limit parallel gains</li>
<li><strong>Thou shalt implement backpressure</strong> - Unbounded queues are time bombs</li>
<li><strong>Thou shalt steal work</strong> - Dynamic load balancing beats static</li>
<li><strong>Thou shalt batch operations</strong> - Amortize coordination costs</li>
<li><strong>Thou shalt monitor everything</strong> - You can't optimize what you don't measure</li>
</ol>
<h3 id="quick-reference-card">Quick Reference Card<a class="headerlink" href="#quick-reference-card" title="Permanent link">&para;</a></h3>
<hr />
<p><em>"Work distribution is not just about spreading computationit's about spreading it intelligently while respecting the laws of physics and coordination."</em></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/deepaucksharma" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/deepaucksharma" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.0/dist/mermaid.min.js"></script>
      
        <script src="../../javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>