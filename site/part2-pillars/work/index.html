
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to efficiently distribute and coordinate work across multiple nodes in distributed systems">
      
      
      
        <link rel="canonical" href="https://deepaucksharma.github.io/DStudio/part2-pillars/work/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="examples/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Pillar 1: Distribution of Work - The Compendium of Distributed Systems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/modular.css">
    
      <link rel="stylesheet" href="../../stylesheets/axioms.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intuition-the-restaurant-kitchen-problem-5-min-read" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="The Compendium of Distributed Systems" class="md-header__button md-logo" aria-label="The Compendium of Distributed Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Compendium of Distributed Systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pillar 1: Distribution of Work
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Switch to auto"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to auto" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/deepaucksharma/DStudio" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    deepaucksharma/DStudio
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../introduction/" class="md-tabs__link">
          
  
  
    
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part1-axioms/" class="md-tabs__link">
          
  
  
    
  
  Part I: Axioms

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Part II: Pillars

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../patterns/" class="md-tabs__link">
          
  
  
    
  
  Part III: Patterns

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../quantitative/" class="md-tabs__link">
          
  
  
    
  
  Part IV: Quantitative Toolkit

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../human-factors/" class="md-tabs__link">
          
  
  
    
  
  Part V: Human Factors

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tools/" class="md-tabs__link">
          
  
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../case-studies/" class="md-tabs__link">
          
  
  
    
  
  Case Studies

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Compendium of Distributed Systems" class="md-nav__button md-logo" aria-label="The Compendium of Distributed Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Compendium of Distributed Systems
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/deepaucksharma/DStudio" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    deepaucksharma/DStudio
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../introduction/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/philosophy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Philosophy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part I: Axioms
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Part I: Axioms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom1-latency/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 1: Latency
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Axiom 1: Latency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom1-latency/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom1-latency/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom2-capacity/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 2: Capacity
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Axiom 2: Capacity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom2-capacity/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom2-capacity/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom3-failure/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 3: Failure
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Axiom 3: Failure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom3-failure/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom3-failure/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom4-concurrency/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 4: Concurrency
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Axiom 4: Concurrency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom4-concurrency/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom4-concurrency/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom5-coordination/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 5: Coordination
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Axiom 5: Coordination
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom5-coordination/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom5-coordination/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom6-observability/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 6: Observability
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Axiom 6: Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom6-observability/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom6-observability/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom7-human/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 7: Human Interface
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Axiom 7: Human Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom7-human/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom7-human/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../part1-axioms/axiom8-economics/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Axiom 8: Economics
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Axiom 8: Economics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom8-economics/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/axiom8-economics/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Synthesis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Synthesis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/synthesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Summary
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1-axioms/quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part II: Pillars
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Part II: Pillars
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="./" class="md-nav__link md-nav__link--active">
              
  
  
  <span class="md-ellipsis">
    Pillar 1: Work
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link md-nav__link--active" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Pillar 1: Work
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../state/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 2: State
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Pillar 2: State
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../truth/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 3: Truth
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Pillar 3: Truth
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../truth/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../truth/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../control/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 4: Control
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Pillar 4: Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../control/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../control/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../intelligence/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Pillar 5: Intelligence
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Pillar 5: Intelligence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intelligence/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intelligence/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Analysis Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Analysis Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CAST vs SPACE Models
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-collide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    When Models Collide
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Matrix
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tradeoff-calculus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trade-off Calculus
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decision-tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Decision Tree
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Exercises & Reflection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Exercises & Reflection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pillar-checkpoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pillar Checkpoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../failure-recap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Failure Recap
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reflection-journal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reflection Journal
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Pattern Preview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Pattern Preview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-catalog-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Catalog Intro
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-legend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Legend
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pillars-patterns-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pillars  Patterns Map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transition-part3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transition to Part III
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../patterns/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part III: Patterns
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Part III: Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Core Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/queues-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queues & Streaming
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/cqrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CQRS
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/event-driven/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event-Driven Architecture
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Sourcing
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/saga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Saga Pattern
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/service-mesh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Mesh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/graphql-federation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GraphQL Federation
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/serverless-faas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serverless/FaaS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Resilience Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Resilience Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/circuit-breaker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circuit Breaker
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/retry-backoff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retry & Backoff
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/bulkhead/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bulkhead
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/edge-computing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Edge Computing
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/graceful-degradation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graceful Degradation
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/health-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Health Check
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/timeout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timeout
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Data Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/cdc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CDC (Change Data Capture)
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/tunable-consistency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tunable Consistency
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/sharding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sharding
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/caching-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching Strategies
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/geo-replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geo-Replication
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Coordination Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Coordination Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/leader-election/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Leader Election
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/consensus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consensus
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/distributed-lock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Lock
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/idempotent-receiver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Idempotent Receiver
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/outbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outbox
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operational Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Operational Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/auto-scaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Auto Scaling
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/load-balancing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Balancing
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/load-shedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Shedding
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/rate-limiting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rate Limiting
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/service-discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Discovery
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/finops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FinOps
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/pattern-quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pattern Quiz
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../quantitative/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part IV: Quantitative Toolkit
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Part IV: Quantitative Toolkit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Latency & Performance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Latency & Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/latency-ladder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Latency Ladder
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/littles-law/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Little's Law
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/queueing-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queueing Theory
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Scaling Laws
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Scaling Laws
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/amdahl-gustafson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amdahl & Gustafson Laws
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/universal-scalability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Universal Scalability Law
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Economics & Planning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Economics & Planning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/coordination-costs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coordination Costs
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/cache-economics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cache Economics
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/availability-math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Availability Math
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/capacity-planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capacity Planning
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantitative/problem-set/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Problem Set
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../human-factors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Part V: Human Factors
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Part V: Human Factors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Production Excellence
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Production Excellence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/consistency-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consistency Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/chaos-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chaos Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/observability-stacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability Stacks
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operational Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Operational Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/sre-practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SRE Practices
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/org-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Org-Structure Physics
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/runbooks-playbooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runbooks & Playbooks
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Team Organization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Team Organization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/team-topologies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Team Topologies
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/knowledge-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knowledge Management
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/oncall-culture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Call Culture
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Incident Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Incident Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/incident-response/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incident Response
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../human-factors/blameless-postmortems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blameless Postmortems
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../case-studies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Case Studies
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Case Studies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/amazon-dynamo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon DynamoDB
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/paypal-payments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PayPal Payments
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/spotify-recommendations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spotify Recommendations
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../case-studies/uber-location/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Uber Location Services
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  
    
  
  
    <span class="md-status md-status--stub"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cheat-sheets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cheat Sheets
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/recipe-cards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recipe Cards
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  
    
  
  
    <span class="md-status md-status--complete"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h2 id="intuition-the-restaurant-kitchen-problem-5-min-read"> Intuition: The Restaurant Kitchen Problem (5 min read)<a class="headerlink" href="#intuition-the-restaurant-kitchen-problem-5-min-read" title="Permanent link">&para;</a></h2>
<p>Imagine a busy restaurant kitchen during dinner rush. Orders flood in: steaks, salads, desserts. One chef trying to cook everything would create a massive bottleneck. Instead, they organize:</p>
<ul>
<li><strong>Grill station</strong>: Handles all meat</li>
<li><strong>Salad station</strong>: Prepares cold dishes</li>
<li><strong>Pastry station</strong>: Makes desserts</li>
<li><strong>Expeditor</strong>: Coordinates and quality checks</li>
</ul>
<p>This is distributed work: <strong>breaking down complex tasks into parallel, specialized units that can execute independently while maintaining overall coordination</strong>.</p>
<p> <strong>Key Insight</strong>: The best kitchens aren't the ones with the most chefs, but the ones with the smartest work distribution.</p>
<h3 id="why-this-matters">Why This Matters<a class="headerlink" href="#why-this-matters" title="Permanent link">&para;</a></h3>
<p>Every time you:
- Process millions of database records
- Encode video for streaming
- Handle thousands of API requests
- Train a machine learning model</p>
<p>You're solving the same fundamental problem: how to split work efficiently across available resources.</p>
<hr />
<h2 id="questions-this-pillar-answers"> Questions This Pillar Answers<a class="headerlink" href="#questions-this-pillar-answers" title="Permanent link">&para;</a></h2>
<hr />
<h2 id="foundation-understanding-work-distribution-15-min-read"> Foundation: Understanding Work Distribution (15 min read)<a class="headerlink" href="#foundation-understanding-work-distribution-15-min-read" title="Permanent link">&para;</a></h2>
<h3 id="the-central-question">The Central Question<a class="headerlink" href="#the-central-question" title="Permanent link">&para;</a></h3>
<p>How do you break computation into pieces that can run on different machines while minimizing coordination overhead and maximizing throughput?</p>
<h3 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h3>
<h3 id="the-fundamental-trade-offs">The Fundamental Trade-offs<a class="headerlink" href="#the-fundamental-trade-offs" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">No Free Lunch in Work Distribution</p>
<p>Every choice in work distribution involves trade-offs:</p>
<p><strong>Parallelism vs Coordination Overhead</strong>
- More workers = More communication needed
- Amdahl's Law: Serial portions limit speedup
- Eventually coordination costs exceed computation savings</p>
<p><strong>Latency vs Throughput</strong>
- Batching improves throughput but increases latency
- Small batches = Low latency but more overhead
- Must choose based on use case requirements</p>
<p><strong>Simplicity vs Performance</strong>
- Simple round-robin vs complex work stealing
- Static partitioning vs dynamic rebalancing
- Easier to debug vs harder to optimize</p>
</div>
<h3 id="the-work-decomposition-matrix">The Work Decomposition Matrix<a class="headerlink" href="#the-work-decomposition-matrix" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Dimension        Options              Trade-offs                Real Example
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>---------        -------              ----------                ------------
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Space           Single/Multi-node     Latency vs Isolation      Redis vs Cassandra
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>Time            Sync/Async           Consistency vs Throughput  REST vs Kafka
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Data            Shared/Partitioned   Simplicity vs Scale        PostgreSQL vs MongoDB sharding
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>Control         Centralized/P2P      Coordination vs Resilience Kubernetes vs BitTorrent
</span></code></pre></div>
<h3 id="when-work-distribution-goes-wrong">When Work Distribution Goes Wrong<a class="headerlink" href="#when-work-distribution-goes-wrong" title="Permanent link">&para;</a></h3>
<div class="admonition danger">
<p class="admonition-title">Common Anti-Patterns</p>
<p><strong>The Overeager Parallelizer</strong>: Breaking work into pieces smaller than coordination overhead
- Example: 1000 workers processing 1000 items = mostly waiting
- Solution: Batch work to amortize coordination costs</p>
<p><strong>The Hotspot Creator</strong>: Uneven work distribution causing bottlenecks
- Example: All video encoding jobs hitting the same worker
- Solution: Content-aware load balancing or work stealing</p>
<p><strong>The Thundering Herd</strong>: All workers starting simultaneously
- Example: Cron job at midnight across all servers
- Solution: Jittered starts and gradual ramp-up</p>
</div>
<h3 id="concept-map-work-distribution">Concept Map: Work Distribution<a class="headerlink" href="#concept-map-work-distribution" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "Work Distribution Pillar"
        Core[Work Distribution&lt;br/&gt;Core Concept]

        Core --&gt; Decomp[Work Decomposition]
        Core --&gt; Coord[Coordination Models]
        Core --&gt; Sched[Scheduling Strategies]
        Core --&gt; Scale[Scaling Patterns]

        %% Decomposition branch
        Decomp --&gt; DataPar[Data Parallelism&lt;br/&gt;Same operation, different data]
        Decomp --&gt; TaskPar[Task Parallelism&lt;br/&gt;Different operations]
        Decomp --&gt; Pipeline[Pipeline Parallelism&lt;br/&gt;Sequential stages]

        %% Coordination branch
        Coord --&gt; MasterWorker[Master-Worker&lt;br/&gt;Centralized control]
        Coord --&gt; P2P[Peer-to-Peer&lt;br/&gt;Decentralized]
        Coord --&gt; WorkSteal[Work Stealing&lt;br/&gt;Dynamic balancing]

        %% Scheduling branch
        Sched --&gt; Static[Static Assignment&lt;br/&gt;Pre-determined]
        Sched --&gt; Dynamic[Dynamic Assignment&lt;br/&gt;Runtime decisions]
        Sched --&gt; Adaptive[Adaptive Scheduling&lt;br/&gt;Learning-based]

        %% Scaling branch
        Scale --&gt; Horizontal[Horizontal Scaling&lt;br/&gt;Add more workers]
        Scale --&gt; Vertical[Vertical Scaling&lt;br/&gt;Bigger workers]
        Scale --&gt; Elastic[Elastic Scaling&lt;br/&gt;Auto-adjust]

        %% Key relationships
        DataPar -.-&gt; Static
        TaskPar -.-&gt; Dynamic
        Pipeline -.-&gt; MasterWorker
        WorkSteal -.-&gt; Adaptive

        %% Axiom connections
        Axiom1[Axiom 1: Latency] --&gt; Coord
        Axiom2[Axiom 2: Capacity] --&gt; Scale
        Axiom3[Axiom 3: Failure] --&gt; WorkSteal
        Axiom4[Axiom 4: Concurrency] --&gt; Decomp
        Axiom5[Axiom 5: Coordination] --&gt; Sched
    end

    style Core fill:#f9f,stroke:#333,stroke-width:4px
    style Axiom1 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom2 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom3 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom4 fill:#e1e1ff,stroke:#333,stroke-width:2px
    style Axiom5 fill:#e1e1ff,stroke:#333,stroke-width:2px</code></pre>
<p>This concept map shows how work distribution connects fundamental axioms to practical implementation patterns. Each branch represents a key decision area, with dotted lines showing common associations between concepts.</p>
<h3 id="work-distribution-decision-framework">Work Distribution Decision Framework<a class="headerlink" href="#work-distribution-decision-framework" title="Permanent link">&para;</a></h3>
<h3 id="simple-example-processing-user-uploads">Simple Example: Processing User Uploads<a class="headerlink" href="#simple-example-processing-user-uploads" title="Permanent link">&para;</a></h3>
<p>When a user uploads a photo to Instagram:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Sequential (slow)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_upload</span><span class="p">(</span><span class="n">photo</span><span class="p">):</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">resized</span> <span class="o">=</span> <span class="n">resize_image</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>        <span class="c1"># 500ms</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">thumbnails</span> <span class="o">=</span> <span class="n">generate_thumbnails</span><span class="p">(</span><span class="n">resized</span><span class="p">)</span>  <span class="c1"># 300ms</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">filters</span> <span class="o">=</span> <span class="n">apply_filters</span><span class="p">(</span><span class="n">resized</span><span class="p">)</span>     <span class="c1"># 400ms</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>    <span class="c1"># 100ms</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">store_all</span><span class="p">(</span><span class="n">resized</span><span class="p">,</span> <span class="n">thumbnails</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>  <span class="c1"># 200ms</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="c1"># Total: 1500ms sequential</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># Parallel (fast)</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_upload_parallel</span><span class="p">(</span><span class="n">photo</span><span class="p">):</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="c1"># These can all happen at the same time!</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        <span class="n">resize_image</span><span class="p">(</span><span class="n">photo</span><span class="p">),</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span class="n">extract_metadata</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="p">]</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="n">resized</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="c1"># These depend on resized, but can run in parallel</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>        <span class="n">generate_thumbnails</span><span class="p">(</span><span class="n">resized</span><span class="p">),</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>        <span class="n">apply_filters</span><span class="p">(</span><span class="n">resized</span><span class="p">)</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="p">]</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    <span class="n">thumbnails</span><span class="p">,</span> <span class="n">filters</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    <span class="k">await</span> <span class="n">store_all</span><span class="p">(</span><span class="n">resized</span><span class="p">,</span> <span class="n">thumbnails</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="c1"># Total: ~700ms (resize + thumbnails/filters + store)</span>
</span></code></pre></div>
<h3 id="amdahls-law-the-fundamental-limit">Amdahl's Law: The Fundamental Limit<a class="headerlink" href="#amdahls-law-the-fundamental-limit" title="Permanent link">&para;</a></h3>
<p>No matter how many workers you add, speedup is limited by sequential parts:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Speedup = 1 / (S + P/N)
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Where:
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>S = Sequential fraction (can&#39;t be parallelized)
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>P = Parallel fraction (can be parallelized)
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>N = Number of processors
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>Example:
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>If 10% must be sequential (S=0.1):
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>- With 10 processors: Speedup = 5.3x (not 10x!)
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>- With 100 processors: Speedup = 9.2x (not 100x!)
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>- With  processors: Speedup = 10x (hard limit)
</span></code></pre></div>
<hr />
<h2 id="deep-dive-engineering-work-distribution-30-min-read"> Deep Dive: Engineering Work Distribution (30 min read)<a class="headerlink" href="#deep-dive-engineering-work-distribution-30-min-read" title="Permanent link">&para;</a></h2>
<h3 id="real-failure-the-netflix-encoding-disaster">Real Failure: The Netflix Encoding Disaster<a class="headerlink" href="#real-failure-the-netflix-encoding-disaster" title="Permanent link">&para;</a></h3>
<p><strong>Company</strong>: Netflix
<strong>Date</strong>: 2008
<strong>Impact</strong>: 3-day outage for new content</p>
<p><strong>The Problem</strong>:
- Monolithic encoding server
- Single queue for all videos
- One crash = entire pipeline stops
- 12-hour encode time for 2-hour movie</p>
<p><strong>The Root Cause</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Original monolithic approach</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">VideoEncoder</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encode_movie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movie_file</span><span class="p">):</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="c1"># Problem 1: Can&#39;t parallelize within movie</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="k">for</span> <span class="n">minute</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">duration_minutes</span><span class="p">):</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>            <span class="n">encode_minute</span><span class="p">(</span><span class="n">minute</span><span class="p">)</span>  <span class="c1"># 6 minutes per minute of video!</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="c1"># Problem 2: One failure loses all progress</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># 1% chance of failure</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Encoding failed at minute &quot;</span> <span class="o">+</span> <span class="n">minute</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            <span class="c1"># Must restart from beginning!</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>        <span class="c1"># Problem 3: Can&#39;t scale horizontally</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        <span class="c1"># Adding more servers doesn&#39;t help single movie encode faster</span>
</span></code></pre></div></p>
<p><strong>The Fix: Distributed Encoding Pipeline</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DistributedVideoEncoder</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encode_movie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movie_file</span><span class="p">):</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="c1"># Split into 10-second chunks</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="n">split_into_chunks</span><span class="p">(</span><span class="n">movie_file</span><span class="p">,</span> <span class="n">duration_seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="c1"># Map: Encode each chunk independently</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="n">encoding_tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>            <span class="n">task</span> <span class="o">=</span> <span class="n">EncodingTask</span><span class="p">(</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>                <span class="n">chunk_id</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>                <span class="n">chunk_data</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>                <span class="n">output_formats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1080p&#39;</span><span class="p">,</span> <span class="s1">&#39;720p&#39;</span><span class="p">,</span> <span class="s1">&#39;480p&#39;</span><span class="p">],</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>                <span class="n">retry_on_failure</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>            <span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>            <span class="n">encoding_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submit_to_queue</span><span class="p">(</span><span class="n">task</span><span class="p">))</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>        <span class="c1"># Reduce: Combine when all complete</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        <span class="n">encoded_chunks</span> <span class="o">=</span> <span class="n">wait_for_all</span><span class="p">(</span><span class="n">encoding_tasks</span><span class="p">)</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>        <span class="n">final_video</span> <span class="o">=</span> <span class="n">stitch_chunks</span><span class="p">(</span><span class="n">encoded_chunks</span><span class="p">)</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>        <span class="k">return</span> <span class="n">final_video</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="c1"># Benefits:</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="c1"># - 720 chunks can encode in parallel (2hr movie)</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="c1"># - Failure only affects 10-second chunk</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="c1"># - Scales linearly with workers</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="c1"># - 12 hours  20 minutes for 2-hour movie</span>
</span></code></pre></div></p>
<h3 id="work-distribution-patterns">Work Distribution Patterns<a class="headerlink" href="#work-distribution-patterns" title="Permanent link">&para;</a></h3>
<h4 id="1-master-worker-pattern">1. Master-Worker Pattern<a class="headerlink" href="#1-master-worker-pattern" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MasterWorkerSystem</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">):</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">):</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>            <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_queue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_queue</span><span class="p">)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>            <span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">distribute_work</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>        <span class="c1"># Master distributes</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">task_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="c1"># Collect results</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">Worker</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_queue</span><span class="p">,</span> <span class="n">result_queue</span><span class="p">):</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_queue</span> <span class="o">=</span> <span class="n">task_queue</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result_queue</span> <span class="o">=</span> <span class="n">result_queue</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>            <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>                <span class="k">break</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">result_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">result_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">Error</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span></code></pre></div>
<p><strong>Pros</strong>: Simple, centralized control
<strong>Cons</strong>: Master is bottleneck and SPOF</p>
<h4 id="2-work-stealing-pattern">2. Work-Stealing Pattern<a class="headerlink" href="#2-work-stealing-pattern" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">WorkStealingScheduler</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">):</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">):</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>            <span class="n">worker</span> <span class="o">=</span> <span class="n">WorkStealingWorker</span><span class="p">(</span><span class="n">worker_id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>        <span class="c1"># Each worker knows about others for stealing</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="k">for</span> <span class="n">worker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            <span class="n">worker</span><span class="o">.</span><span class="n">set_peers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">WorkStealingWorker</span><span class="p">:</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">):</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">worker_id</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># Double-ended queue</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">peers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        <span class="c1"># Push to bottom of local queue</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>        <span class="c1"># Try local queue first (LIFO for cache locality)</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="p">:</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>        <span class="c1"># Local queue empty, try stealing</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steal_task</span><span class="p">()</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">steal_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>        <span class="c1"># Randomly try to steal from peers</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>        <span class="n">victims</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="p">))</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>        <span class="k">for</span> <span class="n">victim</span> <span class="ow">in</span> <span class="n">victims</span><span class="p">:</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>            <span class="k">if</span> <span class="n">victim</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>                <span class="k">continue</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>            <span class="c1"># Steal from top (FIFO) to minimize contention</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>            <span class="k">if</span> <span class="n">victim</span><span class="o">.</span><span class="n">local_queue</span><span class="p">:</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>                    <span class="k">return</span> <span class="n">victim</span><span class="o">.</span><span class="n">local_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>                    <span class="k">continue</span>  <span class="c1"># Someone else stole it</span>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No work available</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="c1"># Why this works brilliantly:</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="c1"># 1. No central coordinator (resilient)</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="c1"># 2. Automatic load balancing</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="c1"># 3. Good cache locality (process own work first)</span>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="c1"># 4. Minimal contention (steal from opposite end)</span>
</span></code></pre></div>
<h4 id="3-mapreduce-pattern">3. MapReduce Pattern<a class="headerlink" href="#3-mapreduce-pattern" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MapReduceJob</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_func</span><span class="p">,</span> <span class="n">reduce_func</span><span class="p">):</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">map_func</span> <span class="o">=</span> <span class="n">map_func</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_func</span> <span class="o">=</span> <span class="n">reduce_func</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">):</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        <span class="c1"># Phase 1: Map</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_input</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="n">map_results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>            <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>                <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_phase</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>                <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>                <span class="n">map_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>        <span class="c1"># Phase 2: Shuffle (group by key)</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>        <span class="n">shuffled</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">map_results</span><span class="p">:</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>            <span class="n">shuffled</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>        <span class="c1"># Phase 3: Reduce</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>        <span class="n">final_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>            <span class="n">futures</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>                <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduce_func</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>                <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>                <span class="n">final_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>        <span class="k">return</span> <span class="n">final_results</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">map_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>            <span class="c1"># map_func emits (key, value) pairs</span>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_func</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="c1"># Classic word count example</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="k">def</span><span class="w"> </span><span class="nf">word_count_map</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>        <span class="k">yield</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="k">def</span><span class="w"> </span><span class="nf">word_count_reduce</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="c1"># Usage</span>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a><span class="n">job</span> <span class="o">=</span> <span class="n">MapReduceJob</span><span class="p">(</span><span class="n">word_count_map</span><span class="p">,</span> <span class="n">word_count_reduce</span><span class="p">)</span>
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a><span class="n">word_counts</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="the-coordination-tax">The Coordination Tax<a class="headerlink" href="#the-coordination-tax" title="Permanent link">&para;</a></h3>
<p>Every distributed system pays a coordination tax:</p>
<h3 id="load-balancing-strategies">Load Balancing Strategies<a class="headerlink" href="#load-balancing-strategies" title="Permanent link">&para;</a></h3>
<hr />
<h2 id="expert-theory-and-advanced-techniques-45-min-read"> Expert: Theory and Advanced Techniques (45 min read)<a class="headerlink" href="#expert-theory-and-advanced-techniques-45-min-read" title="Permanent link">&para;</a></h2>
<h3 id="theoretical-foundations">Theoretical Foundations<a class="headerlink" href="#theoretical-foundations" title="Permanent link">&para;</a></h3>
<h4 id="universal-scalability-law">Universal Scalability Law<a class="headerlink" href="#universal-scalability-law" title="Permanent link">&para;</a></h4>
<p>Neil Gunther's USL extends Amdahl's Law to include coherency costs:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="l l-Scalar l-Scalar-Plain">C(N) = N / (1 + (N-1) + N(N-1))</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="l l-Scalar l-Scalar-Plain">Where</span><span class="p p-Indicator">:</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="l l-Scalar l-Scalar-Plain">C(N) = Capacity/throughput with N processors</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="l l-Scalar l-Scalar-Plain"> = Contention coefficient (serialization)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="l l-Scalar l-Scalar-Plain"> = Coherency coefficient (coordination)</span>
</span></code></pre></div>
<p><strong>Visual Scalability Analysis</strong>:</p>
<p>def find_optimal_workers(alpha, beta):
    """Find N that maximizes capacity"""
    max_capacity = 0
    optimal_n = 1</p>
<div class="language-text highlight"><pre><span></span><code>for n in range(1, 1000):
    capacity = universal_scalability_law(n, alpha, beta)
    if capacity &gt; max_capacity:
        max_capacity = capacity
        optimal_n = n
    elif capacity &lt; max_capacity * 0.95:
        break  # Declining significantly

return optimal_n, max_capacity
</code></pre></div>
<h1 id="example-different-workload-characteristics">Example: Different workload characteristics<a class="headerlink" href="#example-different-workload-characteristics" title="Permanent link">&para;</a></h1>
<p>workloads = [
    ("Embarrassingly Parallel", 0.01, 0.0001),
    ("Moderate Coordination", 0.05, 0.001),
    ("High Contention", 0.1, 0.01),
    ("Extreme Coordination", 0.2, 0.02)
]</p>
<p>for name, alpha, beta in workloads:
    optimal_n, max_cap = find_optimal_workers(alpha, beta)
    print(f"{name}:")
    print(f"  Optimal workers: {optimal_n}")
    print(f"  Max speedup: {max_cap:.1f}x")
    print(f"  At 2x workers: {universal_scalability_law(optimal_n*2, alpha, beta):.1f}x")
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">#### Queue Theory for Work Distribution</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Little<span class="err">&#39;</span>s<span class="w"> </span>Law<span class="w"> </span>provides<span class="w"> </span>fundamental<span class="w"> </span>insights:
</span></code></pre></div>
L = W</p>
<p>Where:
L = Average number of items in system
 = Average arrival rate
W = Average time in system
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>Applied to work queues:
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>```python
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>class QueueAnalyzer:
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    def __init__(self):
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        self.arrivals = []
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        self.departures = []
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    def analyze_queue_behavior(self):
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        # Calculate key metrics
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        arrival_rate = len(self.arrivals) / (self.arrivals[-1] - self.arrivals[0])
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>        # Average time in system
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        total_time = sum(d - a for a, d in zip(self.arrivals, self.departures))
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>        avg_time = total_time / len(self.departures)
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        # Little&#39;s Law validation
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>        avg_queue_length = arrival_rate * avg_time
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>        # M/M/1 queue formulas (if Poisson arrivals, exponential service)
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>        utilization = arrival_rate / service_rate
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        avg_wait_time = utilization / (service_rate * (1 - utilization))
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>        return {
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>            &#39;arrival_rate&#39;: arrival_rate,
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>            &#39;avg_time_in_system&#39;: avg_time,
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>            &#39;avg_queue_length&#39;: avg_queue_length,
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>            &#39;utilization&#39;: utilization,
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>            &#39;avg_wait_time&#39;: avg_wait_time
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>        }
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>```bash
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>### Advanced Work Distribution Algorithms
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>#### Consistent Hashing with Virtual Nodes
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>```python
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>class ConsistentHashRing:
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>    def __init__(self, nodes, virtual_nodes=150):
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>        self.ring = {}
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>        self.sorted_keys = []
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>        self.virtual_nodes = virtual_nodes
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>        self.nodes = nodes
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>        self._build_ring()
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>    def _hash(self, key):
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>        return int(hashlib.md5(key.encode()).hexdigest(), 16)
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>    def _build_ring(self):
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>        for node in self.nodes:
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>            for i in range(self.virtual_nodes):
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>                virtual_key = f&quot;{node}:{i}&quot;
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>                hash_value = self._hash(virtual_key)
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a>                self.ring[hash_value] = node
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>        self.sorted_keys = sorted(self.ring.keys())
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>    def get_node(self, key):
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a>        &quot;&quot;&quot;Find node responsible for key&quot;&quot;&quot;
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>        if not self.ring:
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a>            return None
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a>        hash_value = self._hash(key)
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a>        # Binary search for first node &gt;= hash
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>        idx = bisect_right(self.sorted_keys, hash_value)
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a>        # Wrap around to first node
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a>        if idx == len(self.sorted_keys):
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a>            idx = 0
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a>        return self.ring[self.sorted_keys[idx]]
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a>    def add_node(self, node):
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a>        &quot;&quot;&quot;Add node with minimal disruption&quot;&quot;&quot;
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a>        self.nodes.append(node)
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a>        for i in range(self.virtual_nodes):
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a>            virtual_key = f&quot;{node}:{i}&quot;
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a>            hash_value = self._hash(virtual_key)
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a>            self.ring[hash_value] = node
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a>            bisect.insort(self.sorted_keys, hash_value)
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a>    def remove_node(self, node):
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a>        &quot;&quot;&quot;Remove node and rebalance&quot;&quot;&quot;
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a>        self.nodes.remove(node)
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a>        for i in range(self.virtual_nodes):
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a>            virtual_key = f&quot;{node}:{i}&quot;
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a>            hash_value = self._hash(virtual_key)
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a>            del self.ring[hash_value]
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a>            self.sorted_keys.remove(hash_value)
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a>    def get_replication_nodes(self, key, n=3):
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a>        &quot;&quot;&quot;Get N nodes for replication&quot;&quot;&quot;
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a>        if not self.ring:
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a>            return []
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a>        hash_value = self._hash(key)
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a>        idx = bisect_right(self.sorted_keys, hash_value)
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a>        nodes = []
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a>        seen = set()
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105" href="#__codelineno-10-105"></a>        for i in range(len(self.sorted_keys)):
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106" href="#__codelineno-10-106"></a>            actual_idx = (idx + i) % len(self.sorted_keys)
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107" href="#__codelineno-10-107"></a>            node = self.ring[self.sorted_keys[actual_idx]]
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108" href="#__codelineno-10-108"></a>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109" href="#__codelineno-10-109"></a>            if node not in seen:
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110" href="#__codelineno-10-110"></a>                nodes.append(node)
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111" href="#__codelineno-10-111"></a>                seen.add(node)
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112" href="#__codelineno-10-112"></a>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113" href="#__codelineno-10-113"></a>            if len(nodes) &gt;= n:
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114" href="#__codelineno-10-114"></a>                break
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115" href="#__codelineno-10-115"></a>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116" href="#__codelineno-10-116"></a>        return nodes
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117" href="#__codelineno-10-117"></a>```bash
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118" href="#__codelineno-10-118"></a>#### Two-Phase Commit for Distributed Work
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119" href="#__codelineno-10-119"></a>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120" href="#__codelineno-10-120"></a>```python
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121" href="#__codelineno-10-121"></a>class TwoPhaseCommitCoordinator:
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122" href="#__codelineno-10-122"></a>    def __init__(self, participants):
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123" href="#__codelineno-10-123"></a>        self.participants = participants
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124" href="#__codelineno-10-124"></a>        self.tx_log = []
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125" href="#__codelineno-10-125"></a>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126" href="#__codelineno-10-126"></a>    def execute_transaction(self, transaction_id, work_items):
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127" href="#__codelineno-10-127"></a>        &quot;&quot;&quot;Execute distributed transaction with 2PC&quot;&quot;&quot;
</span><span id="__span-10-128"><a id="__codelineno-10-128" name="__codelineno-10-128" href="#__codelineno-10-128"></a>
</span><span id="__span-10-129"><a id="__codelineno-10-129" name="__codelineno-10-129" href="#__codelineno-10-129"></a>        # Phase 1: Prepare
</span><span id="__span-10-130"><a id="__codelineno-10-130" name="__codelineno-10-130" href="#__codelineno-10-130"></a>        prepare_results = {}
</span><span id="__span-10-131"><a id="__codelineno-10-131" name="__codelineno-10-131" href="#__codelineno-10-131"></a>
</span><span id="__span-10-132"><a id="__codelineno-10-132" name="__codelineno-10-132" href="#__codelineno-10-132"></a>        for participant, work in zip(self.participants, work_items):
</span><span id="__span-10-133"><a id="__codelineno-10-133" name="__codelineno-10-133" href="#__codelineno-10-133"></a>            try:
</span><span id="__span-10-134"><a id="__codelineno-10-134" name="__codelineno-10-134" href="#__codelineno-10-134"></a>                can_commit = participant.prepare(transaction_id, work)
</span><span id="__span-10-135"><a id="__codelineno-10-135" name="__codelineno-10-135" href="#__codelineno-10-135"></a>                prepare_results[participant] = can_commit
</span><span id="__span-10-136"><a id="__codelineno-10-136" name="__codelineno-10-136" href="#__codelineno-10-136"></a>                self.tx_log.append((&#39;PREPARE&#39;, transaction_id, participant.id, can_commit))
</span><span id="__span-10-137"><a id="__codelineno-10-137" name="__codelineno-10-137" href="#__codelineno-10-137"></a>            except Exception as e:
</span><span id="__span-10-138"><a id="__codelineno-10-138" name="__codelineno-10-138" href="#__codelineno-10-138"></a>                prepare_results[participant] = False
</span><span id="__span-10-139"><a id="__codelineno-10-139" name="__codelineno-10-139" href="#__codelineno-10-139"></a>                self.tx_log.append((&#39;PREPARE_FAILED&#39;, transaction_id, participant.id, str(e)))
</span><span id="__span-10-140"><a id="__codelineno-10-140" name="__codelineno-10-140" href="#__codelineno-10-140"></a>
</span><span id="__span-10-141"><a id="__codelineno-10-141" name="__codelineno-10-141" href="#__codelineno-10-141"></a>        # Decision point
</span><span id="__span-10-142"><a id="__codelineno-10-142" name="__codelineno-10-142" href="#__codelineno-10-142"></a>        all_prepared = all(prepare_results.values())
</span><span id="__span-10-143"><a id="__codelineno-10-143" name="__codelineno-10-143" href="#__codelineno-10-143"></a>
</span><span id="__span-10-144"><a id="__codelineno-10-144" name="__codelineno-10-144" href="#__codelineno-10-144"></a>        if all_prepared:
</span><span id="__span-10-145"><a id="__codelineno-10-145" name="__codelineno-10-145" href="#__codelineno-10-145"></a>            self.tx_log.append((&#39;COMMIT_DECISION&#39;, transaction_id))
</span><span id="__span-10-146"><a id="__codelineno-10-146" name="__codelineno-10-146" href="#__codelineno-10-146"></a>            # Phase 2: Commit
</span><span id="__span-10-147"><a id="__codelineno-10-147" name="__codelineno-10-147" href="#__codelineno-10-147"></a>            for participant in self.participants:
</span><span id="__span-10-148"><a id="__codelineno-10-148" name="__codelineno-10-148" href="#__codelineno-10-148"></a>                try:
</span><span id="__span-10-149"><a id="__codelineno-10-149" name="__codelineno-10-149" href="#__codelineno-10-149"></a>                    participant.commit(transaction_id)
</span><span id="__span-10-150"><a id="__codelineno-10-150" name="__codelineno-10-150" href="#__codelineno-10-150"></a>                    self.tx_log.append((&#39;COMMITTED&#39;, transaction_id, participant.id))
</span><span id="__span-10-151"><a id="__codelineno-10-151" name="__codelineno-10-151" href="#__codelineno-10-151"></a>                except Exception as e:
</span><span id="__span-10-152"><a id="__codelineno-10-152" name="__codelineno-10-152" href="#__codelineno-10-152"></a>                    # Participant must eventually commit based on decision
</span><span id="__span-10-153"><a id="__codelineno-10-153" name="__codelineno-10-153" href="#__codelineno-10-153"></a>                    self.tx_log.append((&#39;COMMIT_FAILED&#39;, transaction_id, participant.id, str(e)))
</span><span id="__span-10-154"><a id="__codelineno-10-154" name="__codelineno-10-154" href="#__codelineno-10-154"></a>
</span><span id="__span-10-155"><a id="__codelineno-10-155" name="__codelineno-10-155" href="#__codelineno-10-155"></a>            return True
</span><span id="__span-10-156"><a id="__codelineno-10-156" name="__codelineno-10-156" href="#__codelineno-10-156"></a>        else:
</span><span id="__span-10-157"><a id="__codelineno-10-157" name="__codelineno-10-157" href="#__codelineno-10-157"></a>            self.tx_log.append((&#39;ABORT_DECISION&#39;, transaction_id))
</span><span id="__span-10-158"><a id="__codelineno-10-158" name="__codelineno-10-158" href="#__codelineno-10-158"></a>            # Phase 2: Rollback
</span><span id="__span-10-159"><a id="__codelineno-10-159" name="__codelineno-10-159" href="#__codelineno-10-159"></a>            for participant in self.participants:
</span><span id="__span-10-160"><a id="__codelineno-10-160" name="__codelineno-10-160" href="#__codelineno-10-160"></a>                if prepare_results.get(participant, False):
</span><span id="__span-10-161"><a id="__codelineno-10-161" name="__codelineno-10-161" href="#__codelineno-10-161"></a>                    try:
</span><span id="__span-10-162"><a id="__codelineno-10-162" name="__codelineno-10-162" href="#__codelineno-10-162"></a>                        participant.rollback(transaction_id)
</span><span id="__span-10-163"><a id="__codelineno-10-163" name="__codelineno-10-163" href="#__codelineno-10-163"></a>                        self.tx_log.append((&#39;ROLLED_BACK&#39;, transaction_id, participant.id))
</span><span id="__span-10-164"><a id="__codelineno-10-164" name="__codelineno-10-164" href="#__codelineno-10-164"></a>                    except Exception as e:
</span><span id="__span-10-165"><a id="__codelineno-10-165" name="__codelineno-10-165" href="#__codelineno-10-165"></a>                        self.tx_log.append((&#39;ROLLBACK_FAILED&#39;, transaction_id, participant.id, str(e)))
</span><span id="__span-10-166"><a id="__codelineno-10-166" name="__codelineno-10-166" href="#__codelineno-10-166"></a>
</span><span id="__span-10-167"><a id="__codelineno-10-167" name="__codelineno-10-167" href="#__codelineno-10-167"></a>            return False
</span><span id="__span-10-168"><a id="__codelineno-10-168" name="__codelineno-10-168" href="#__codelineno-10-168"></a>```bash
</span><span id="__span-10-169"><a id="__codelineno-10-169" name="__codelineno-10-169" href="#__codelineno-10-169"></a>### Research Frontiers
</span><span id="__span-10-170"><a id="__codelineno-10-170" name="__codelineno-10-170" href="#__codelineno-10-170"></a>
</span><span id="__span-10-171"><a id="__codelineno-10-171" name="__codelineno-10-171" href="#__codelineno-10-171"></a>#### Speculative Execution
</span><span id="__span-10-172"><a id="__codelineno-10-172" name="__codelineno-10-172" href="#__codelineno-10-172"></a>
</span><span id="__span-10-173"><a id="__codelineno-10-173" name="__codelineno-10-173" href="#__codelineno-10-173"></a>```python
</span><span id="__span-10-174"><a id="__codelineno-10-174" name="__codelineno-10-174" href="#__codelineno-10-174"></a>class SpeculativeExecutor:
</span><span id="__span-10-175"><a id="__codelineno-10-175" name="__codelineno-10-175" href="#__codelineno-10-175"></a>    &quot;&quot;&quot;Execute work optimistically before knowing if it&#39;s needed&quot;&quot;&quot;
</span><span id="__span-10-176"><a id="__codelineno-10-176" name="__codelineno-10-176" href="#__codelineno-10-176"></a>
</span><span id="__span-10-177"><a id="__codelineno-10-177" name="__codelineno-10-177" href="#__codelineno-10-177"></a>    def __init__(self, predictor):
</span><span id="__span-10-178"><a id="__codelineno-10-178" name="__codelineno-10-178" href="#__codelineno-10-178"></a>        self.predictor = predictor
</span><span id="__span-10-179"><a id="__codelineno-10-179" name="__codelineno-10-179" href="#__codelineno-10-179"></a>        self.speculative_cache = {}
</span><span id="__span-10-180"><a id="__codelineno-10-180" name="__codelineno-10-180" href="#__codelineno-10-180"></a>
</span><span id="__span-10-181"><a id="__codelineno-10-181" name="__codelineno-10-181" href="#__codelineno-10-181"></a>    def execute_with_speculation(self, primary_work, possible_branches):
</span><span id="__span-10-182"><a id="__codelineno-10-182" name="__codelineno-10-182" href="#__codelineno-10-182"></a>        # Start primary work
</span><span id="__span-10-183"><a id="__codelineno-10-183" name="__codelineno-10-183" href="#__codelineno-10-183"></a>        primary_future = self.submit_work(primary_work)
</span><span id="__span-10-184"><a id="__codelineno-10-184" name="__codelineno-10-184" href="#__codelineno-10-184"></a>
</span><span id="__span-10-185"><a id="__codelineno-10-185" name="__codelineno-10-185" href="#__codelineno-10-185"></a>        # Predict which branch is likely
</span><span id="__span-10-186"><a id="__codelineno-10-186" name="__codelineno-10-186" href="#__codelineno-10-186"></a>        predictions = self.predictor.predict_branches(primary_work, possible_branches)
</span><span id="__span-10-187"><a id="__codelineno-10-187" name="__codelineno-10-187" href="#__codelineno-10-187"></a>
</span><span id="__span-10-188"><a id="__codelineno-10-188" name="__codelineno-10-188" href="#__codelineno-10-188"></a>        # Speculatively execute likely branches
</span><span id="__span-10-189"><a id="__codelineno-10-189" name="__codelineno-10-189" href="#__codelineno-10-189"></a>        speculative_futures = {}
</span><span id="__span-10-190"><a id="__codelineno-10-190" name="__codelineno-10-190" href="#__codelineno-10-190"></a>        for branch, probability in predictions.items():
</span><span id="__span-10-191"><a id="__codelineno-10-191" name="__codelineno-10-191" href="#__codelineno-10-191"></a>            if probability &gt; 0.3:  # Threshold for speculation
</span><span id="__span-10-192"><a id="__codelineno-10-192" name="__codelineno-10-192" href="#__codelineno-10-192"></a>                future = self.submit_work(branch)
</span><span id="__span-10-193"><a id="__codelineno-10-193" name="__codelineno-10-193" href="#__codelineno-10-193"></a>                speculative_futures[branch] = future
</span><span id="__span-10-194"><a id="__codelineno-10-194" name="__codelineno-10-194" href="#__codelineno-10-194"></a>
</span><span id="__span-10-195"><a id="__codelineno-10-195" name="__codelineno-10-195" href="#__codelineno-10-195"></a>        # Wait for primary work
</span><span id="__span-10-196"><a id="__codelineno-10-196" name="__codelineno-10-196" href="#__codelineno-10-196"></a>        primary_result = primary_future.get()
</span><span id="__span-10-197"><a id="__codelineno-10-197" name="__codelineno-10-197" href="#__codelineno-10-197"></a>
</span><span id="__span-10-198"><a id="__codelineno-10-198" name="__codelineno-10-198" href="#__codelineno-10-198"></a>        # Determine actual branch
</span><span id="__span-10-199"><a id="__codelineno-10-199" name="__codelineno-10-199" href="#__codelineno-10-199"></a>        actual_branch = self.determine_branch(primary_result)
</span><span id="__span-10-200"><a id="__codelineno-10-200" name="__codelineno-10-200" href="#__codelineno-10-200"></a>
</span><span id="__span-10-201"><a id="__codelineno-10-201" name="__codelineno-10-201" href="#__codelineno-10-201"></a>        if actual_branch in speculative_futures:
</span><span id="__span-10-202"><a id="__codelineno-10-202" name="__codelineno-10-202" href="#__codelineno-10-202"></a>            # Hit! Use speculative result
</span><span id="__span-10-203"><a id="__codelineno-10-203" name="__codelineno-10-203" href="#__codelineno-10-203"></a>            return speculative_futures[actual_branch].get()
</span><span id="__span-10-204"><a id="__codelineno-10-204" name="__codelineno-10-204" href="#__codelineno-10-204"></a>        else:
</span><span id="__span-10-205"><a id="__codelineno-10-205" name="__codelineno-10-205" href="#__codelineno-10-205"></a>            # Miss - cancel speculative work and execute actual
</span><span id="__span-10-206"><a id="__codelineno-10-206" name="__codelineno-10-206" href="#__codelineno-10-206"></a>            for future in speculative_futures.values():
</span><span id="__span-10-207"><a id="__codelineno-10-207" name="__codelineno-10-207" href="#__codelineno-10-207"></a>                future.cancel()
</span><span id="__span-10-208"><a id="__codelineno-10-208" name="__codelineno-10-208" href="#__codelineno-10-208"></a>
</span><span id="__span-10-209"><a id="__codelineno-10-209" name="__codelineno-10-209" href="#__codelineno-10-209"></a>            return self.submit_work(actual_branch).get()
</span><span id="__span-10-210"><a id="__codelineno-10-210" name="__codelineno-10-210" href="#__codelineno-10-210"></a>```yaml
</span><span id="__span-10-211"><a id="__codelineno-10-211" name="__codelineno-10-211" href="#__codelineno-10-211"></a>---
</span><span id="__span-10-212"><a id="__codelineno-10-212" name="__codelineno-10-212" href="#__codelineno-10-212"></a>
</span><span id="__span-10-213"><a id="__codelineno-10-213" name="__codelineno-10-213" href="#__codelineno-10-213"></a>##  Mastery: Building Production Work Systems (60+ min read)
</span><span id="__span-10-214"><a id="__codelineno-10-214" name="__codelineno-10-214" href="#__codelineno-10-214"></a>
</span><span id="__span-10-215"><a id="__codelineno-10-215" name="__codelineno-10-215" href="#__codelineno-10-215"></a>### Complete Implementation: Distributed Task Scheduler
</span><span id="__span-10-216"><a id="__codelineno-10-216" name="__codelineno-10-216" href="#__codelineno-10-216"></a>
</span><span id="__span-10-217"><a id="__codelineno-10-217" name="__codelineno-10-217" href="#__codelineno-10-217"></a>Let&#39;s build a production-grade distributed task scheduler:
</span><span id="__span-10-218"><a id="__codelineno-10-218" name="__codelineno-10-218" href="#__codelineno-10-218"></a>
</span><span id="__span-10-219"><a id="__codelineno-10-219" name="__codelineno-10-219" href="#__codelineno-10-219"></a>```python
</span><span id="__span-10-220"><a id="__codelineno-10-220" name="__codelineno-10-220" href="#__codelineno-10-220"></a>import asyncio
</span><span id="__span-10-221"><a id="__codelineno-10-221" name="__codelineno-10-221" href="#__codelineno-10-221"></a>import time
</span><span id="__span-10-222"><a id="__codelineno-10-222" name="__codelineno-10-222" href="#__codelineno-10-222"></a>import uuid
</span><span id="__span-10-223"><a id="__codelineno-10-223" name="__codelineno-10-223" href="#__codelineno-10-223"></a>from dataclasses import dataclass
</span><span id="__span-10-224"><a id="__codelineno-10-224" name="__codelineno-10-224" href="#__codelineno-10-224"></a>from typing import Dict, List, Optional, Callable, Any
</span><span id="__span-10-225"><a id="__codelineno-10-225" name="__codelineno-10-225" href="#__codelineno-10-225"></a>from enum import Enum
</span><span id="__span-10-226"><a id="__codelineno-10-226" name="__codelineno-10-226" href="#__codelineno-10-226"></a>import heapq
</span><span id="__span-10-227"><a id="__codelineno-10-227" name="__codelineno-10-227" href="#__codelineno-10-227"></a>import json
</span><span id="__span-10-228"><a id="__codelineno-10-228" name="__codelineno-10-228" href="#__codelineno-10-228"></a>import aioredis
</span><span id="__span-10-229"><a id="__codelineno-10-229" name="__codelineno-10-229" href="#__codelineno-10-229"></a>from concurrent.futures import ThreadPoolExecutor
</span><span id="__span-10-230"><a id="__codelineno-10-230" name="__codelineno-10-230" href="#__codelineno-10-230"></a>import logging
</span><span id="__span-10-231"><a id="__codelineno-10-231" name="__codelineno-10-231" href="#__codelineno-10-231"></a>
</span><span id="__span-10-232"><a id="__codelineno-10-232" name="__codelineno-10-232" href="#__codelineno-10-232"></a>class TaskState(Enum):
</span><span id="__span-10-233"><a id="__codelineno-10-233" name="__codelineno-10-233" href="#__codelineno-10-233"></a>    PENDING = &quot;pending&quot;
</span><span id="__span-10-234"><a id="__codelineno-10-234" name="__codelineno-10-234" href="#__codelineno-10-234"></a>    RUNNING = &quot;running&quot;
</span><span id="__span-10-235"><a id="__codelineno-10-235" name="__codelineno-10-235" href="#__codelineno-10-235"></a>    COMPLETED = &quot;completed&quot;
</span><span id="__span-10-236"><a id="__codelineno-10-236" name="__codelineno-10-236" href="#__codelineno-10-236"></a>    FAILED = &quot;failed&quot;
</span><span id="__span-10-237"><a id="__codelineno-10-237" name="__codelineno-10-237" href="#__codelineno-10-237"></a>    RETRYING = &quot;retrying&quot;
</span><span id="__span-10-238"><a id="__codelineno-10-238" name="__codelineno-10-238" href="#__codelineno-10-238"></a>
</span><span id="__span-10-239"><a id="__codelineno-10-239" name="__codelineno-10-239" href="#__codelineno-10-239"></a>@dataclass
</span><span id="__span-10-240"><a id="__codelineno-10-240" name="__codelineno-10-240" href="#__codelineno-10-240"></a>class Task:
</span><span id="__span-10-241"><a id="__codelineno-10-241" name="__codelineno-10-241" href="#__codelineno-10-241"></a>    id: str
</span><span id="__span-10-242"><a id="__codelineno-10-242" name="__codelineno-10-242" href="#__codelineno-10-242"></a>    name: str
</span><span id="__span-10-243"><a id="__codelineno-10-243" name="__codelineno-10-243" href="#__codelineno-10-243"></a>    payload: Dict[str, Any]
</span><span id="__span-10-244"><a id="__codelineno-10-244" name="__codelineno-10-244" href="#__codelineno-10-244"></a>    priority: int = 0
</span><span id="__span-10-245"><a id="__codelineno-10-245" name="__codelineno-10-245" href="#__codelineno-10-245"></a>    max_retries: int = 3
</span><span id="__span-10-246"><a id="__codelineno-10-246" name="__codelineno-10-246" href="#__codelineno-10-246"></a>    timeout_seconds: int = 300
</span><span id="__span-10-247"><a id="__codelineno-10-247" name="__codelineno-10-247" href="#__codelineno-10-247"></a>    created_at: float = None
</span><span id="__span-10-248"><a id="__codelineno-10-248" name="__codelineno-10-248" href="#__codelineno-10-248"></a>    started_at: Optional[float] = None
</span><span id="__span-10-249"><a id="__codelineno-10-249" name="__codelineno-10-249" href="#__codelineno-10-249"></a>    completed_at: Optional[float] = None
</span><span id="__span-10-250"><a id="__codelineno-10-250" name="__codelineno-10-250" href="#__codelineno-10-250"></a>    retry_count: int = 0
</span><span id="__span-10-251"><a id="__codelineno-10-251" name="__codelineno-10-251" href="#__codelineno-10-251"></a>    state: TaskState = TaskState.PENDING
</span><span id="__span-10-252"><a id="__codelineno-10-252" name="__codelineno-10-252" href="#__codelineno-10-252"></a>    worker_id: Optional[str] = None
</span><span id="__span-10-253"><a id="__codelineno-10-253" name="__codelineno-10-253" href="#__codelineno-10-253"></a>    result: Optional[Any] = None
</span><span id="__span-10-254"><a id="__codelineno-10-254" name="__codelineno-10-254" href="#__codelineno-10-254"></a>    error: Optional[str] = None
</span><span id="__span-10-255"><a id="__codelineno-10-255" name="__codelineno-10-255" href="#__codelineno-10-255"></a>
</span><span id="__span-10-256"><a id="__codelineno-10-256" name="__codelineno-10-256" href="#__codelineno-10-256"></a>    def __post_init__(self):
</span><span id="__span-10-257"><a id="__codelineno-10-257" name="__codelineno-10-257" href="#__codelineno-10-257"></a>        if self.created_at is None:
</span><span id="__span-10-258"><a id="__codelineno-10-258" name="__codelineno-10-258" href="#__codelineno-10-258"></a>            self.created_at = time.time()
</span><span id="__span-10-259"><a id="__codelineno-10-259" name="__codelineno-10-259" href="#__codelineno-10-259"></a>
</span><span id="__span-10-260"><a id="__codelineno-10-260" name="__codelineno-10-260" href="#__codelineno-10-260"></a>    def __lt__(self, other):
</span><span id="__span-10-261"><a id="__codelineno-10-261" name="__codelineno-10-261" href="#__codelineno-10-261"></a>        # For priority queue (higher priority = lower number)
</span><span id="__span-10-262"><a id="__codelineno-10-262" name="__codelineno-10-262" href="#__codelineno-10-262"></a>        return self.priority &lt; other.priority
</span><span id="__span-10-263"><a id="__codelineno-10-263" name="__codelineno-10-263" href="#__codelineno-10-263"></a>
</span><span id="__span-10-264"><a id="__codelineno-10-264" name="__codelineno-10-264" href="#__codelineno-10-264"></a>class DistributedTaskScheduler:
</span><span id="__span-10-265"><a id="__codelineno-10-265" name="__codelineno-10-265" href="#__codelineno-10-265"></a>    &quot;&quot;&quot;
</span><span id="__span-10-266"><a id="__codelineno-10-266" name="__codelineno-10-266" href="#__codelineno-10-266"></a>    Production-grade distributed task scheduler with:
</span><span id="__span-10-267"><a id="__codelineno-10-267" name="__codelineno-10-267" href="#__codelineno-10-267"></a>    - Priority scheduling
</span><span id="__span-10-268"><a id="__codelineno-10-268" name="__codelineno-10-268" href="#__codelineno-10-268"></a>    - Work stealing
</span><span id="__span-10-269"><a id="__codelineno-10-269" name="__codelineno-10-269" href="#__codelineno-10-269"></a>    - Automatic retries
</span><span id="__span-10-270"><a id="__codelineno-10-270" name="__codelineno-10-270" href="#__codelineno-10-270"></a>    - Deadlock detection
</span><span id="__span-10-271"><a id="__codelineno-10-271" name="__codelineno-10-271" href="#__codelineno-10-271"></a>    - Performance monitoring
</span><span id="__span-10-272"><a id="__codelineno-10-272" name="__codelineno-10-272" href="#__codelineno-10-272"></a>    &quot;&quot;&quot;
</span><span id="__span-10-273"><a id="__codelineno-10-273" name="__codelineno-10-273" href="#__codelineno-10-273"></a>
</span><span id="__span-10-274"><a id="__codelineno-10-274" name="__codelineno-10-274" href="#__codelineno-10-274"></a>    def __init__(self, redis_url: str, worker_pool_size: int = 10):
</span><span id="__span-10-275"><a id="__codelineno-10-275" name="__codelineno-10-275" href="#__codelineno-10-275"></a>        self.redis_url = redis_url
</span><span id="__span-10-276"><a id="__codelineno-10-276" name="__codelineno-10-276" href="#__codelineno-10-276"></a>        self.worker_pool_size = worker_pool_size
</span><span id="__span-10-277"><a id="__codelineno-10-277" name="__codelineno-10-277" href="#__codelineno-10-277"></a>        self.workers: Dict[str, &#39;Worker&#39;] = {}
</span><span id="__span-10-278"><a id="__codelineno-10-278" name="__codelineno-10-278" href="#__codelineno-10-278"></a>        self.task_handlers: Dict[str, Callable] = {}
</span><span id="__span-10-279"><a id="__codelineno-10-279" name="__codelineno-10-279" href="#__codelineno-10-279"></a>        self.monitoring = MonitoringSystem()
</span><span id="__span-10-280"><a id="__codelineno-10-280" name="__codelineno-10-280" href="#__codelineno-10-280"></a>        self.is_running = False
</span><span id="__span-10-281"><a id="__codelineno-10-281" name="__codelineno-10-281" href="#__codelineno-10-281"></a>
</span><span id="__span-10-282"><a id="__codelineno-10-282" name="__codelineno-10-282" href="#__codelineno-10-282"></a>    async def start(self):
</span><span id="__span-10-283"><a id="__codelineno-10-283" name="__codelineno-10-283" href="#__codelineno-10-283"></a>        &quot;&quot;&quot;Start the scheduler and workers&quot;&quot;&quot;
</span><span id="__span-10-284"><a id="__codelineno-10-284" name="__codelineno-10-284" href="#__codelineno-10-284"></a>        self.redis = await aioredis.create_redis_pool(self.redis_url)
</span><span id="__span-10-285"><a id="__codelineno-10-285" name="__codelineno-10-285" href="#__codelineno-10-285"></a>        self.is_running = True
</span><span id="__span-10-286"><a id="__codelineno-10-286" name="__codelineno-10-286" href="#__codelineno-10-286"></a>
</span><span id="__span-10-287"><a id="__codelineno-10-287" name="__codelineno-10-287" href="#__codelineno-10-287"></a>        # Start workers
</span><span id="__span-10-288"><a id="__codelineno-10-288" name="__codelineno-10-288" href="#__codelineno-10-288"></a>        for i in range(self.worker_pool_size):
</span><span id="__span-10-289"><a id="__codelineno-10-289" name="__codelineno-10-289" href="#__codelineno-10-289"></a>            worker = Worker(
</span><span id="__span-10-290"><a id="__codelineno-10-290" name="__codelineno-10-290" href="#__codelineno-10-290"></a>                worker_id=f&quot;worker-{i}&quot;,
</span><span id="__span-10-291"><a id="__codelineno-10-291" name="__codelineno-10-291" href="#__codelineno-10-291"></a>                scheduler=self,
</span><span id="__span-10-292"><a id="__codelineno-10-292" name="__codelineno-10-292" href="#__codelineno-10-292"></a>                steal_threshold=5
</span><span id="__span-10-293"><a id="__codelineno-10-293" name="__codelineno-10-293" href="#__codelineno-10-293"></a>            )
</span><span id="__span-10-294"><a id="__codelineno-10-294" name="__codelineno-10-294" href="#__codelineno-10-294"></a>            self.workers[worker.worker_id] = worker
</span><span id="__span-10-295"><a id="__codelineno-10-295" name="__codelineno-10-295" href="#__codelineno-10-295"></a>            asyncio.create_task(worker.run())
</span><span id="__span-10-296"><a id="__codelineno-10-296" name="__codelineno-10-296" href="#__codelineno-10-296"></a>
</span><span id="__span-10-297"><a id="__codelineno-10-297" name="__codelineno-10-297" href="#__codelineno-10-297"></a>        # Start monitoring
</span><span id="__span-10-298"><a id="__codelineno-10-298" name="__codelineno-10-298" href="#__codelineno-10-298"></a>        asyncio.create_task(self.monitoring.run())
</span><span id="__span-10-299"><a id="__codelineno-10-299" name="__codelineno-10-299" href="#__codelineno-10-299"></a>
</span><span id="__span-10-300"><a id="__codelineno-10-300" name="__codelineno-10-300" href="#__codelineno-10-300"></a>        # Start deadlock detector
</span><span id="__span-10-301"><a id="__codelineno-10-301" name="__codelineno-10-301" href="#__codelineno-10-301"></a>        asyncio.create_task(self._deadlock_detector())
</span><span id="__span-10-302"><a id="__codelineno-10-302" name="__codelineno-10-302" href="#__codelineno-10-302"></a>
</span><span id="__span-10-303"><a id="__codelineno-10-303" name="__codelineno-10-303" href="#__codelineno-10-303"></a>        logging.info(f&quot;Scheduler started with {self.worker_pool_size} workers&quot;)
</span><span id="__span-10-304"><a id="__codelineno-10-304" name="__codelineno-10-304" href="#__codelineno-10-304"></a>
</span><span id="__span-10-305"><a id="__codelineno-10-305" name="__codelineno-10-305" href="#__codelineno-10-305"></a>    def register_handler(self, task_name: str, handler: Callable):
</span><span id="__span-10-306"><a id="__codelineno-10-306" name="__codelineno-10-306" href="#__codelineno-10-306"></a>        &quot;&quot;&quot;Register a task handler function&quot;&quot;&quot;
</span><span id="__span-10-307"><a id="__codelineno-10-307" name="__codelineno-10-307" href="#__codelineno-10-307"></a>        self.task_handlers[task_name] = handler
</span><span id="__span-10-308"><a id="__codelineno-10-308" name="__codelineno-10-308" href="#__codelineno-10-308"></a>
</span><span id="__span-10-309"><a id="__codelineno-10-309" name="__codelineno-10-309" href="#__codelineno-10-309"></a>    async def submit_task(self, task: Task) -&gt; str:
</span><span id="__span-10-310"><a id="__codelineno-10-310" name="__codelineno-10-310" href="#__codelineno-10-310"></a>        &quot;&quot;&quot;Submit a task for execution&quot;&quot;&quot;
</span><span id="__span-10-311"><a id="__codelineno-10-311" name="__codelineno-10-311" href="#__codelineno-10-311"></a>        # Store task in Redis
</span><span id="__span-10-312"><a id="__codelineno-10-312" name="__codelineno-10-312" href="#__codelineno-10-312"></a>        task_data = self._serialize_task(task)
</span><span id="__span-10-313"><a id="__codelineno-10-313" name="__codelineno-10-313" href="#__codelineno-10-313"></a>        await self.redis.hset(f&quot;task:{task.id}&quot;, mapping=task_data)
</span><span id="__span-10-314"><a id="__codelineno-10-314" name="__codelineno-10-314" href="#__codelineno-10-314"></a>
</span><span id="__span-10-315"><a id="__codelineno-10-315" name="__codelineno-10-315" href="#__codelineno-10-315"></a>        # Add to appropriate queue based on priority
</span><span id="__span-10-316"><a id="__codelineno-10-316" name="__codelineno-10-316" href="#__codelineno-10-316"></a>        queue_name = self._get_queue_name(task.priority)
</span><span id="__span-10-317"><a id="__codelineno-10-317" name="__codelineno-10-317" href="#__codelineno-10-317"></a>        await self.redis.zadd(queue_name, task.created_at, task.id)
</span><span id="__span-10-318"><a id="__codelineno-10-318" name="__codelineno-10-318" href="#__codelineno-10-318"></a>
</span><span id="__span-10-319"><a id="__codelineno-10-319" name="__codelineno-10-319" href="#__codelineno-10-319"></a>        # Notify monitoring
</span><span id="__span-10-320"><a id="__codelineno-10-320" name="__codelineno-10-320" href="#__codelineno-10-320"></a>        self.monitoring.record_task_submitted(task)
</span><span id="__span-10-321"><a id="__codelineno-10-321" name="__codelineno-10-321" href="#__codelineno-10-321"></a>
</span><span id="__span-10-322"><a id="__codelineno-10-322" name="__codelineno-10-322" href="#__codelineno-10-322"></a>        logging.info(f&quot;Task {task.id} submitted with priority {task.priority}&quot;)
</span><span id="__span-10-323"><a id="__codelineno-10-323" name="__codelineno-10-323" href="#__codelineno-10-323"></a>        return task.id
</span><span id="__span-10-324"><a id="__codelineno-10-324" name="__codelineno-10-324" href="#__codelineno-10-324"></a>
</span><span id="__span-10-325"><a id="__codelineno-10-325" name="__codelineno-10-325" href="#__codelineno-10-325"></a>    async def get_task_status(self, task_id: str) -&gt; Optional[Task]:
</span><span id="__span-10-326"><a id="__codelineno-10-326" name="__codelineno-10-326" href="#__codelineno-10-326"></a>        &quot;&quot;&quot;Get current status of a task&quot;&quot;&quot;
</span><span id="__span-10-327"><a id="__codelineno-10-327" name="__codelineno-10-327" href="#__codelineno-10-327"></a>        task_data = await self.redis.hgetall(f&quot;task:{task_id}&quot;)
</span><span id="__span-10-328"><a id="__codelineno-10-328" name="__codelineno-10-328" href="#__codelineno-10-328"></a>        if not task_data:
</span><span id="__span-10-329"><a id="__codelineno-10-329" name="__codelineno-10-329" href="#__codelineno-10-329"></a>            return None
</span><span id="__span-10-330"><a id="__codelineno-10-330" name="__codelineno-10-330" href="#__codelineno-10-330"></a>        return self._deserialize_task(task_data)
</span><span id="__span-10-331"><a id="__codelineno-10-331" name="__codelineno-10-331" href="#__codelineno-10-331"></a>
</span><span id="__span-10-332"><a id="__codelineno-10-332" name="__codelineno-10-332" href="#__codelineno-10-332"></a>    def _get_queue_name(self, priority: int) -&gt; str:
</span><span id="__span-10-333"><a id="__codelineno-10-333" name="__codelineno-10-333" href="#__codelineno-10-333"></a>        &quot;&quot;&quot;Get queue name based on priority&quot;&quot;&quot;
</span><span id="__span-10-334"><a id="__codelineno-10-334" name="__codelineno-10-334" href="#__codelineno-10-334"></a>        if priority &lt; 0:
</span><span id="__span-10-335"><a id="__codelineno-10-335" name="__codelineno-10-335" href="#__codelineno-10-335"></a>            return &quot;queue:high&quot;
</span><span id="__span-10-336"><a id="__codelineno-10-336" name="__codelineno-10-336" href="#__codelineno-10-336"></a>        elif priority == 0:
</span><span id="__span-10-337"><a id="__codelineno-10-337" name="__codelineno-10-337" href="#__codelineno-10-337"></a>            return &quot;queue:normal&quot;
</span><span id="__span-10-338"><a id="__codelineno-10-338" name="__codelineno-10-338" href="#__codelineno-10-338"></a>        else:
</span><span id="__span-10-339"><a id="__codelineno-10-339" name="__codelineno-10-339" href="#__codelineno-10-339"></a>            return &quot;queue:low&quot;
</span><span id="__span-10-340"><a id="__codelineno-10-340" name="__codelineno-10-340" href="#__codelineno-10-340"></a>
</span><span id="__span-10-341"><a id="__codelineno-10-341" name="__codelineno-10-341" href="#__codelineno-10-341"></a>    def _serialize_task(self, task: Task) -&gt; Dict[str, str]:
</span><span id="__span-10-342"><a id="__codelineno-10-342" name="__codelineno-10-342" href="#__codelineno-10-342"></a>        &quot;&quot;&quot;Serialize task for Redis storage&quot;&quot;&quot;
</span><span id="__span-10-343"><a id="__codelineno-10-343" name="__codelineno-10-343" href="#__codelineno-10-343"></a>        return {
</span><span id="__span-10-344"><a id="__codelineno-10-344" name="__codelineno-10-344" href="#__codelineno-10-344"></a>            &#39;id&#39;: task.id,
</span><span id="__span-10-345"><a id="__codelineno-10-345" name="__codelineno-10-345" href="#__codelineno-10-345"></a>            &#39;name&#39;: task.name,
</span><span id="__span-10-346"><a id="__codelineno-10-346" name="__codelineno-10-346" href="#__codelineno-10-346"></a>            &#39;payload&#39;: json.dumps(task.payload),
</span><span id="__span-10-347"><a id="__codelineno-10-347" name="__codelineno-10-347" href="#__codelineno-10-347"></a>            &#39;priority&#39;: str(task.priority),
</span><span id="__span-10-348"><a id="__codelineno-10-348" name="__codelineno-10-348" href="#__codelineno-10-348"></a>            &#39;max_retries&#39;: str(task.max_retries),
</span><span id="__span-10-349"><a id="__codelineno-10-349" name="__codelineno-10-349" href="#__codelineno-10-349"></a>            &#39;timeout_seconds&#39;: str(task.timeout_seconds),
</span><span id="__span-10-350"><a id="__codelineno-10-350" name="__codelineno-10-350" href="#__codelineno-10-350"></a>            &#39;created_at&#39;: str(task.created_at),
</span><span id="__span-10-351"><a id="__codelineno-10-351" name="__codelineno-10-351" href="#__codelineno-10-351"></a>            &#39;started_at&#39;: str(task.started_at or &#39;&#39;),
</span><span id="__span-10-352"><a id="__codelineno-10-352" name="__codelineno-10-352" href="#__codelineno-10-352"></a>            &#39;completed_at&#39;: str(task.completed_at or &#39;&#39;),
</span><span id="__span-10-353"><a id="__codelineno-10-353" name="__codelineno-10-353" href="#__codelineno-10-353"></a>            &#39;retry_count&#39;: str(task.retry_count),
</span><span id="__span-10-354"><a id="__codelineno-10-354" name="__codelineno-10-354" href="#__codelineno-10-354"></a>            &#39;state&#39;: task.state.value,
</span><span id="__span-10-355"><a id="__codelineno-10-355" name="__codelineno-10-355" href="#__codelineno-10-355"></a>            &#39;worker_id&#39;: task.worker_id or &#39;&#39;,
</span><span id="__span-10-356"><a id="__codelineno-10-356" name="__codelineno-10-356" href="#__codelineno-10-356"></a>            &#39;result&#39;: json.dumps(task.result) if task.result else &#39;&#39;,
</span><span id="__span-10-357"><a id="__codelineno-10-357" name="__codelineno-10-357" href="#__codelineno-10-357"></a>            &#39;error&#39;: task.error or &#39;&#39;
</span><span id="__span-10-358"><a id="__codelineno-10-358" name="__codelineno-10-358" href="#__codelineno-10-358"></a>        }
</span><span id="__span-10-359"><a id="__codelineno-10-359" name="__codelineno-10-359" href="#__codelineno-10-359"></a>
</span><span id="__span-10-360"><a id="__codelineno-10-360" name="__codelineno-10-360" href="#__codelineno-10-360"></a>    def _deserialize_task(self, data: Dict[bytes, bytes]) -&gt; Task:
</span><span id="__span-10-361"><a id="__codelineno-10-361" name="__codelineno-10-361" href="#__codelineno-10-361"></a>        &quot;&quot;&quot;Deserialize task from Redis&quot;&quot;&quot;
</span><span id="__span-10-362"><a id="__codelineno-10-362" name="__codelineno-10-362" href="#__codelineno-10-362"></a>        return Task(
</span><span id="__span-10-363"><a id="__codelineno-10-363" name="__codelineno-10-363" href="#__codelineno-10-363"></a>            id=data[b&#39;id&#39;].decode(),
</span><span id="__span-10-364"><a id="__codelineno-10-364" name="__codelineno-10-364" href="#__codelineno-10-364"></a>            name=data[b&#39;name&#39;].decode(),
</span><span id="__span-10-365"><a id="__codelineno-10-365" name="__codelineno-10-365" href="#__codelineno-10-365"></a>            payload=json.loads(data[b&#39;payload&#39;].decode()),
</span><span id="__span-10-366"><a id="__codelineno-10-366" name="__codelineno-10-366" href="#__codelineno-10-366"></a>            priority=int(data[b&#39;priority&#39;].decode()),
</span><span id="__span-10-367"><a id="__codelineno-10-367" name="__codelineno-10-367" href="#__codelineno-10-367"></a>            max_retries=int(data[b&#39;max_retries&#39;].decode()),
</span><span id="__span-10-368"><a id="__codelineno-10-368" name="__codelineno-10-368" href="#__codelineno-10-368"></a>            timeout_seconds=int(data[b&#39;timeout_seconds&#39;].decode()),
</span><span id="__span-10-369"><a id="__codelineno-10-369" name="__codelineno-10-369" href="#__codelineno-10-369"></a>            created_at=float(data[b&#39;created_at&#39;].decode()),
</span><span id="__span-10-370"><a id="__codelineno-10-370" name="__codelineno-10-370" href="#__codelineno-10-370"></a>            started_at=float(data[b&#39;started_at&#39;].decode()) if data[b&#39;started_at&#39;] else None,
</span><span id="__span-10-371"><a id="__codelineno-10-371" name="__codelineno-10-371" href="#__codelineno-10-371"></a>            completed_at=float(data[b&#39;completed_at&#39;].decode()) if data[b&#39;completed_at&#39;] else None,
</span><span id="__span-10-372"><a id="__codelineno-10-372" name="__codelineno-10-372" href="#__codelineno-10-372"></a>            retry_count=int(data[b&#39;retry_count&#39;].decode()),
</span><span id="__span-10-373"><a id="__codelineno-10-373" name="__codelineno-10-373" href="#__codelineno-10-373"></a>            state=TaskState(data[b&#39;state&#39;].decode()),
</span><span id="__span-10-374"><a id="__codelineno-10-374" name="__codelineno-10-374" href="#__codelineno-10-374"></a>            worker_id=data[b&#39;worker_id&#39;].decode() or None,
</span><span id="__span-10-375"><a id="__codelineno-10-375" name="__codelineno-10-375" href="#__codelineno-10-375"></a>            result=json.loads(data[b&#39;result&#39;].decode()) if data[b&#39;result&#39;] else None,
</span><span id="__span-10-376"><a id="__codelineno-10-376" name="__codelineno-10-376" href="#__codelineno-10-376"></a>            error=data[b&#39;error&#39;].decode() or None
</span><span id="__span-10-377"><a id="__codelineno-10-377" name="__codelineno-10-377" href="#__codelineno-10-377"></a>        )
</span><span id="__span-10-378"><a id="__codelineno-10-378" name="__codelineno-10-378" href="#__codelineno-10-378"></a>
</span><span id="__span-10-379"><a id="__codelineno-10-379" name="__codelineno-10-379" href="#__codelineno-10-379"></a>    async def _deadlock_detector(self):
</span><span id="__span-10-380"><a id="__codelineno-10-380" name="__codelineno-10-380" href="#__codelineno-10-380"></a>        &quot;&quot;&quot;Detect and recover from deadlocks&quot;&quot;&quot;
</span><span id="__span-10-381"><a id="__codelineno-10-381" name="__codelineno-10-381" href="#__codelineno-10-381"></a>        while self.is_running:
</span><span id="__span-10-382"><a id="__codelineno-10-382" name="__codelineno-10-382" href="#__codelineno-10-382"></a>            await asyncio.sleep(30)  # Check every 30 seconds
</span><span id="__span-10-383"><a id="__codelineno-10-383" name="__codelineno-10-383" href="#__codelineno-10-383"></a>
</span><span id="__span-10-384"><a id="__codelineno-10-384" name="__codelineno-10-384" href="#__codelineno-10-384"></a>            # Find tasks that have been running too long
</span><span id="__span-10-385"><a id="__codelineno-10-385" name="__codelineno-10-385" href="#__codelineno-10-385"></a>            current_time = time.time()
</span><span id="__span-10-386"><a id="__codelineno-10-386" name="__codelineno-10-386" href="#__codelineno-10-386"></a>
</span><span id="__span-10-387"><a id="__codelineno-10-387" name="__codelineno-10-387" href="#__codelineno-10-387"></a>            # Get all running tasks
</span><span id="__span-10-388"><a id="__codelineno-10-388" name="__codelineno-10-388" href="#__codelineno-10-388"></a>            pattern = &quot;task:*&quot;
</span><span id="__span-10-389"><a id="__codelineno-10-389" name="__codelineno-10-389" href="#__codelineno-10-389"></a>            cursor = b&#39;0&#39;
</span><span id="__span-10-390"><a id="__codelineno-10-390" name="__codelineno-10-390" href="#__codelineno-10-390"></a>
</span><span id="__span-10-391"><a id="__codelineno-10-391" name="__codelineno-10-391" href="#__codelineno-10-391"></a>            while cursor:
</span><span id="__span-10-392"><a id="__codelineno-10-392" name="__codelineno-10-392" href="#__codelineno-10-392"></a>                cursor, keys = await self.redis.scan(cursor, match=pattern)
</span><span id="__span-10-393"><a id="__codelineno-10-393" name="__codelineno-10-393" href="#__codelineno-10-393"></a>
</span><span id="__span-10-394"><a id="__codelineno-10-394" name="__codelineno-10-394" href="#__codelineno-10-394"></a>                for key in keys:
</span><span id="__span-10-395"><a id="__codelineno-10-395" name="__codelineno-10-395" href="#__codelineno-10-395"></a>                    task_data = await self.redis.hgetall(key)
</span><span id="__span-10-396"><a id="__codelineno-10-396" name="__codelineno-10-396" href="#__codelineno-10-396"></a>                    if not task_data:
</span><span id="__span-10-397"><a id="__codelineno-10-397" name="__codelineno-10-397" href="#__codelineno-10-397"></a>                        continue
</span><span id="__span-10-398"><a id="__codelineno-10-398" name="__codelineno-10-398" href="#__codelineno-10-398"></a>
</span><span id="__span-10-399"><a id="__codelineno-10-399" name="__codelineno-10-399" href="#__codelineno-10-399"></a>                    task = self._deserialize_task(task_data)
</span><span id="__span-10-400"><a id="__codelineno-10-400" name="__codelineno-10-400" href="#__codelineno-10-400"></a>
</span><span id="__span-10-401"><a id="__codelineno-10-401" name="__codelineno-10-401" href="#__codelineno-10-401"></a>                    if task.state == TaskState.RUNNING and task.started_at:
</span><span id="__span-10-402"><a id="__codelineno-10-402" name="__codelineno-10-402" href="#__codelineno-10-402"></a>                        runtime = current_time - task.started_at
</span><span id="__span-10-403"><a id="__codelineno-10-403" name="__codelineno-10-403" href="#__codelineno-10-403"></a>
</span><span id="__span-10-404"><a id="__codelineno-10-404" name="__codelineno-10-404" href="#__codelineno-10-404"></a>                        if runtime &gt; task.timeout_seconds:
</span><span id="__span-10-405"><a id="__codelineno-10-405" name="__codelineno-10-405" href="#__codelineno-10-405"></a>                            logging.warning(f&quot;Task {task.id} timeout after {runtime}s&quot;)
</span><span id="__span-10-406"><a id="__codelineno-10-406" name="__codelineno-10-406" href="#__codelineno-10-406"></a>
</span><span id="__span-10-407"><a id="__codelineno-10-407" name="__codelineno-10-407" href="#__codelineno-10-407"></a>                            # Mark as failed and requeue if retries remain
</span><span id="__span-10-408"><a id="__codelineno-10-408" name="__codelineno-10-408" href="#__codelineno-10-408"></a>                            task.state = TaskState.FAILED
</span><span id="__span-10-409"><a id="__codelineno-10-409" name="__codelineno-10-409" href="#__codelineno-10-409"></a>                            task.error = f&quot;Timeout after {runtime}s&quot;
</span><span id="__span-10-410"><a id="__codelineno-10-410" name="__codelineno-10-410" href="#__codelineno-10-410"></a>
</span><span id="__span-10-411"><a id="__codelineno-10-411" name="__codelineno-10-411" href="#__codelineno-10-411"></a>                            if task.retry_count &lt; task.max_retries:
</span><span id="__span-10-412"><a id="__codelineno-10-412" name="__codelineno-10-412" href="#__codelineno-10-412"></a>                                task.state = TaskState.RETRYING
</span><span id="__span-10-413"><a id="__codelineno-10-413" name="__codelineno-10-413" href="#__codelineno-10-413"></a>                                task.retry_count += 1
</span><span id="__span-10-414"><a id="__codelineno-10-414" name="__codelineno-10-414" href="#__codelineno-10-414"></a>                                await self.submit_task(task)
</span><span id="__span-10-415"><a id="__codelineno-10-415" name="__codelineno-10-415" href="#__codelineno-10-415"></a>
</span><span id="__span-10-416"><a id="__codelineno-10-416" name="__codelineno-10-416" href="#__codelineno-10-416"></a>                            # Update task state
</span><span id="__span-10-417"><a id="__codelineno-10-417" name="__codelineno-10-417" href="#__codelineno-10-417"></a>                            await self.redis.hset(
</span><span id="__span-10-418"><a id="__codelineno-10-418" name="__codelineno-10-418" href="#__codelineno-10-418"></a>                                f&quot;task:{task.id}&quot;,
</span><span id="__span-10-419"><a id="__codelineno-10-419" name="__codelineno-10-419" href="#__codelineno-10-419"></a>                                mapping=self._serialize_task(task)
</span><span id="__span-10-420"><a id="__codelineno-10-420" name="__codelineno-10-420" href="#__codelineno-10-420"></a>                            )
</span><span id="__span-10-421"><a id="__codelineno-10-421" name="__codelineno-10-421" href="#__codelineno-10-421"></a>
</span><span id="__span-10-422"><a id="__codelineno-10-422" name="__codelineno-10-422" href="#__codelineno-10-422"></a>class Worker:
</span><span id="__span-10-423"><a id="__codelineno-10-423" name="__codelineno-10-423" href="#__codelineno-10-423"></a>    &quot;&quot;&quot;Individual worker that processes tasks&quot;&quot;&quot;
</span><span id="__span-10-424"><a id="__codelineno-10-424" name="__codelineno-10-424" href="#__codelineno-10-424"></a>
</span><span id="__span-10-425"><a id="__codelineno-10-425" name="__codelineno-10-425" href="#__codelineno-10-425"></a>    def __init__(self, worker_id: str, scheduler: DistributedTaskScheduler,
</span><span id="__span-10-426"><a id="__codelineno-10-426" name="__codelineno-10-426" href="#__codelineno-10-426"></a>                 steal_threshold: int = 5):
</span><span id="__span-10-427"><a id="__codelineno-10-427" name="__codelineno-10-427" href="#__codelineno-10-427"></a>        self.worker_id = worker_id
</span><span id="__span-10-428"><a id="__codelineno-10-428" name="__codelineno-10-428" href="#__codelineno-10-428"></a>        self.scheduler = scheduler
</span><span id="__span-10-429"><a id="__codelineno-10-429" name="__codelineno-10-429" href="#__codelineno-10-429"></a>        self.steal_threshold = steal_threshold
</span><span id="__span-10-430"><a id="__codelineno-10-430" name="__codelineno-10-430" href="#__codelineno-10-430"></a>        self.local_queue: List[Task] = []
</span><span id="__span-10-431"><a id="__codelineno-10-431" name="__codelineno-10-431" href="#__codelineno-10-431"></a>        self.executor = ThreadPoolExecutor(max_workers=1)
</span><span id="__span-10-432"><a id="__codelineno-10-432" name="__codelineno-10-432" href="#__codelineno-10-432"></a>        self.current_task: Optional[Task] = None
</span><span id="__span-10-433"><a id="__codelineno-10-433" name="__codelineno-10-433" href="#__codelineno-10-433"></a>        self.processed_count = 0
</span><span id="__span-10-434"><a id="__codelineno-10-434" name="__codelineno-10-434" href="#__codelineno-10-434"></a>
</span><span id="__span-10-435"><a id="__codelineno-10-435" name="__codelineno-10-435" href="#__codelineno-10-435"></a>    async def run(self):
</span><span id="__span-10-436"><a id="__codelineno-10-436" name="__codelineno-10-436" href="#__codelineno-10-436"></a>        &quot;&quot;&quot;Main worker loop&quot;&quot;&quot;
</span><span id="__span-10-437"><a id="__codelineno-10-437" name="__codelineno-10-437" href="#__codelineno-10-437"></a>        while self.scheduler.is_running:
</span><span id="__span-10-438"><a id="__codelineno-10-438" name="__codelineno-10-438" href="#__codelineno-10-438"></a>            try:
</span><span id="__span-10-439"><a id="__codelineno-10-439" name="__codelineno-10-439" href="#__codelineno-10-439"></a>                # Get next task
</span><span id="__span-10-440"><a id="__codelineno-10-440" name="__codelineno-10-440" href="#__codelineno-10-440"></a>                task = await self._get_next_task()
</span><span id="__span-10-441"><a id="__codelineno-10-441" name="__codelineno-10-441" href="#__codelineno-10-441"></a>
</span><span id="__span-10-442"><a id="__codelineno-10-442" name="__codelineno-10-442" href="#__codelineno-10-442"></a>                if task:
</span><span id="__span-10-443"><a id="__codelineno-10-443" name="__codelineno-10-443" href="#__codelineno-10-443"></a>                    await self._execute_task(task)
</span><span id="__span-10-444"><a id="__codelineno-10-444" name="__codelineno-10-444" href="#__codelineno-10-444"></a>                else:
</span><span id="__span-10-445"><a id="__codelineno-10-445" name="__codelineno-10-445" href="#__codelineno-10-445"></a>                    # No task available, sleep briefly
</span><span id="__span-10-446"><a id="__codelineno-10-446" name="__codelineno-10-446" href="#__codelineno-10-446"></a>                    await asyncio.sleep(0.1)
</span><span id="__span-10-447"><a id="__codelineno-10-447" name="__codelineno-10-447" href="#__codelineno-10-447"></a>
</span><span id="__span-10-448"><a id="__codelineno-10-448" name="__codelineno-10-448" href="#__codelineno-10-448"></a>            except Exception as e:
</span><span id="__span-10-449"><a id="__codelineno-10-449" name="__codelineno-10-449" href="#__codelineno-10-449"></a>                logging.error(f&quot;Worker {self.worker_id} error: {e}&quot;)
</span><span id="__span-10-450"><a id="__codelineno-10-450" name="__codelineno-10-450" href="#__codelineno-10-450"></a>                await asyncio.sleep(1)
</span><span id="__span-10-451"><a id="__codelineno-10-451" name="__codelineno-10-451" href="#__codelineno-10-451"></a>
</span><span id="__span-10-452"><a id="__codelineno-10-452" name="__codelineno-10-452" href="#__codelineno-10-452"></a>    async def _get_next_task(self) -&gt; Optional[Task]:
</span><span id="__span-10-453"><a id="__codelineno-10-453" name="__codelineno-10-453" href="#__codelineno-10-453"></a>        &quot;&quot;&quot;Get next task to process&quot;&quot;&quot;
</span><span id="__span-10-454"><a id="__codelineno-10-454" name="__codelineno-10-454" href="#__codelineno-10-454"></a>        # Try local queue first
</span><span id="__span-10-455"><a id="__codelineno-10-455" name="__codelineno-10-455" href="#__codelineno-10-455"></a>        if self.local_queue:
</span><span id="__span-10-456"><a id="__codelineno-10-456" name="__codelineno-10-456" href="#__codelineno-10-456"></a>            return self.local_queue.pop(0)
</span><span id="__span-10-457"><a id="__codelineno-10-457" name="__codelineno-10-457" href="#__codelineno-10-457"></a>
</span><span id="__span-10-458"><a id="__codelineno-10-458" name="__codelineno-10-458" href="#__codelineno-10-458"></a>        # Try to get from Redis queues
</span><span id="__span-10-459"><a id="__codelineno-10-459" name="__codelineno-10-459" href="#__codelineno-10-459"></a>        for queue_name in [&quot;queue:high&quot;, &quot;queue:normal&quot;, &quot;queue:low&quot;]:
</span><span id="__span-10-460"><a id="__codelineno-10-460" name="__codelineno-10-460" href="#__codelineno-10-460"></a>            # Get multiple tasks at once for efficiency
</span><span id="__span-10-461"><a id="__codelineno-10-461" name="__codelineno-10-461" href="#__codelineno-10-461"></a>            task_ids = await self.scheduler.redis.zrange(
</span><span id="__span-10-462"><a id="__codelineno-10-462" name="__codelineno-10-462" href="#__codelineno-10-462"></a>                queue_name, 0, self.steal_threshold - 1
</span><span id="__span-10-463"><a id="__codelineno-10-463" name="__codelineno-10-463" href="#__codelineno-10-463"></a>            )
</span><span id="__span-10-464"><a id="__codelineno-10-464" name="__codelineno-10-464" href="#__codelineno-10-464"></a>
</span><span id="__span-10-465"><a id="__codelineno-10-465" name="__codelineno-10-465" href="#__codelineno-10-465"></a>            if task_ids:
</span><span id="__span-10-466"><a id="__codelineno-10-466" name="__codelineno-10-466" href="#__codelineno-10-466"></a>                # Remove from queue
</span><span id="__span-10-467"><a id="__codelineno-10-467" name="__codelineno-10-467" href="#__codelineno-10-467"></a>                await self.scheduler.redis.zrem(queue_name, *task_ids)
</span><span id="__span-10-468"><a id="__codelineno-10-468" name="__codelineno-10-468" href="#__codelineno-10-468"></a>
</span><span id="__span-10-469"><a id="__codelineno-10-469" name="__codelineno-10-469" href="#__codelineno-10-469"></a>                # Load tasks
</span><span id="__span-10-470"><a id="__codelineno-10-470" name="__codelineno-10-470" href="#__codelineno-10-470"></a>                tasks = []
</span><span id="__span-10-471"><a id="__codelineno-10-471" name="__codelineno-10-471" href="#__codelineno-10-471"></a>                for task_id in task_ids:
</span><span id="__span-10-472"><a id="__codelineno-10-472" name="__codelineno-10-472" href="#__codelineno-10-472"></a>                    task_data = await self.scheduler.redis.hgetall(
</span><span id="__span-10-473"><a id="__codelineno-10-473" name="__codelineno-10-473" href="#__codelineno-10-473"></a>                        f&quot;task:{task_id.decode()}&quot;
</span><span id="__span-10-474"><a id="__codelineno-10-474" name="__codelineno-10-474" href="#__codelineno-10-474"></a>                    )
</span><span id="__span-10-475"><a id="__codelineno-10-475" name="__codelineno-10-475" href="#__codelineno-10-475"></a>                    if task_data:
</span><span id="__span-10-476"><a id="__codelineno-10-476" name="__codelineno-10-476" href="#__codelineno-10-476"></a>                        task = self.scheduler._deserialize_task(task_data)
</span><span id="__span-10-477"><a id="__codelineno-10-477" name="__codelineno-10-477" href="#__codelineno-10-477"></a>                        tasks.append(task)
</span><span id="__span-10-478"><a id="__codelineno-10-478" name="__codelineno-10-478" href="#__codelineno-10-478"></a>
</span><span id="__span-10-479"><a id="__codelineno-10-479" name="__codelineno-10-479" href="#__codelineno-10-479"></a>                if tasks:
</span><span id="__span-10-480"><a id="__codelineno-10-480" name="__codelineno-10-480" href="#__codelineno-10-480"></a>                    # Keep first task, add rest to local queue
</span><span id="__span-10-481"><a id="__codelineno-10-481" name="__codelineno-10-481" href="#__codelineno-10-481"></a>                    self.local_queue.extend(tasks[1:])
</span><span id="__span-10-482"><a id="__codelineno-10-482" name="__codelineno-10-482" href="#__codelineno-10-482"></a>                    return tasks[0]
</span><span id="__span-10-483"><a id="__codelineno-10-483" name="__codelineno-10-483" href="#__codelineno-10-483"></a>
</span><span id="__span-10-484"><a id="__codelineno-10-484" name="__codelineno-10-484" href="#__codelineno-10-484"></a>        # No tasks in queues, try work stealing
</span><span id="__span-10-485"><a id="__codelineno-10-485" name="__codelineno-10-485" href="#__codelineno-10-485"></a>        return await self._steal_work()
</span><span id="__span-10-486"><a id="__codelineno-10-486" name="__codelineno-10-486" href="#__codelineno-10-486"></a>
</span><span id="__span-10-487"><a id="__codelineno-10-487" name="__codelineno-10-487" href="#__codelineno-10-487"></a>    async def _steal_work(self) -&gt; Optional[Task]:
</span><span id="__span-10-488"><a id="__codelineno-10-488" name="__codelineno-10-488" href="#__codelineno-10-488"></a>        &quot;&quot;&quot;Try to steal work from other workers&quot;&quot;&quot;
</span><span id="__span-10-489"><a id="__codelineno-10-489" name="__codelineno-10-489" href="#__codelineno-10-489"></a>        for worker_id, worker in self.scheduler.workers.items():
</span><span id="__span-10-490"><a id="__codelineno-10-490" name="__codelineno-10-490" href="#__codelineno-10-490"></a>            if worker_id == self.worker_id:
</span><span id="__span-10-491"><a id="__codelineno-10-491" name="__codelineno-10-491" href="#__codelineno-10-491"></a>                continue
</span><span id="__span-10-492"><a id="__codelineno-10-492" name="__codelineno-10-492" href="#__codelineno-10-492"></a>
</span><span id="__span-10-493"><a id="__codelineno-10-493" name="__codelineno-10-493" href="#__codelineno-10-493"></a>            if len(worker.local_queue) &gt; self.steal_threshold:
</span><span id="__span-10-494"><a id="__codelineno-10-494" name="__codelineno-10-494" href="#__codelineno-10-494"></a>                # Steal half of their excess tasks
</span><span id="__span-10-495"><a id="__codelineno-10-495" name="__codelineno-10-495" href="#__codelineno-10-495"></a>                steal_count = (len(worker.local_queue) - self.steal_threshold) // 2
</span><span id="__span-10-496"><a id="__codelineno-10-496" name="__codelineno-10-496" href="#__codelineno-10-496"></a>                if steal_count &gt; 0:
</span><span id="__span-10-497"><a id="__codelineno-10-497" name="__codelineno-10-497" href="#__codelineno-10-497"></a>                    stolen = worker.local_queue[:steal_count]
</span><span id="__span-10-498"><a id="__codelineno-10-498" name="__codelineno-10-498" href="#__codelineno-10-498"></a>                    worker.local_queue = worker.local_queue[steal_count:]
</span><span id="__span-10-499"><a id="__codelineno-10-499" name="__codelineno-10-499" href="#__codelineno-10-499"></a>
</span><span id="__span-10-500"><a id="__codelineno-10-500" name="__codelineno-10-500" href="#__codelineno-10-500"></a>                    # Add to our queue and return first
</span><span id="__span-10-501"><a id="__codelineno-10-501" name="__codelineno-10-501" href="#__codelineno-10-501"></a>                    self.local_queue.extend(stolen[1:])
</span><span id="__span-10-502"><a id="__codelineno-10-502" name="__codelineno-10-502" href="#__codelineno-10-502"></a>
</span><span id="__span-10-503"><a id="__codelineno-10-503" name="__codelineno-10-503" href="#__codelineno-10-503"></a>                    logging.info(
</span><span id="__span-10-504"><a id="__codelineno-10-504" name="__codelineno-10-504" href="#__codelineno-10-504"></a>                        f&quot;Worker {self.worker_id} stole {steal_count} tasks &quot;
</span><span id="__span-10-505"><a id="__codelineno-10-505" name="__codelineno-10-505" href="#__codelineno-10-505"></a>                        f&quot;from {worker_id}&quot;
</span><span id="__span-10-506"><a id="__codelineno-10-506" name="__codelineno-10-506" href="#__codelineno-10-506"></a>                    )
</span><span id="__span-10-507"><a id="__codelineno-10-507" name="__codelineno-10-507" href="#__codelineno-10-507"></a>
</span><span id="__span-10-508"><a id="__codelineno-10-508" name="__codelineno-10-508" href="#__codelineno-10-508"></a>                    return stolen[0]
</span><span id="__span-10-509"><a id="__codelineno-10-509" name="__codelineno-10-509" href="#__codelineno-10-509"></a>
</span><span id="__span-10-510"><a id="__codelineno-10-510" name="__codelineno-10-510" href="#__codelineno-10-510"></a>        return None
</span><span id="__span-10-511"><a id="__codelineno-10-511" name="__codelineno-10-511" href="#__codelineno-10-511"></a>
</span><span id="__span-10-512"><a id="__codelineno-10-512" name="__codelineno-10-512" href="#__codelineno-10-512"></a>    async def _execute_task(self, task: Task):
</span><span id="__span-10-513"><a id="__codelineno-10-513" name="__codelineno-10-513" href="#__codelineno-10-513"></a>        &quot;&quot;&quot;Execute a single task&quot;&quot;&quot;
</span><span id="__span-10-514"><a id="__codelineno-10-514" name="__codelineno-10-514" href="#__codelineno-10-514"></a>        self.current_task = task
</span><span id="__span-10-515"><a id="__codelineno-10-515" name="__codelineno-10-515" href="#__codelineno-10-515"></a>        task.state = TaskState.RUNNING
</span><span id="__span-10-516"><a id="__codelineno-10-516" name="__codelineno-10-516" href="#__codelineno-10-516"></a>        task.started_at = time.time()
</span><span id="__span-10-517"><a id="__codelineno-10-517" name="__codelineno-10-517" href="#__codelineno-10-517"></a>        task.worker_id = self.worker_id
</span><span id="__span-10-518"><a id="__codelineno-10-518" name="__codelineno-10-518" href="#__codelineno-10-518"></a>
</span><span id="__span-10-519"><a id="__codelineno-10-519" name="__codelineno-10-519" href="#__codelineno-10-519"></a>        # Update task state in Redis
</span><span id="__span-10-520"><a id="__codelineno-10-520" name="__codelineno-10-520" href="#__codelineno-10-520"></a>        await self.scheduler.redis.hset(
</span><span id="__span-10-521"><a id="__codelineno-10-521" name="__codelineno-10-521" href="#__codelineno-10-521"></a>            f&quot;task:{task.id}&quot;,
</span><span id="__span-10-522"><a id="__codelineno-10-522" name="__codelineno-10-522" href="#__codelineno-10-522"></a>            mapping=self.scheduler._serialize_task(task)
</span><span id="__span-10-523"><a id="__codelineno-10-523" name="__codelineno-10-523" href="#__codelineno-10-523"></a>        )
</span><span id="__span-10-524"><a id="__codelineno-10-524" name="__codelineno-10-524" href="#__codelineno-10-524"></a>
</span><span id="__span-10-525"><a id="__codelineno-10-525" name="__codelineno-10-525" href="#__codelineno-10-525"></a>        # Record start
</span><span id="__span-10-526"><a id="__codelineno-10-526" name="__codelineno-10-526" href="#__codelineno-10-526"></a>        self.scheduler.monitoring.record_task_started(task)
</span><span id="__span-10-527"><a id="__codelineno-10-527" name="__codelineno-10-527" href="#__codelineno-10-527"></a>
</span><span id="__span-10-528"><a id="__codelineno-10-528" name="__codelineno-10-528" href="#__codelineno-10-528"></a>        try:
</span><span id="__span-10-529"><a id="__codelineno-10-529" name="__codelineno-10-529" href="#__codelineno-10-529"></a>            # Get handler
</span><span id="__span-10-530"><a id="__codelineno-10-530" name="__codelineno-10-530" href="#__codelineno-10-530"></a>            handler = self.scheduler.task_handlers.get(task.name)
</span><span id="__span-10-531"><a id="__codelineno-10-531" name="__codelineno-10-531" href="#__codelineno-10-531"></a>            if not handler:
</span><span id="__span-10-532"><a id="__codelineno-10-532" name="__codelineno-10-532" href="#__codelineno-10-532"></a>                raise ValueError(f&quot;No handler registered for task {task.name}&quot;)
</span><span id="__span-10-533"><a id="__codelineno-10-533" name="__codelineno-10-533" href="#__codelineno-10-533"></a>
</span><span id="__span-10-534"><a id="__codelineno-10-534" name="__codelineno-10-534" href="#__codelineno-10-534"></a>            # Execute with timeout
</span><span id="__span-10-535"><a id="__codelineno-10-535" name="__codelineno-10-535" href="#__codelineno-10-535"></a>            future = self.executor.submit(handler, task.payload)
</span><span id="__span-10-536"><a id="__codelineno-10-536" name="__codelineno-10-536" href="#__codelineno-10-536"></a>            result = await asyncio.wait_for(
</span><span id="__span-10-537"><a id="__codelineno-10-537" name="__codelineno-10-537" href="#__codelineno-10-537"></a>                asyncio.get_event_loop().run_in_executor(None, future.result),
</span><span id="__span-10-538"><a id="__codelineno-10-538" name="__codelineno-10-538" href="#__codelineno-10-538"></a>                timeout=task.timeout_seconds
</span><span id="__span-10-539"><a id="__codelineno-10-539" name="__codelineno-10-539" href="#__codelineno-10-539"></a>            )
</span><span id="__span-10-540"><a id="__codelineno-10-540" name="__codelineno-10-540" href="#__codelineno-10-540"></a>
</span><span id="__span-10-541"><a id="__codelineno-10-541" name="__codelineno-10-541" href="#__codelineno-10-541"></a>            # Success
</span><span id="__span-10-542"><a id="__codelineno-10-542" name="__codelineno-10-542" href="#__codelineno-10-542"></a>            task.result = result
</span><span id="__span-10-543"><a id="__codelineno-10-543" name="__codelineno-10-543" href="#__codelineno-10-543"></a>            task.state = TaskState.COMPLETED
</span><span id="__span-10-544"><a id="__codelineno-10-544" name="__codelineno-10-544" href="#__codelineno-10-544"></a>            task.completed_at = time.time()
</span><span id="__span-10-545"><a id="__codelineno-10-545" name="__codelineno-10-545" href="#__codelineno-10-545"></a>
</span><span id="__span-10-546"><a id="__codelineno-10-546" name="__codelineno-10-546" href="#__codelineno-10-546"></a>            logging.info(f&quot;Task {task.id} completed successfully&quot;)
</span><span id="__span-10-547"><a id="__codelineno-10-547" name="__codelineno-10-547" href="#__codelineno-10-547"></a>
</span><span id="__span-10-548"><a id="__codelineno-10-548" name="__codelineno-10-548" href="#__codelineno-10-548"></a>        except asyncio.TimeoutError:
</span><span id="__span-10-549"><a id="__codelineno-10-549" name="__codelineno-10-549" href="#__codelineno-10-549"></a>            task.state = TaskState.FAILED
</span><span id="__span-10-550"><a id="__codelineno-10-550" name="__codelineno-10-550" href="#__codelineno-10-550"></a>            task.error = f&quot;Timeout after {task.timeout_seconds}s&quot;
</span><span id="__span-10-551"><a id="__codelineno-10-551" name="__codelineno-10-551" href="#__codelineno-10-551"></a>            logging.error(f&quot;Task {task.id} timed out&quot;)
</span><span id="__span-10-552"><a id="__codelineno-10-552" name="__codelineno-10-552" href="#__codelineno-10-552"></a>
</span><span id="__span-10-553"><a id="__codelineno-10-553" name="__codelineno-10-553" href="#__codelineno-10-553"></a>        except Exception as e:
</span><span id="__span-10-554"><a id="__codelineno-10-554" name="__codelineno-10-554" href="#__codelineno-10-554"></a>            task.state = TaskState.FAILED
</span><span id="__span-10-555"><a id="__codelineno-10-555" name="__codelineno-10-555" href="#__codelineno-10-555"></a>            task.error = str(e)
</span><span id="__span-10-556"><a id="__codelineno-10-556" name="__codelineno-10-556" href="#__codelineno-10-556"></a>            logging.error(f&quot;Task {task.id} failed: {e}&quot;)
</span><span id="__span-10-557"><a id="__codelineno-10-557" name="__codelineno-10-557" href="#__codelineno-10-557"></a>
</span><span id="__span-10-558"><a id="__codelineno-10-558" name="__codelineno-10-558" href="#__codelineno-10-558"></a>        finally:
</span><span id="__span-10-559"><a id="__codelineno-10-559" name="__codelineno-10-559" href="#__codelineno-10-559"></a>            # Update final state
</span><span id="__span-10-560"><a id="__codelineno-10-560" name="__codelineno-10-560" href="#__codelineno-10-560"></a>            await self.scheduler.redis.hset(
</span><span id="__span-10-561"><a id="__codelineno-10-561" name="__codelineno-10-561" href="#__codelineno-10-561"></a>                f&quot;task:{task.id}&quot;,
</span><span id="__span-10-562"><a id="__codelineno-10-562" name="__codelineno-10-562" href="#__codelineno-10-562"></a>                mapping=self.scheduler._serialize_task(task)
</span><span id="__span-10-563"><a id="__codelineno-10-563" name="__codelineno-10-563" href="#__codelineno-10-563"></a>            )
</span><span id="__span-10-564"><a id="__codelineno-10-564" name="__codelineno-10-564" href="#__codelineno-10-564"></a>
</span><span id="__span-10-565"><a id="__codelineno-10-565" name="__codelineno-10-565" href="#__codelineno-10-565"></a>            # Record completion
</span><span id="__span-10-566"><a id="__codelineno-10-566" name="__codelineno-10-566" href="#__codelineno-10-566"></a>            self.scheduler.monitoring.record_task_completed(task)
</span><span id="__span-10-567"><a id="__codelineno-10-567" name="__codelineno-10-567" href="#__codelineno-10-567"></a>
</span><span id="__span-10-568"><a id="__codelineno-10-568" name="__codelineno-10-568" href="#__codelineno-10-568"></a>            self.current_task = None
</span><span id="__span-10-569"><a id="__codelineno-10-569" name="__codelineno-10-569" href="#__codelineno-10-569"></a>            self.processed_count += 1
</span><span id="__span-10-570"><a id="__codelineno-10-570" name="__codelineno-10-570" href="#__codelineno-10-570"></a>
</span><span id="__span-10-571"><a id="__codelineno-10-571" name="__codelineno-10-571" href="#__codelineno-10-571"></a>class MonitoringSystem:
</span><span id="__span-10-572"><a id="__codelineno-10-572" name="__codelineno-10-572" href="#__codelineno-10-572"></a>    &quot;&quot;&quot;Monitor scheduler performance&quot;&quot;&quot;
</span><span id="__span-10-573"><a id="__codelineno-10-573" name="__codelineno-10-573" href="#__codelineno-10-573"></a>
</span><span id="__span-10-574"><a id="__codelineno-10-574" name="__codelineno-10-574" href="#__codelineno-10-574"></a>    def __init__(self):
</span><span id="__span-10-575"><a id="__codelineno-10-575" name="__codelineno-10-575" href="#__codelineno-10-575"></a>        self.metrics = {
</span><span id="__span-10-576"><a id="__codelineno-10-576" name="__codelineno-10-576" href="#__codelineno-10-576"></a>            &#39;tasks_submitted&#39;: 0,
</span><span id="__span-10-577"><a id="__codelineno-10-577" name="__codelineno-10-577" href="#__codelineno-10-577"></a>            &#39;tasks_started&#39;: 0,
</span><span id="__span-10-578"><a id="__codelineno-10-578" name="__codelineno-10-578" href="#__codelineno-10-578"></a>            &#39;tasks_completed&#39;: 0,
</span><span id="__span-10-579"><a id="__codelineno-10-579" name="__codelineno-10-579" href="#__codelineno-10-579"></a>            &#39;tasks_failed&#39;: 0,
</span><span id="__span-10-580"><a id="__codelineno-10-580" name="__codelineno-10-580" href="#__codelineno-10-580"></a>            &#39;total_processing_time&#39;: 0,
</span><span id="__span-10-581"><a id="__codelineno-10-581" name="__codelineno-10-581" href="#__codelineno-10-581"></a>            &#39;queue_depths&#39;: defaultdict(int)
</span><span id="__span-10-582"><a id="__codelineno-10-582" name="__codelineno-10-582" href="#__codelineno-10-582"></a>        }
</span><span id="__span-10-583"><a id="__codelineno-10-583" name="__codelineno-10-583" href="#__codelineno-10-583"></a>        self.task_durations = []
</span><span id="__span-10-584"><a id="__codelineno-10-584" name="__codelineno-10-584" href="#__codelineno-10-584"></a>
</span><span id="__span-10-585"><a id="__codelineno-10-585" name="__codelineno-10-585" href="#__codelineno-10-585"></a>    def record_task_submitted(self, task: Task):
</span><span id="__span-10-586"><a id="__codelineno-10-586" name="__codelineno-10-586" href="#__codelineno-10-586"></a>        self.metrics[&#39;tasks_submitted&#39;] += 1
</span><span id="__span-10-587"><a id="__codelineno-10-587" name="__codelineno-10-587" href="#__codelineno-10-587"></a>
</span><span id="__span-10-588"><a id="__codelineno-10-588" name="__codelineno-10-588" href="#__codelineno-10-588"></a>    def record_task_started(self, task: Task):
</span><span id="__span-10-589"><a id="__codelineno-10-589" name="__codelineno-10-589" href="#__codelineno-10-589"></a>        self.metrics[&#39;tasks_started&#39;] += 1
</span><span id="__span-10-590"><a id="__codelineno-10-590" name="__codelineno-10-590" href="#__codelineno-10-590"></a>
</span><span id="__span-10-591"><a id="__codelineno-10-591" name="__codelineno-10-591" href="#__codelineno-10-591"></a>    def record_task_completed(self, task: Task):
</span><span id="__span-10-592"><a id="__codelineno-10-592" name="__codelineno-10-592" href="#__codelineno-10-592"></a>        if task.state == TaskState.COMPLETED:
</span><span id="__span-10-593"><a id="__codelineno-10-593" name="__codelineno-10-593" href="#__codelineno-10-593"></a>            self.metrics[&#39;tasks_completed&#39;] += 1
</span><span id="__span-10-594"><a id="__codelineno-10-594" name="__codelineno-10-594" href="#__codelineno-10-594"></a>        else:
</span><span id="__span-10-595"><a id="__codelineno-10-595" name="__codelineno-10-595" href="#__codelineno-10-595"></a>            self.metrics[&#39;tasks_failed&#39;] += 1
</span><span id="__span-10-596"><a id="__codelineno-10-596" name="__codelineno-10-596" href="#__codelineno-10-596"></a>
</span><span id="__span-10-597"><a id="__codelineno-10-597" name="__codelineno-10-597" href="#__codelineno-10-597"></a>        if task.started_at and task.completed_at:
</span><span id="__span-10-598"><a id="__codelineno-10-598" name="__codelineno-10-598" href="#__codelineno-10-598"></a>            duration = task.completed_at - task.started_at
</span><span id="__span-10-599"><a id="__codelineno-10-599" name="__codelineno-10-599" href="#__codelineno-10-599"></a>            self.task_durations.append(duration)
</span><span id="__span-10-600"><a id="__codelineno-10-600" name="__codelineno-10-600" href="#__codelineno-10-600"></a>            self.metrics[&#39;total_processing_time&#39;] += duration
</span><span id="__span-10-601"><a id="__codelineno-10-601" name="__codelineno-10-601" href="#__codelineno-10-601"></a>
</span><span id="__span-10-602"><a id="__codelineno-10-602" name="__codelineno-10-602" href="#__codelineno-10-602"></a>    async def run(self):
</span><span id="__span-10-603"><a id="__codelineno-10-603" name="__codelineno-10-603" href="#__codelineno-10-603"></a>        &quot;&quot;&quot;Periodically report metrics&quot;&quot;&quot;
</span><span id="__span-10-604"><a id="__codelineno-10-604" name="__codelineno-10-604" href="#__codelineno-10-604"></a>        while True:
</span><span id="__span-10-605"><a id="__codelineno-10-605" name="__codelineno-10-605" href="#__codelineno-10-605"></a>            await asyncio.sleep(60)  # Report every minute
</span><span id="__span-10-606"><a id="__codelineno-10-606" name="__codelineno-10-606" href="#__codelineno-10-606"></a>            self._report_metrics()
</span><span id="__span-10-607"><a id="__codelineno-10-607" name="__codelineno-10-607" href="#__codelineno-10-607"></a>
</span><span id="__span-10-608"><a id="__codelineno-10-608" name="__codelineno-10-608" href="#__codelineno-10-608"></a>    def _report_metrics(self):
</span><span id="__span-10-609"><a id="__codelineno-10-609" name="__codelineno-10-609" href="#__codelineno-10-609"></a>        &quot;&quot;&quot;Generate performance report&quot;&quot;&quot;
</span><span id="__span-10-610"><a id="__codelineno-10-610" name="__codelineno-10-610" href="#__codelineno-10-610"></a>        if not self.task_durations:
</span><span id="__span-10-611"><a id="__codelineno-10-611" name="__codelineno-10-611" href="#__codelineno-10-611"></a>            return
</span><span id="__span-10-612"><a id="__codelineno-10-612" name="__codelineno-10-612" href="#__codelineno-10-612"></a>
</span><span id="__span-10-613"><a id="__codelineno-10-613" name="__codelineno-10-613" href="#__codelineno-10-613"></a>        avg_duration = sum(self.task_durations) / len(self.task_durations)
</span><span id="__span-10-614"><a id="__codelineno-10-614" name="__codelineno-10-614" href="#__codelineno-10-614"></a>        p50_duration = sorted(self.task_durations)[len(self.task_durations) // 2]
</span><span id="__span-10-615"><a id="__codelineno-10-615" name="__codelineno-10-615" href="#__codelineno-10-615"></a>        p99_duration = sorted(self.task_durations)[int(len(self.task_durations) * 0.99)]
</span><span id="__span-10-616"><a id="__codelineno-10-616" name="__codelineno-10-616" href="#__codelineno-10-616"></a>
</span><span id="__span-10-617"><a id="__codelineno-10-617" name="__codelineno-10-617" href="#__codelineno-10-617"></a>        throughput = self.metrics[&#39;tasks_completed&#39;] / 60  # per second
</span><span id="__span-10-618"><a id="__codelineno-10-618" name="__codelineno-10-618" href="#__codelineno-10-618"></a>
</span><span id="__span-10-619"><a id="__codelineno-10-619" name="__codelineno-10-619" href="#__codelineno-10-619"></a>        print(&quot;\n=== Scheduler Performance Report ===&quot;)
</span><span id="__span-10-620"><a id="__codelineno-10-620" name="__codelineno-10-620" href="#__codelineno-10-620"></a>        print(f&quot;Tasks submitted: {self.metrics[&#39;tasks_submitted&#39;]}&quot;)
</span><span id="__span-10-621"><a id="__codelineno-10-621" name="__codelineno-10-621" href="#__codelineno-10-621"></a>        print(f&quot;Tasks completed: {self.metrics[&#39;tasks_completed&#39;]}&quot;)
</span><span id="__span-10-622"><a id="__codelineno-10-622" name="__codelineno-10-622" href="#__codelineno-10-622"></a>        print(f&quot;Tasks failed: {self.metrics[&#39;tasks_failed&#39;]}&quot;)
</span><span id="__span-10-623"><a id="__codelineno-10-623" name="__codelineno-10-623" href="#__codelineno-10-623"></a>        print(f&quot;Throughput: {throughput:.2f} tasks/sec&quot;)
</span><span id="__span-10-624"><a id="__codelineno-10-624" name="__codelineno-10-624" href="#__codelineno-10-624"></a>        print(f&quot;Avg duration: {avg_duration:.2f}s&quot;)
</span><span id="__span-10-625"><a id="__codelineno-10-625" name="__codelineno-10-625" href="#__codelineno-10-625"></a>        print(f&quot;P50 duration: {p50_duration:.2f}s&quot;)
</span><span id="__span-10-626"><a id="__codelineno-10-626" name="__codelineno-10-626" href="#__codelineno-10-626"></a>        print(f&quot;P99 duration: {p99_duration:.2f}s&quot;)
</span><span id="__span-10-627"><a id="__codelineno-10-627" name="__codelineno-10-627" href="#__codelineno-10-627"></a>
</span><span id="__span-10-628"><a id="__codelineno-10-628" name="__codelineno-10-628" href="#__codelineno-10-628"></a># Example usage
</span><span id="__span-10-629"><a id="__codelineno-10-629" name="__codelineno-10-629" href="#__codelineno-10-629"></a>async def example_usage():
</span><span id="__span-10-630"><a id="__codelineno-10-630" name="__codelineno-10-630" href="#__codelineno-10-630"></a>    # Create scheduler
</span><span id="__span-10-631"><a id="__codelineno-10-631" name="__codelineno-10-631" href="#__codelineno-10-631"></a>    scheduler = DistributedTaskScheduler(
</span><span id="__span-10-632"><a id="__codelineno-10-632" name="__codelineno-10-632" href="#__codelineno-10-632"></a>        redis_url=&quot;redis://localhost&quot;,
</span><span id="__span-10-633"><a id="__codelineno-10-633" name="__codelineno-10-633" href="#__codelineno-10-633"></a>        worker_pool_size=10
</span><span id="__span-10-634"><a id="__codelineno-10-634" name="__codelineno-10-634" href="#__codelineno-10-634"></a>    )
</span><span id="__span-10-635"><a id="__codelineno-10-635" name="__codelineno-10-635" href="#__codelineno-10-635"></a>
</span><span id="__span-10-636"><a id="__codelineno-10-636" name="__codelineno-10-636" href="#__codelineno-10-636"></a>    # Register task handlers
</span><span id="__span-10-637"><a id="__codelineno-10-637" name="__codelineno-10-637" href="#__codelineno-10-637"></a>    def process_image(payload):
</span><span id="__span-10-638"><a id="__codelineno-10-638" name="__codelineno-10-638" href="#__codelineno-10-638"></a>        &quot;&quot;&quot;Simulate image processing&quot;&quot;&quot;
</span><span id="__span-10-639"><a id="__codelineno-10-639" name="__codelineno-10-639" href="#__codelineno-10-639"></a>        time.sleep(payload.get(&#39;duration&#39;, 1))
</span><span id="__span-10-640"><a id="__codelineno-10-640" name="__codelineno-10-640" href="#__codelineno-10-640"></a>        return f&quot;Processed image {payload[&#39;image_id&#39;]}&quot;
</span><span id="__span-10-641"><a id="__codelineno-10-641" name="__codelineno-10-641" href="#__codelineno-10-641"></a>
</span><span id="__span-10-642"><a id="__codelineno-10-642" name="__codelineno-10-642" href="#__codelineno-10-642"></a>    def analyze_data(payload):
</span><span id="__span-10-643"><a id="__codelineno-10-643" name="__codelineno-10-643" href="#__codelineno-10-643"></a>        &quot;&quot;&quot;Simulate data analysis&quot;&quot;&quot;
</span><span id="__span-10-644"><a id="__codelineno-10-644" name="__codelineno-10-644" href="#__codelineno-10-644"></a>        time.sleep(payload.get(&#39;duration&#39;, 2))
</span><span id="__span-10-645"><a id="__codelineno-10-645" name="__codelineno-10-645" href="#__codelineno-10-645"></a>        return f&quot;Analyzed dataset {payload[&#39;dataset_id&#39;]}&quot;
</span><span id="__span-10-646"><a id="__codelineno-10-646" name="__codelineno-10-646" href="#__codelineno-10-646"></a>
</span><span id="__span-10-647"><a id="__codelineno-10-647" name="__codelineno-10-647" href="#__codelineno-10-647"></a>    scheduler.register_handler(&#39;process_image&#39;, process_image)
</span><span id="__span-10-648"><a id="__codelineno-10-648" name="__codelineno-10-648" href="#__codelineno-10-648"></a>    scheduler.register_handler(&#39;analyze_data&#39;, analyze_data)
</span><span id="__span-10-649"><a id="__codelineno-10-649" name="__codelineno-10-649" href="#__codelineno-10-649"></a>
</span><span id="__span-10-650"><a id="__codelineno-10-650" name="__codelineno-10-650" href="#__codelineno-10-650"></a>    # Start scheduler
</span><span id="__span-10-651"><a id="__codelineno-10-651" name="__codelineno-10-651" href="#__codelineno-10-651"></a>    await scheduler.start()
</span><span id="__span-10-652"><a id="__codelineno-10-652" name="__codelineno-10-652" href="#__codelineno-10-652"></a>
</span><span id="__span-10-653"><a id="__codelineno-10-653" name="__codelineno-10-653" href="#__codelineno-10-653"></a>    # Submit tasks
</span><span id="__span-10-654"><a id="__codelineno-10-654" name="__codelineno-10-654" href="#__codelineno-10-654"></a>    tasks = []
</span><span id="__span-10-655"><a id="__codelineno-10-655" name="__codelineno-10-655" href="#__codelineno-10-655"></a>
</span><span id="__span-10-656"><a id="__codelineno-10-656" name="__codelineno-10-656" href="#__codelineno-10-656"></a>    # High priority image processing
</span><span id="__span-10-657"><a id="__codelineno-10-657" name="__codelineno-10-657" href="#__codelineno-10-657"></a>    for i in range(100):
</span><span id="__span-10-658"><a id="__codelineno-10-658" name="__codelineno-10-658" href="#__codelineno-10-658"></a>        task = Task(
</span><span id="__span-10-659"><a id="__codelineno-10-659" name="__codelineno-10-659" href="#__codelineno-10-659"></a>            id=str(uuid.uuid4()),
</span><span id="__span-10-660"><a id="__codelineno-10-660" name="__codelineno-10-660" href="#__codelineno-10-660"></a>            name=&#39;process_image&#39;,
</span><span id="__span-10-661"><a id="__codelineno-10-661" name="__codelineno-10-661" href="#__codelineno-10-661"></a>            payload={&#39;image_id&#39;: i, &#39;duration&#39;: 0.5},
</span><span id="__span-10-662"><a id="__codelineno-10-662" name="__codelineno-10-662" href="#__codelineno-10-662"></a>            priority=-1  # High priority
</span><span id="__span-10-663"><a id="__codelineno-10-663" name="__codelineno-10-663" href="#__codelineno-10-663"></a>        )
</span><span id="__span-10-664"><a id="__codelineno-10-664" name="__codelineno-10-664" href="#__codelineno-10-664"></a>        task_id = await scheduler.submit_task(task)
</span><span id="__span-10-665"><a id="__codelineno-10-665" name="__codelineno-10-665" href="#__codelineno-10-665"></a>        tasks.append(task_id)
</span><span id="__span-10-666"><a id="__codelineno-10-666" name="__codelineno-10-666" href="#__codelineno-10-666"></a>
</span><span id="__span-10-667"><a id="__codelineno-10-667" name="__codelineno-10-667" href="#__codelineno-10-667"></a>    # Normal priority data analysis
</span><span id="__span-10-668"><a id="__codelineno-10-668" name="__codelineno-10-668" href="#__codelineno-10-668"></a>    for i in range(50):
</span><span id="__span-10-669"><a id="__codelineno-10-669" name="__codelineno-10-669" href="#__codelineno-10-669"></a>        task = Task(
</span><span id="__span-10-670"><a id="__codelineno-10-670" name="__codelineno-10-670" href="#__codelineno-10-670"></a>            id=str(uuid.uuid4()),
</span><span id="__span-10-671"><a id="__codelineno-10-671" name="__codelineno-10-671" href="#__codelineno-10-671"></a>            name=&#39;analyze_data&#39;,
</span><span id="__span-10-672"><a id="__codelineno-10-672" name="__codelineno-10-672" href="#__codelineno-10-672"></a>            payload={&#39;dataset_id&#39;: i, &#39;duration&#39;: 2},
</span><span id="__span-10-673"><a id="__codelineno-10-673" name="__codelineno-10-673" href="#__codelineno-10-673"></a>            priority=0  # Normal priority
</span><span id="__span-10-674"><a id="__codelineno-10-674" name="__codelineno-10-674" href="#__codelineno-10-674"></a>        )
</span><span id="__span-10-675"><a id="__codelineno-10-675" name="__codelineno-10-675" href="#__codelineno-10-675"></a>        task_id = await scheduler.submit_task(task)
</span><span id="__span-10-676"><a id="__codelineno-10-676" name="__codelineno-10-676" href="#__codelineno-10-676"></a>        tasks.append(task_id)
</span><span id="__span-10-677"><a id="__codelineno-10-677" name="__codelineno-10-677" href="#__codelineno-10-677"></a>
</span><span id="__span-10-678"><a id="__codelineno-10-678" name="__codelineno-10-678" href="#__codelineno-10-678"></a>    # Wait for completion
</span><span id="__span-10-679"><a id="__codelineno-10-679" name="__codelineno-10-679" href="#__codelineno-10-679"></a>    await asyncio.sleep(30)
</span><span id="__span-10-680"><a id="__codelineno-10-680" name="__codelineno-10-680" href="#__codelineno-10-680"></a>
</span><span id="__span-10-681"><a id="__codelineno-10-681" name="__codelineno-10-681" href="#__codelineno-10-681"></a>    # Check results
</span><span id="__span-10-682"><a id="__codelineno-10-682" name="__codelineno-10-682" href="#__codelineno-10-682"></a>    completed = 0
</span><span id="__span-10-683"><a id="__codelineno-10-683" name="__codelineno-10-683" href="#__codelineno-10-683"></a>    failed = 0
</span><span id="__span-10-684"><a id="__codelineno-10-684" name="__codelineno-10-684" href="#__codelineno-10-684"></a>
</span><span id="__span-10-685"><a id="__codelineno-10-685" name="__codelineno-10-685" href="#__codelineno-10-685"></a>    for task_id in tasks:
</span><span id="__span-10-686"><a id="__codelineno-10-686" name="__codelineno-10-686" href="#__codelineno-10-686"></a>        task = await scheduler.get_task_status(task_id)
</span><span id="__span-10-687"><a id="__codelineno-10-687" name="__codelineno-10-687" href="#__codelineno-10-687"></a>        if task.state == TaskState.COMPLETED:
</span><span id="__span-10-688"><a id="__codelineno-10-688" name="__codelineno-10-688" href="#__codelineno-10-688"></a>            completed += 1
</span><span id="__span-10-689"><a id="__codelineno-10-689" name="__codelineno-10-689" href="#__codelineno-10-689"></a>        elif task.state == TaskState.FAILED:
</span><span id="__span-10-690"><a id="__codelineno-10-690" name="__codelineno-10-690" href="#__codelineno-10-690"></a>            failed += 1
</span><span id="__span-10-691"><a id="__codelineno-10-691" name="__codelineno-10-691" href="#__codelineno-10-691"></a>
</span><span id="__span-10-692"><a id="__codelineno-10-692" name="__codelineno-10-692" href="#__codelineno-10-692"></a>    print(f&quot;\nFinal results: {completed} completed, {failed} failed&quot;)
</span><span id="__span-10-693"><a id="__codelineno-10-693" name="__codelineno-10-693" href="#__codelineno-10-693"></a>
</span><span id="__span-10-694"><a id="__codelineno-10-694" name="__codelineno-10-694" href="#__codelineno-10-694"></a>if __name__ == &quot;__main__&quot;:
</span><span id="__span-10-695"><a id="__codelineno-10-695" name="__codelineno-10-695" href="#__codelineno-10-695"></a>    asyncio.run(example_usage())
</span><span id="__span-10-696"><a id="__codelineno-10-696" name="__codelineno-10-696" href="#__codelineno-10-696"></a>```bash
</span><span id="__span-10-697"><a id="__codelineno-10-697" name="__codelineno-10-697" href="#__codelineno-10-697"></a>### Production War Stories
</span><span id="__span-10-698"><a id="__codelineno-10-698" name="__codelineno-10-698" href="#__codelineno-10-698"></a>
</span><span id="__span-10-699"><a id="__codelineno-10-699" name="__codelineno-10-699" href="#__codelineno-10-699"></a>#### Story 1: The 100x Speed-Up That Almost Broke Everything
</span><span id="__span-10-700"><a id="__codelineno-10-700" name="__codelineno-10-700" href="#__codelineno-10-700"></a>
</span><span id="__span-10-701"><a id="__codelineno-10-701" name="__codelineno-10-701" href="#__codelineno-10-701"></a>**Company**: Social Media Analytics Platform
</span><span id="__span-10-702"><a id="__codelineno-10-702" name="__codelineno-10-702" href="#__codelineno-10-702"></a>**Challenge**: Process 1B social posts daily for sentiment analysis
</span><span id="__span-10-703"><a id="__codelineno-10-703" name="__codelineno-10-703" href="#__codelineno-10-703"></a>
</span><span id="__span-10-704"><a id="__codelineno-10-704" name="__codelineno-10-704" href="#__codelineno-10-704"></a>**Original System**:
</span><span id="__span-10-705"><a id="__codelineno-10-705" name="__codelineno-10-705" href="#__codelineno-10-705"></a>```python
</span><span id="__span-10-706"><a id="__codelineno-10-706" name="__codelineno-10-706" href="#__codelineno-10-706"></a># Single-threaded nightmare
</span><span id="__span-10-707"><a id="__codelineno-10-707" name="__codelineno-10-707" href="#__codelineno-10-707"></a>for post in posts:
</span><span id="__span-10-708"><a id="__codelineno-10-708" name="__codelineno-10-708" href="#__codelineno-10-708"></a>    sentiment = analyze_sentiment(post)  # 100ms per post
</span><span id="__span-10-709"><a id="__codelineno-10-709" name="__codelineno-10-709" href="#__codelineno-10-709"></a>    save_to_database(sentiment)         # 50ms per save
</span><span id="__span-10-710"><a id="__codelineno-10-710" name="__codelineno-10-710" href="#__codelineno-10-710"></a># Total: 150ms  1B = 1,736 days!
</span><span id="__span-10-711"><a id="__codelineno-10-711" name="__codelineno-10-711" href="#__codelineno-10-711"></a>```text
</span><span id="__span-10-712"><a id="__codelineno-10-712" name="__codelineno-10-712" href="#__codelineno-10-712"></a>**First Attempt**: Naive parallelization
</span><span id="__span-10-713"><a id="__codelineno-10-713" name="__codelineno-10-713" href="#__codelineno-10-713"></a>```python
</span><span id="__span-10-714"><a id="__codelineno-10-714" name="__codelineno-10-714" href="#__codelineno-10-714"></a># Seemed clever...
</span><span id="__span-10-715"><a id="__codelineno-10-715" name="__codelineno-10-715" href="#__codelineno-10-715"></a>with ThreadPoolExecutor(max_workers=1000) as executor:
</span><span id="__span-10-716"><a id="__codelineno-10-716" name="__codelineno-10-716" href="#__codelineno-10-716"></a>    futures = [executor.submit(process_post, post) for post in posts]
</span><span id="__span-10-717"><a id="__codelineno-10-717" name="__codelineno-10-717" href="#__codelineno-10-717"></a>    results = [f.result() for f in futures]
</span><span id="__span-10-718"><a id="__codelineno-10-718" name="__codelineno-10-718" href="#__codelineno-10-718"></a>
</span><span id="__span-10-719"><a id="__codelineno-10-719" name="__codelineno-10-719" href="#__codelineno-10-719"></a># Result: Database melted, OOM errors, AWS bill $10K
</span><span id="__span-10-720"><a id="__codelineno-10-720" name="__codelineno-10-720" href="#__codelineno-10-720"></a>```yaml
</span><span id="__span-10-721"><a id="__codelineno-10-721" name="__codelineno-10-721" href="#__codelineno-10-721"></a>**What Went Wrong**:
</span><span id="__span-10-722"><a id="__codelineno-10-722" name="__codelineno-10-722" href="#__codelineno-10-722"></a>1. Database connection pool exhausted (max 100 connections)
</span><span id="__span-10-723"><a id="__codelineno-10-723" name="__codelineno-10-723" href="#__codelineno-10-723"></a>2. Memory usage: 1000 threads  10MB stack = 10GB overhead
</span><span id="__span-10-724"><a id="__codelineno-10-724" name="__codelineno-10-724" href="#__codelineno-10-724"></a>3. Context switching overhead dominated processing
</span><span id="__span-10-725"><a id="__codelineno-10-725" name="__codelineno-10-725" href="#__codelineno-10-725"></a>4. No backpressure - queue grew unbounded
</span><span id="__span-10-726"><a id="__codelineno-10-726" name="__codelineno-10-726" href="#__codelineno-10-726"></a>
</span><span id="__span-10-727"><a id="__codelineno-10-727" name="__codelineno-10-727" href="#__codelineno-10-727"></a>**The Fix**:
</span><span id="__span-10-728"><a id="__codelineno-10-728" name="__codelineno-10-728" href="#__codelineno-10-728"></a>```python
</span><span id="__span-10-729"><a id="__codelineno-10-729" name="__codelineno-10-729" href="#__codelineno-10-729"></a>class SmartProcessor:
</span><span id="__span-10-730"><a id="__codelineno-10-730" name="__codelineno-10-730" href="#__codelineno-10-730"></a>    def __init__(self):
</span><span id="__span-10-731"><a id="__codelineno-10-731" name="__codelineno-10-731" href="#__codelineno-10-731"></a>        self.db_pool = ConnectionPool(max_size=50)
</span><span id="__span-10-732"><a id="__codelineno-10-732" name="__codelineno-10-732" href="#__codelineno-10-732"></a>        self.workers = 100  # Not 1000!
</span><span id="__span-10-733"><a id="__codelineno-10-733" name="__codelineno-10-733" href="#__codelineno-10-733"></a>        self.batch_size = 1000
</span><span id="__span-10-734"><a id="__codelineno-10-734" name="__codelineno-10-734" href="#__codelineno-10-734"></a>        self.queue_limit = 10000
</span><span id="__span-10-735"><a id="__codelineno-10-735" name="__codelineno-10-735" href="#__codelineno-10-735"></a>
</span><span id="__span-10-736"><a id="__codelineno-10-736" name="__codelineno-10-736" href="#__codelineno-10-736"></a>    async def process_all(self, posts):
</span><span id="__span-10-737"><a id="__codelineno-10-737" name="__codelineno-10-737" href="#__codelineno-10-737"></a>        # Bounded queue prevents memory explosion
</span><span id="__span-10-738"><a id="__codelineno-10-738" name="__codelineno-10-738" href="#__codelineno-10-738"></a>        queue = asyncio.Queue(maxsize=self.queue_limit)
</span><span id="__span-10-739"><a id="__codelineno-10-739" name="__codelineno-10-739" href="#__codelineno-10-739"></a>
</span><span id="__span-10-740"><a id="__codelineno-10-740" name="__codelineno-10-740" href="#__codelineno-10-740"></a>        # Producer with backpressure
</span><span id="__span-10-741"><a id="__codelineno-10-741" name="__codelineno-10-741" href="#__codelineno-10-741"></a>        async def producer():
</span><span id="__span-10-742"><a id="__codelineno-10-742" name="__codelineno-10-742" href="#__codelineno-10-742"></a>            for batch in chunks(posts, self.batch_size):
</span><span id="__span-10-743"><a id="__codelineno-10-743" name="__codelineno-10-743" href="#__codelineno-10-743"></a>                await queue.put(batch)  # Blocks if queue full
</span><span id="__span-10-744"><a id="__codelineno-10-744" name="__codelineno-10-744" href="#__codelineno-10-744"></a>
</span><span id="__span-10-745"><a id="__codelineno-10-745" name="__codelineno-10-745" href="#__codelineno-10-745"></a>        # Consumers with batching
</span><span id="__span-10-746"><a id="__codelineno-10-746" name="__codelineno-10-746" href="#__codelineno-10-746"></a>        async def consumer():
</span><span id="__span-10-747"><a id="__codelineno-10-747" name="__codelineno-10-747" href="#__codelineno-10-747"></a>            while True:
</span><span id="__span-10-748"><a id="__codelineno-10-748" name="__codelineno-10-748" href="#__codelineno-10-748"></a>                batch = await queue.get()
</span><span id="__span-10-749"><a id="__codelineno-10-749" name="__codelineno-10-749" href="#__codelineno-10-749"></a>
</span><span id="__span-10-750"><a id="__codelineno-10-750" name="__codelineno-10-750" href="#__codelineno-10-750"></a>                # Process batch in parallel
</span><span id="__span-10-751"><a id="__codelineno-10-751" name="__codelineno-10-751" href="#__codelineno-10-751"></a>                sentiments = await asyncio.gather(*[
</span><span id="__span-10-752"><a id="__codelineno-10-752" name="__codelineno-10-752" href="#__codelineno-10-752"></a>                    analyze_sentiment_async(post) for post in batch
</span><span id="__span-10-753"><a id="__codelineno-10-753" name="__codelineno-10-753" href="#__codelineno-10-753"></a>                ])
</span><span id="__span-10-754"><a id="__codelineno-10-754" name="__codelineno-10-754" href="#__codelineno-10-754"></a>
</span><span id="__span-10-755"><a id="__codelineno-10-755" name="__codelineno-10-755" href="#__codelineno-10-755"></a>                # Single batched DB write
</span><span id="__span-10-756"><a id="__codelineno-10-756" name="__codelineno-10-756" href="#__codelineno-10-756"></a>                async with self.db_pool.acquire() as conn:
</span><span id="__span-10-757"><a id="__codelineno-10-757" name="__codelineno-10-757" href="#__codelineno-10-757"></a>                    await conn.insert_many(sentiments)
</span><span id="__span-10-758"><a id="__codelineno-10-758" name="__codelineno-10-758" href="#__codelineno-10-758"></a>
</span><span id="__span-10-759"><a id="__codelineno-10-759" name="__codelineno-10-759" href="#__codelineno-10-759"></a>        # Run with controlled concurrency
</span><span id="__span-10-760"><a id="__codelineno-10-760" name="__codelineno-10-760" href="#__codelineno-10-760"></a>        await asyncio.gather(
</span><span id="__span-10-761"><a id="__codelineno-10-761" name="__codelineno-10-761" href="#__codelineno-10-761"></a>            producer(),
</span><span id="__span-10-762"><a id="__codelineno-10-762" name="__codelineno-10-762" href="#__codelineno-10-762"></a>            *[consumer() for _ in range(self.workers)]
</span><span id="__span-10-763"><a id="__codelineno-10-763" name="__codelineno-10-763" href="#__codelineno-10-763"></a>        )
</span><span id="__span-10-764"><a id="__codelineno-10-764" name="__codelineno-10-764" href="#__codelineno-10-764"></a>
</span><span id="__span-10-765"><a id="__codelineno-10-765" name="__codelineno-10-765" href="#__codelineno-10-765"></a># Result:
</span><span id="__span-10-766"><a id="__codelineno-10-766" name="__codelineno-10-766" href="#__codelineno-10-766"></a># - 100x speedup (17 days  4 hours)
</span><span id="__span-10-767"><a id="__codelineno-10-767" name="__codelineno-10-767" href="#__codelineno-10-767"></a># - Memory usage stable at 2GB
</span><span id="__span-10-768"><a id="__codelineno-10-768" name="__codelineno-10-768" href="#__codelineno-10-768"></a># - Database happy
</span><span id="__span-10-769"><a id="__codelineno-10-769" name="__codelineno-10-769" href="#__codelineno-10-769"></a># - AWS bill reasonable
</span><span id="__span-10-770"><a id="__codelineno-10-770" name="__codelineno-10-770" href="#__codelineno-10-770"></a>```yaml
</span><span id="__span-10-771"><a id="__codelineno-10-771" name="__codelineno-10-771" href="#__codelineno-10-771"></a>**Lessons Learned**:
</span><span id="__span-10-772"><a id="__codelineno-10-772" name="__codelineno-10-772" href="#__codelineno-10-772"></a>1. More workers  more speed
</span><span id="__span-10-773"><a id="__codelineno-10-773" name="__codelineno-10-773" href="#__codelineno-10-773"></a>2. Batch operations are crucial
</span><span id="__span-10-774"><a id="__codelineno-10-774" name="__codelineno-10-774" href="#__codelineno-10-774"></a>3. Backpressure prevents cascading failures
</span><span id="__span-10-775"><a id="__codelineno-10-775" name="__codelineno-10-775" href="#__codelineno-10-775"></a>4. Monitor everything before scaling
</span><span id="__span-10-776"><a id="__codelineno-10-776" name="__codelineno-10-776" href="#__codelineno-10-776"></a>
</span><span id="__span-10-777"><a id="__codelineno-10-777" name="__codelineno-10-777" href="#__codelineno-10-777"></a>#### Story 2: When Work Stealing Saved Black Friday
</span><span id="__span-10-778"><a id="__codelineno-10-778" name="__codelineno-10-778" href="#__codelineno-10-778"></a>
</span><span id="__span-10-779"><a id="__codelineno-10-779" name="__codelineno-10-779" href="#__codelineno-10-779"></a>**Company**: E-commerce Platform
</span><span id="__span-10-780"><a id="__codelineno-10-780" name="__codelineno-10-780" href="#__codelineno-10-780"></a>**Situation**: Black Friday traffic 50x normal
</span><span id="__span-10-781"><a id="__codelineno-10-781" name="__codelineno-10-781" href="#__codelineno-10-781"></a>
</span><span id="__span-10-782"><a id="__codelineno-10-782" name="__codelineno-10-782" href="#__codelineno-10-782"></a>**The Problem**: Uneven load distribution
</span></code></pre></div>
Worker 1: Processing celebrity endorsement orders (10K items)
Worker 2: Processing regular orders (10 items)
Worker 3-10: Idle</p>
<p>Result: Celebrity orders timeout, customer rage
<code>text
**The Solution**: Implemented work stealing</code>python
class AdaptiveWorkStealer:
    def <strong>init</strong>(self, steal_threshold=0.7):
        self.workers = []
        self.global_metrics = MetricsCollector()</p>
<div class="language-text highlight"><pre><span></span><code>def rebalance(self):
    &quot;&quot;&quot;Continuously rebalance work&quot;&quot;&quot;
    while True:
        worker_loads = self.get_worker_loads()
        avg_load = sum(worker_loads.values()) / len(worker_loads)

        # Find overloaded and underloaded workers
        overloaded = []
        underloaded = []

        for worker, load in worker_loads.items():
            if load &gt; avg_load * 1.5:
                overloaded.append((load, worker))
            elif load &lt; avg_load * 0.5:
                underloaded.append((load, worker))

        # Steal from most loaded to least loaded
        overloaded.sort(reverse=True)
        underloaded.sort()

        for _, victim in overloaded:
            if not underloaded:
                break

            _, thief = underloaded.pop(0)

            # Steal work
            stolen_work = victim.steal_percentage(0.3)  # 30%
            thief.add_work(stolen_work)

            self.global_metrics.record_steal(victim, thief, len(stolen_work))

        time.sleep(1)  # Rebalance every second
</code></pre></div>
<h1 id="results">Results:<a class="headerlink" href="#results" title="Permanent link">&para;</a></h1>
<h1 id="-p99-latency-30s-2s">- P99 latency: 30s  2s<a class="headerlink" href="#-p99-latency-30s-2s" title="Permanent link">&para;</a></h1>
<h1 id="-success-rate-72-995">- Success rate: 72%  99.5%<a class="headerlink" href="#-success-rate-72-995" title="Permanent link">&para;</a></h1>
<h1 id="-revenue-saved-23m">- Revenue saved: $2.3M<a class="headerlink" href="#-revenue-saved-23m" title="Permanent link">&para;</a></h1>
<p>```bash</p>
<h3 id="performance-optimization-cookbook">Performance Optimization Cookbook<a class="headerlink" href="#performance-optimization-cookbook" title="Permanent link">&para;</a></h3>
<h4 id="recipe-1-the-batch-accumulator-pattern">Recipe 1: The Batch Accumulator Pattern<a class="headerlink" href="#recipe-1-the-batch-accumulator-pattern" title="Permanent link">&para;</a></h4>
<p>```python
class BatchAccumulator:
    """Accumulate items and process in optimal batches"""</p>
<div class="language-text highlight"><pre><span></span><code>def __init__(self, batch_size=100, max_wait_ms=100, processor=None):
    self.batch_size = batch_size
    self.max_wait_ms = max_wait_ms
    self.processor = processor
    self.pending = []
    self.lock = asyncio.Lock()
    self.timer_task = None

async def add(self, item):
    async with self.lock:
        self.pending.append(item)

        if len(self.pending) &gt;= self.batch_size:
            # Batch full, process immediately
            await self._process_batch()
        elif not self.timer_task:
            # Start timer for partial batch
            self.timer_task = asyncio.create_task(self._timer())

async def _timer(self):
    await asyncio.sleep(self.max_wait_ms / 1000)
    async with self.lock:
        if self.pending:
            await self._process_batch()
        self.timer_task = None

async def _process_batch(self):
    batch = self.pending
    self.pending = []

    if self.timer_task:
        self.timer_task.cancel()
        self.timer_task = None

    # Process batch
    await self.processor(batch)
</code></pre></div>
<h1 id="usage-reduces-network-calls-by-100x">Usage: Reduces network calls by 100x<a class="headerlink" href="#usage-reduces-network-calls-by-100x" title="Permanent link">&para;</a></h1>
<p>accumulator = BatchAccumulator(
    batch_size=1000,
    max_wait_ms=50,
    processor=bulk_insert_to_database
)
```bash</p>
<h4 id="recipe-2-the-priority-work-queue">Recipe 2: The Priority Work Queue<a class="headerlink" href="#recipe-2-the-priority-work-queue" title="Permanent link">&para;</a></h4>
<p>```python
class PriorityWorkQueue:
    """Work queue with multiple priority levels and starvation prevention"""</p>
<div class="language-text highlight"><pre><span></span><code>def __init__(self, num_priorities=3):
    self.queues = [asyncio.Queue() for _ in range(num_priorities)]
    self.total_processed = [0] * num_priorities
    self.starvation_threshold = 10  # Ratio

async def put(self, item, priority=1):
    await self.queues[priority].put(item)

async def get(self):
    &quot;&quot;&quot;Get next item, preventing starvation&quot;&quot;&quot;
    # Calculate ratios
    total = sum(self.total_processed)
    if total &gt; 0:
        ratios = [p / total for p in self.total_processed]
    else:
        ratios = [0] * len(self.queues)

    # Check for starvation
    for i in range(1, len(self.queues)):
        if self.queues[i].qsize() &gt; 0:
            expected_ratio = 1 / (2 ** i)  # Exponential priority
            if ratios[i] &lt; expected_ratio / self.starvation_threshold:
                # This queue is starving, service it
                item = await self.queues[i].get()
                self.total_processed[i] += 1
                return item

    # Normal priority order
    for i, queue in enumerate(self.queues):
        if queue.qsize() &gt; 0:
            item = await queue.get()
            self.total_processed[i] += 1
            return item

    # All queues empty, wait on highest priority
    item = await self.queues[0].get()
    self.total_processed[0] += 1
    return item
</code></pre></div>
<p>```bash</p>
<h4 id="recipe-3-the-adaptive-batch-sizing">Recipe 3: The Adaptive Batch Sizing<a class="headerlink" href="#recipe-3-the-adaptive-batch-sizing" title="Permanent link">&para;</a></h4>
<p>```python
class AdaptiveBatcher:
    """Dynamically adjust batch size based on system load"""</p>
<div class="language-text highlight"><pre><span></span><code>def __init__(self, min_batch=10, max_batch=1000):
    self.min_batch = min_batch
    self.max_batch = max_batch
    self.current_batch = min_batch

    # Performance tracking
    self.latency_history = deque(maxlen=100)
    self.throughput_history = deque(maxlen=100)

def process_batch(self, items):
    start_time = time.time()

    # Process items
    results = [process_item(item) for item in items]

    # Measure performance
    duration = time.time() - start_time
    latency_per_item = duration / len(items)
    throughput = len(items) / duration

    self.latency_history.append(latency_per_item)
    self.throughput_history.append(throughput)

    # Adjust batch size
    self._adjust_batch_size()

    return results

def _adjust_batch_size(self):
    if len(self.latency_history) &lt; 10:
        return  # Not enough data

    # Calculate trends
    recent_latency = sum(list(self.latency_history)[-10:]) / 10
    older_latency = sum(list(self.latency_history)[-20:-10]) / 10

    recent_throughput = sum(list(self.throughput_history)[-10:]) / 10
    older_throughput = sum(list(self.throughput_history)[-20:-10]) / 10

    # Decision logic
    if recent_latency &gt; older_latency * 1.2:
        # Latency increasing, reduce batch
        self.current_batch = max(
            self.min_batch,
            int(self.current_batch * 0.8)
        )
    elif recent_throughput &gt; older_throughput * 1.1:
        # Throughput improving, increase batch
        self.current_batch = min(
            self.max_batch,
            int(self.current_batch * 1.2)
        )

    # Log adjustment
    logging.info(f&quot;Adjusted batch size to {self.current_batch}&quot;)
</code></pre></div>
<p>```yaml</p>
<h3 id="the-future-of-work-distribution">The Future of Work Distribution<a class="headerlink" href="#the-future-of-work-distribution" title="Permanent link">&para;</a></h3>
<h4 id="emerging-patterns">Emerging Patterns<a class="headerlink" href="#emerging-patterns" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Serverless Work Distribution</strong>
   ```python
   # Work becomes ephemeral functions
   async def handle_work(event, context):
       # Platform handles:
       # - Scaling to zero
       # - Automatic distribution
       # - Failure retry
       # - Monitoring</p>
<p>result = process(event['data'])
   return {'statusCode': 200, 'body': result}
   ```</p>
</li>
<li>
<p><strong>Edge-Native Work</strong>
   ```python
   class EdgeWorkDistributor:
       def route_work(self, work_item, user_location):
           # Find nearest edge node
           edge_node = self.find_nearest_edge(user_location)</p>
<div class="language-text highlight"><pre><span></span><code>   # Check if work can be done at edge
   if self.can_process_at_edge(work_item):
       return edge_node.process(work_item)
   else:
       # Route to regional or central
       return self.route_to_region(work_item)
</code></pre></div>
<p>```</p>
</li>
<li>
<p><strong>ML-Driven Scheduling</strong>
   ```python
   class MLScheduler:
       def predict_optimal_placement(self, work_item):
           features = self.extract_features(work_item)</p>
<div class="language-text highlight"><pre><span></span><code>   # Predict:
   # - Execution time
   # - Resource needs
   # - Failure probability
   # - Best worker type

   placement = self.model.predict(features)
   return placement
</code></pre></div>
<p>```</p>
</li>
</ol>
<hr />
<h2 id="common-anti-patterns-to-avoid">Common Anti-Patterns to Avoid<a class="headerlink" href="#common-anti-patterns-to-avoid" title="Permanent link">&para;</a></h2>
<hr />
<h2 id="summary-key-takeaways">Summary: Key Takeaways<a class="headerlink" href="#summary-key-takeaways" title="Permanent link">&para;</a></h2>
<ol>
<li><strong> Intuition</strong>: Work distribution is like organizing a kitchen - specialization and coordination</li>
<li><strong> Foundation</strong>: Amdahl's Law sets hard limits on parallelization benefits</li>
<li><strong> Deep Dive</strong>: Real systems need work stealing, batching, and careful queue management</li>
<li><strong> Expert</strong>: Theory guides optimal worker counts and queue depths</li>
<li><strong> Mastery</strong>: Production systems require holistic thinking about failure, monitoring, and cost</li>
</ol>
<h3 id="the-work-distribution-commandments">The Work Distribution Commandments<a class="headerlink" href="#the-work-distribution-commandments" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Thou shalt respect Amdahl's Law</strong> - Sequential parts limit parallel gains</li>
<li><strong>Thou shalt implement backpressure</strong> - Unbounded queues are time bombs</li>
<li><strong>Thou shalt steal work</strong> - Dynamic load balancing beats static</li>
<li><strong>Thou shalt batch operations</strong> - Amortize coordination costs</li>
<li><strong>Thou shalt monitor everything</strong> - You can't optimize what you don't measure</li>
</ol>
<h3 id="quick-reference-card">Quick Reference Card<a class="headerlink" href="#quick-reference-card" title="Permanent link">&para;</a></h3>
<hr />
<p><em>"Work distribution is not just about spreading computationit's about spreading it intelligently while respecting the laws of physics and coordination."</em></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/deepaucksharma" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/deepaucksharma" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.0/dist/mermaid.min.js"></script>
      
        <script src="../../javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>