{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="{% if page.meta.description %}{{ page.meta.description }}{% else %}Master distributed systems from first principles. Learn the 8 fundamental axioms and 6 core pillars with interactive tools and real-world examples.{% endif %}">
  <meta name="keywords" content="{% if page.meta.keywords %}{{ page.meta.keywords|join(', ') }}{% else %}distributed systems, system design, scalability, microservices, cloud architecture{% endif %}">
  <meta name="author" content="Deepak">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ page.canonical_url }}">
  <meta property="og:title" content="{{ page.title }} - {{ config.site_name }}">
  <meta property="og:description" content="{% if page.meta.description %}{{ page.meta.description }}{% else %}{{ config.site_description }}{% endif %}">
  <meta property="og:image" content="{{ config.site_url }}assets/og-image.png">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="{{ page.canonical_url }}">
  <meta property="twitter:title" content="{{ page.title }} - {{ config.site_name }}">
  <meta property="twitter:description" content="{% if page.meta.description %}{{ page.meta.description }}{% else %}{{ config.site_description }}{% endif %}">
  <meta property="twitter:image" content="{{ config.site_url }}assets/twitter-card.png">
  
  <!-- PWA -->
  <link rel="manifest" href="{{ 'manifest.json' | url }}">
  <meta name="theme-color" content="#5448C8">
  <link rel="apple-touch-icon" href="{{ 'assets/icon-192x192.png' | url }}">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "headline": "{{ page.title }}",
    "description": "{% if page.meta.description %}{{ page.meta.description }}{% else %}{{ config.site_description }}{% endif %}",
    "author": {
      "@type": "Person",
      "name": "{{ config.site_author }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ config.site_name }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ config.site_url }}assets/logo.png"
      }
    },
    "datePublished": "{{ page.meta.date }}",
    "dateModified": "{{ page.meta.updated }}",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ page.canonical_url }}"
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ config.site_url }}"
        }
        {% if page.parent %}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": "{{ page.parent.title }}",
          "item": "{{ page.parent.canonical_url }}"
        }
        {% endif %}
        {% if page.title != "Home" %}
        ,{
          "@type": "ListItem",
          "position": {% if page.parent %}3{% else %}2{% endif %},
          "name": "{{ page.title }}",
          "item": "{{ page.canonical_url }}"
        }
        {% endif %}
      ]
    }
  }
  </script>
  
  <!-- Learning Resource Schema for educational content -->
  {% if "axiom" in page.url or "pillar" in page.url %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LearningResource",
    "name": "{{ page.title }}",
    "description": "{{ page.meta.description }}",
    "learningResourceType": "Lesson",
    "educationalLevel": "Advanced",
    "teaches": "Distributed Systems",
    "timeRequired": "PT{{ page.meta.reading_time | default(15) }}M",
    "inLanguage": "en",
    "isAccessibleForFree": true,
    "provider": {
      "@type": "Organization",
      "name": "{{ config.site_name }}"
    }
  }
  </script>
  {% endif %}
  
  <!-- FAQ Schema for reference pages -->
  {% if "glossary" in page.url or "faq" in page.url %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {% for term in page.meta.terms %}
      {
        "@type": "Question",
        "name": "{{ term.question }}",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{{ term.answer }}"
        }
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  }
  </script>
  {% endif %}
  
  <!-- Preconnect to external domains -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Prefetch critical resources -->
  <link rel="prefetch" href="{{ 'assets/js/app.js' | url }}">
  <link rel="prefetch" href="{{ 'search/search_index.json' | url }}">
{% endblock %}

{% block content %}
  {{ super() }}
  
  <!-- Reading progress indicator -->
  <div class="reading-progress-container"></div>
  
  <!-- Skip to content link -->
  <a href="#__content" class="skip-link">Skip to main content</a>
{% endblock %}

{% block scripts %}
  {{ super() }}
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => console.log('SW registered:', registration))
          .catch(error => console.log('SW registration failed:', error));
      });
    }
  </script>
  
  <!-- Analytics Consent -->
  <script>
    // Check for analytics consent on first visit
    if (localStorage.getItem('analytics-consent') === null) {
      window.DSApp?.modules.get('analytics')?.requestConsent();
    }
  </script>
{% endblock %}